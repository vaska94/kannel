<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Kannel  User's Guide</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"></HEAD
><BODY
CLASS="book"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="BOOK"
><A
NAME="AEN1"
></A
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="title"
><A
NAME="AEN2"
>Kannel  User's Guide</A
></H1
><H2
CLASS="subtitle"
>Open Source WAP and SMS gateway</H2
><H3
CLASS="author"
><A
NAME="AEN6"
></A
>Andreas Fink</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Chairman &#38; CTO<BR></SPAN
><SPAN
CLASS="orgname"
>Global Networks Inc.<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<CODE
CLASS="email"
>&#60;<A
HREF="mailto:andreas@fink.org"
>andreas@fink.org</A
>&#62;</CODE
><br>
				http://www.smsrelay.com/<br>
				http://www.gni.ch/<br>
			</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN16"
></A
>Bruno Rodrigues</H3
><DIV
CLASS="affiliation"
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
				<CODE
CLASS="email"
>&#60;<A
HREF="mailto:bruno.rodrigues@litux.org"
>bruno.rodrigues@litux.org</A
>&#62;</CODE
><br>
				http://litux.org/bruno<br>
			</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN23"
></A
>Stipe Tolj</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>System Architect<BR></SPAN
><SPAN
CLASS="orgname"
>Tolj System Architecture<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
				<CODE
CLASS="email"
>&#60;<A
HREF="mailto:stolj@kannel.org"
>stolj@kannel.org</A
>&#62;</CODE
><br>
				http://www.tolj.org/<br>
			</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN32"
></A
>Aarno Syvänen</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Chief MMS Developer<BR></SPAN
><SPAN
CLASS="orgname"
>Global Networks Inc.<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
				<CODE
CLASS="email"
>&#60;<A
HREF="mailto:as@gni.ch"
>as@gni.ch</A
>&#62;</CODE
><br>
				http://www.gni.ch/<br>
			</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN41"
></A
>Alexander Malysh</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Senior Software Engineer<BR></SPAN
><SPAN
CLASS="orgname"
>GTX Messaging GmbH.<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
				<CODE
CLASS="email"
>&#60;<A
HREF="mailto:amalysh at kannel.org"
>amalysh at kannel.org</A
>&#62;</CODE
><br>
				http://www.gtx-messaging.com/<br>
			</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN50"
></A
>Alejandro Guerrieri</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Senior System Architect<BR></SPAN
><SPAN
CLASS="orgname"
>3Cinteractive, L.L.C.<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<CODE
CLASS="email"
>&#60;<A
HREF="mailto:aguerrieri@kannel.org"
>aguerrieri@kannel.org</A
>&#62;</CODE
><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.3cinteractive.com/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="author"
><A
NAME="AEN59"
></A
>Lars Wirzenius</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Gateway architect<BR></SPAN
><SPAN
CLASS="orgname"
>former Wapit Ltd<BR></SPAN
></DIV
><H3
CLASS="author"
><A
NAME="AEN65"
></A
>Kalle Marjola</H3
><DIV
CLASS="affiliation"
><SPAN
CLASS="jobtitle"
>Senior Software Engineer<BR></SPAN
><SPAN
CLASS="orgname"
>Enpocket<BR></SPAN
><DIV
CLASS="address"
><P
CLASS="address"
>&nbsp;<br>
				<CODE
CLASS="email"
>&#60;<A
HREF="mailto:marjola@enpocket.com"
>marjola@enpocket.com</A
>&#62;</CODE
><br>
				http://www.enpocket.com<br>
			</P
></DIV
></DIV
><DIV
><DIV
CLASS="abstract"
><A
NAME="AEN74"
></A
><P
><B
>Abstract</B
></P
><P
>&#13;		This document describes how
		to install and use Kannel, the Open Source WAP and SMS Gateway
		originally developed by Wapit Ltd (now out of business) and now
		being developed further by the open source community, namely the 
		Kannel Group.
		</P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#AEN81"
>Introduction</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN99"
>Overview of WAP</A
></DT
><DT
><A
HREF="#AEN111"
>Overview of WAP Push</A
></DT
><DT
><A
HREF="#AEN118"
>Overview of SMS</A
></DT
><DT
><A
HREF="#AEN132"
>Features</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN134"
>WAP</A
></DT
><DT
><A
HREF="#AEN142"
>WAP Push</A
></DT
><DT
><A
HREF="#AEN150"
>SMS</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN163"
>Requirements</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#AEN189"
>Installing the gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN195"
>Getting the source code</A
></DT
><DT
><A
HREF="#AEN200"
>Finding the documentation</A
></DT
><DT
><A
HREF="#AEN222"
>Compiling the gateway</A
></DT
><DT
><A
HREF="#AEN331"
>Installing the gateway</A
></DT
><DT
><A
HREF="#AEN347"
>Using pre-compiled binary packages</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN349"
>Installing Kannel from RPM packages</A
></DT
><DT
><A
HREF="#AEN391"
>Installing Kannel from DEB packages</A
></DT
></DL
></DD
></DL
></DD
><DT
>3. <A
HREF="#AEN442"
>Using the gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN448"
>Configuring the gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN452"
>Configuration file syntax</A
></DT
><DT
><A
HREF="#includes"
>Inclusion of configuration files</A
></DT
><DT
><A
HREF="#AEN482"
>Core configuration</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN845"
>Running Kannel</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN848"
>Starting the gateway</A
></DT
><DT
><A
HREF="#arguments"
>Command line options</A
></DT
><DT
><A
HREF="#AEN977"
>Kannel statuses</A
></DT
><DT
><A
HREF="#AEN993"
>HTTP administration</A
></DT
></DL
></DD
></DL
></DD
><DT
>4. <A
HREF="#wap-gateway"
>Setting up a WAP gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1098"
>WAP gateway configuration</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1106"
>Wapbox group</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN1217"
>Running WAP gateway</A
></DT
><DT
><A
HREF="#AEN1220"
>Checking whether the WAP gateway is alive</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#wtls"
>Setting up wtls security</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1316"
>Wtls configuration</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#msisdn-provisioning"
>Setting up MSISDN provisioning for WAP gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1358"
>RADIUS accounting proxy configuration</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1361"
>RADIUS-Acct configuration</A
></DT
><DT
><A
HREF="#AEN1434"
>Using the MSISDN provisioning on HTTP server side</A
></DT
></DL
></DD
></DL
></DD
><DT
>7. <A
HREF="#sms-gateway"
>Setting up a SMS Gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1441"
>Required components</A
></DT
><DT
><A
HREF="#AEN1447"
>SMS gateway configuration</A
></DT
><DT
><A
HREF="#AEN1457"
>SMS centers</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN1671"
>Nokia CIMD 1.37 and 2.0</A
></DT
><DT
><A
HREF="#AEN1737"
>CMG UCP/EMI 4.0 and 3.5</A
></DT
><DT
><A
HREF="#AEN1952"
>SMPP 3.3, 3.4 and 5.0</A
></DT
><DT
><A
HREF="#AEN2175"
>Sema Group SMS2000 OIS 4.0, 5.0 and 5.8</A
></DT
><DT
><A
HREF="#AEN2285"
>SM/ASI (for CriticalPath InVoke SMS Center 4.x)</A
></DT
><DT
><A
HREF="#AEN2357"
>GSM modem</A
></DT
><DT
><A
HREF="#AEN2643"
>GSMA OneAPI v1.0 ParlayX SMS SOAP</A
></DT
><DT
><A
HREF="#AEN2710"
>Fake SMSC</A
></DT
><DT
><A
HREF="#AEN2740"
>HTTP-based relay and content gateways</A
></DT
><DT
><A
HREF="#AEN3019"
>Loopback SMSC (MT to MO direction switching)</A
></DT
><DT
><A
HREF="#AEN3037"
>Using multiple SMS centers</A
></DT
><DT
><A
HREF="#AEN3043"
>Feature checklist</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN3570"
>External delivery report (DLR) storage</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN3574"
>Internal DLR storage</A
></DT
><DT
><A
HREF="#AEN3579"
>MySQL DLR storage</A
></DT
><DT
><A
HREF="#AEN3645"
>LibSDB DLR storage</A
></DT
><DT
><A
HREF="#AEN3657"
>Oracle 8i/9i DLR storage</A
></DT
><DT
><A
HREF="#AEN3668"
>PostgreSQL DLR storage</A
></DT
><DT
><A
HREF="#AEN3678"
>MS-SQL/Sybase DLR storage</A
></DT
><DT
><A
HREF="#AEN3692"
>SQLite3 DLR storage</A
></DT
><DT
><A
HREF="#AEN3702"
>Redis DLR storage</A
></DT
><DT
><A
HREF="#AEN3772"
>Cassandra DLR storage</A
></DT
><DT
><A
HREF="#AEN3783"
>DLR database field configuration</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN3861"
>SMSBox configuration</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN3863"
>Smsbox group</A
></DT
><DT
><A
HREF="#AEN4061"
>Smsbox routing inside bearerbox</A
></DT
><DT
><A
HREF="#AEN4102"
>SMS-service configurations</A
></DT
><DT
><A
HREF="#AEN4554"
>How sms-service interprets the HTTP response</A
></DT
><DT
><A
HREF="#AEN4881"
>SendSMS-user configurations</A
></DT
><DT
><A
HREF="#AEN5045"
>Over-The-Air configurations</A
></DT
><DT
><A
HREF="#AEN5186"
>Setting up more complex services</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN5215"
>Running SMS gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN5217"
>Using the HTTP interface to send SMS messages</A
></DT
><DT
><A
HREF="#AEN5432"
>Using the HTTP interface to send OTA configuration messages</A
></DT
></DL
></DD
></DL
></DD
><DT
>8. <A
HREF="#ppg"
>Setting up Push Proxy Gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN5531"
>Configuring ppg core group, for push initiator (PI) interface</A
></DT
><DT
><A
HREF="#AEN5672"
>Configuring PPG user group variables</A
></DT
><DT
><A
HREF="#AEN5801"
>Finishing ppg configuration</A
></DT
><DT
><A
HREF="#AEN5814"
>Running a push proxy gateway</A
></DT
><DT
><A
HREF="#AEN5819"
>An example using HTTP SMSC</A
></DT
><DT
><A
HREF="#AEN5822"
>An example of minimum SI document</A
></DT
><DT
><A
HREF="#AEN5827"
>An example push (tokenized SI) document</A
></DT
><DT
><A
HREF="#AEN5832"
>Default network and bearer used by push proxy gateway</A
></DT
><DT
><A
HREF="#AEN5836"
>Push related Kannel headers</A
></DT
><DT
><A
HREF="#AEN5873"
>Requesting SMS level delivery reports for WAP pushes</A
></DT
><DT
><A
HREF="#AEN5905"
>Routing WAP pushes to a specific smsc</A
></DT
></DL
></DD
><DT
>9. <A
HREF="#ssl-enabling"
>Using SSL for HTTP</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN5928"
>Using SSL client support</A
></DT
><DT
><A
HREF="#AEN5933"
>Using SSL server support for the administration HTTP
	   interface</A
></DT
><DT
><A
HREF="#AEN5937"
>Using SSL server support for the sendsms HTTP
	   interface</A
></DT
><DT
><A
HREF="#AEN5941"
>Using SSL server support for PPG HTTPS interface</A
></DT
></DL
></DD
><DT
>10. <A
HREF="#delivery-reports"
>SMS Delivery Reports</A
></DT
><DT
>11. <A
HREF="#bug-reporting"
>Getting help and reporting bugs</A
></DT
><DT
>A. <A
HREF="#upgrading-notes"
>Upgrading notes</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6003"
>From 1.2.x or 1.3.1 to 1.3.2 and later</A
></DT
></DL
></DD
><DT
>B. <A
HREF="#certificates"
>Certificate generation</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6022"
>Self-signed 1024-bit RSA SSL certificates using openssl</A
></DT
></DL
></DD
><DT
>C. <A
HREF="#AEN6058"
>Using the fake WAP sender</A
></DT
><DT
>D. <A
HREF="#AEN6061"
>Using the fake SMS center</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6065"
>Setting up fakesmsc</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6068"
>Compiling fakesmsc</A
></DT
><DT
><A
HREF="#AEN6073"
>Configuring Kannel</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN6084"
>Running Kannel with fakesmsc connections</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6087"
>Starting fake SMS center</A
></DT
></DL
></DD
></DL
></DD
><DT
>E. <A
HREF="#AEN6151"
>Setting up a test environment for Push Proxy Gateway</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6154"
>Creating push content and control document for testing</A
></DT
><DT
><A
HREF="#AEN6169"
>Starting necessary programs</A
></DT
><DT
><A
HREF="#AEN6291"
>Using Nokia Toolkit as a part of a developing environment</A
></DT
><DT
><A
HREF="#AEN6306"
>Testing PAP protocol over HTTPS</A
></DT
></DL
></DD
><DT
>F. <A
HREF="#AEN6388"
>Setting up a dial-up line</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6391"
>Analog modem</A
></DT
><DT
><A
HREF="#AEN6416"
>ISDN terminal</A
></DT
></DL
></DD
><DT
>G. <A
HREF="#regular-expressions"
>Regular Expressions</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6423"
>Syntax and semantics of the regex configuration parameter</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6428"
>How-to setup the regex-parameters</A
></DT
><DT
><A
HREF="#AEN6491"
>Regex and non-regex-parameters</A
></DT
><DT
><A
HREF="#AEN6495"
>Performance issues</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN6498"
>Examples</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6501"
>Example 1: core-configuration</A
></DT
><DT
><A
HREF="#AEN6506"
>Example 3: smsc-configuration</A
></DT
><DT
><A
HREF="#AEN6511"
>Example 4: sms-service-configuration</A
></DT
></DL
></DD
></DL
></DD
><DT
>H. <A
HREF="#meta-data"
>Meta Data</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6521"
>Overview</A
></DT
><DT
><A
HREF="#AEN6527"
>SMPP Implementation</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6588"
>MO Messages</A
></DT
><DT
><A
HREF="#AEN6596"
>MT Messages</A
></DT
></DL
></DD
></DL
></DD
><DT
>I. <A
HREF="#AEN6623"
>Log files</A
></DT
><DD
><DL
><DT
><A
HREF="#AEN6626"
>Bearerbox Access Log</A
></DT
><DT
><A
HREF="#AEN6697"
>Log rotation</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN6703"
>Glossary</A
></DT
><DT
><A
HREF="#AEN6730"
>Bibliography</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Tables</B
></DT
><DT
>3-1. <A
HREF="#AEN490"
>Core Group Variables</A
></DT
><DT
>3-2. <A
HREF="#AEN872"
>Kannel Command Line Options</A
></DT
><DT
>3-3. <A
HREF="#AEN999"
>Kannel HTTP Administration Commands</A
></DT
><DT
>4-1. <A
HREF="#AEN1113"
>Wapbox Group Variables</A
></DT
><DT
>5-1. <A
HREF="#AEN1318"
>Wtls Group Variables</A
></DT
><DT
>6-1. <A
HREF="#AEN1365"
>RADIUS-Acct Group Variables</A
></DT
><DT
>7-1. <A
HREF="#AEN1464"
>SMSC Group Variables</A
></DT
><DT
>7-2. <A
HREF="#AEN3047"
>SMSC driver features</A
></DT
><DT
>7-3. <A
HREF="#AEN3267"
>SMSC driver internal features</A
></DT
><DT
>7-4. <A
HREF="#AEN3594"
>MySQL Connection Group Variables</A
></DT
><DT
>7-5. <A
HREF="#AEN3726"
>Redis Connection Group Variables</A
></DT
><DT
>7-6. <A
HREF="#AEN3787"
>DLR Database Field Configuration Group Variables</A
></DT
><DT
>7-7. <A
HREF="#AEN3869"
>Smsbox Group Variables</A
></DT
><DT
>7-8. <A
HREF="#AEN4071"
>Smsbox-route Group Variables</A
></DT
><DT
>7-9. <A
HREF="#AEN4115"
>SMS-Service Group Variables</A
></DT
><DT
>7-10. <A
HREF="#escapecodes"
>Parameters (Escape Codes)</A
></DT
><DT
>7-11. <A
HREF="#AEN4587"
>X-Kannel Headers</A
></DT
><DT
>7-12. <A
HREF="#AEN4726"
>X-Kannel Post Headers</A
></DT
><DT
>7-13. <A
HREF="#AEN4885"
>SendSMS-User Group Variables</A
></DT
><DT
>7-14. <A
HREF="#AEN5053"
>OTA Setting Group Variables</A
></DT
><DT
>7-15. <A
HREF="#AEN5150"
>OTA Bookmark Group Variables</A
></DT
><DT
>7-16. <A
HREF="#AEN5222"
>SMS Push reply codes</A
></DT
><DT
>7-17. <A
HREF="#AEN5254"
>SMS Push (send-sms) CGI Variables</A
></DT
><DT
>7-18. <A
HREF="#AEN5460"
>OTA CGI Variables</A
></DT
><DT
>8-1. <A
HREF="#AEN5538"
>PPG core group configuration variables</A
></DT
><DT
>8-2. <A
HREF="#AEN5678"
>PPG user group configuration variables</A
></DT
><DT
>8-3. <A
HREF="#AEN5840"
>Kannel headers used by PPG</A
></DT
><DT
>D-1. <A
HREF="#AEN6110"
>Fakesmsc command line options</A
></DT
><DT
>E-1. <A
HREF="#AEN6190"
>Test_ppg's command line options</A
></DT
><DT
>E-2. <A
HREF="#AEN6313"
>Test_ppg's configuration file directives</A
></DT
></DL
></DIV
><DIV
CLASS="LOT"
><DL
CLASS="LOT"
><DT
><B
>List of Figures</B
></DT
><DT
>1-1. <A
HREF="#AEN105"
>Logical position of WAP gateway (and PPG) between a phone and a 
        content server.</A
></DT
><DT
>1-2. <A
HREF="#AEN126"
>Logical position of SMS gateway between a phone and a content server.</A
></DT
></DL
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="AEN81"
></A
>Chapter 1. Introduction</H1
><DIV
CLASS="highlights"
><A
NAME="AEN83"
></A
><P
>This chapter introduces WAP and SMS in general terms, and explains the
	role of the gateway in WAP and SMS, outlining their duties and features. It
	also explains why the Kannel project was started in the first place,
	and why it is open source.</P
></DIV
><P
>With hundreds of millions of mobile phones in use all over the
	world, the market for services targeted at mobile users
	is mind-bogglingly immense.  Even simple services find plenty of users,
	as long as they're useful or fun. Being able to get news, send e-mail
	or just be entertained wherever you are is extremely attractive to
	many.</P
><P
>The hottest technology for implementing mobile services is WAP,
	short for Wireless Application Protocol. It lets the phone act
	as a simple web browser, but optimizes the markup language,
	scripting language, and the transmission protocols for wireless
	use. The optimized protocols are translated to plain old HTTP by
	a <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>WAP gateway</I
></SPAN
>.</P
><P
>Kannel is an open source WAP gateway. It attempts to
	provide this essential part of the WAP infrastructure freely
	to everyone so that the market potential for WAP services,
	both from wireless operators and specialized service providers,
	will be realized as efficiently as possible.</P
><P
>Kannel also works as an SMS gateway for GSM networks. Almost
	all GSM phones can send and receive SMS messages, so this is
	a way to serve many more clients than just those using a new
	WAP phone.</P
><P
>In addition, Kannel operates as <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Push Proxy Gateway 
        </I
></SPAN
>, or <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>PPG</I
></SPAN
>, making possible for content 
        servers to send data to the phones. This is a new type of WAP service,
        and have many interesting applications. Usually servers know whether
        some data is new, not the users. </P
><P
>Kannel's quality has been recognized on March 7, 2001 when it
	was <A
HREF="http://www.kannel.org/oldnews.shtml#wapcert"
TARGET="_top"
>certified</A
> 
	by <A
HREF="http://www.wapforum.org"
TARGET="_top"
>WAP Forum</A
>
	as the first WAP 1.1 gateway in the world.</P
><P
>Greater quality recognition are the quantity of companies 
	using Kannel to successful connect to a variety of SMSC protocols 
	in lots of countries.</P
><P
><A
HREF="http://www.opensource.org"
TARGET="_top"
>Open Source</A
>
	is a way to formalize the principle of openness by placing the
	source code of a product under a Open Source compliant software
	license. The BSD license was chosen over other Open Source
	licenses by the merit of placing the least amount of limitations
	on what a third party is able to do with the source code. In
	practice this means that Kannel is going to be a fully-featured
	WAP implementation and compatible with the maximum number of
	bearers with special emphasis on SMSC compatibility.
	The Kannel project was founded by Wapit Ltd in June, 1999.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN99"
>Overview of WAP</A
></H2
><P
>WAP, short for Wireless Application Protocol, is a
	collection of various languages and tools and an infrastructure for
	implementing services for mobile phones. Traditionally such
	services have worked via normal phone calls or short textual
	messages (e.g., SMS messages in GSM networks). Neither are very
	efficient to use, nor very user friendly.  WAP makes it possible
	to implement services similar to the World Wide Web.</P
><P
>Unlike marketers claim, WAP does not bring the existing
	content of the Internet directly to the phone. There are too many
	technical and other problems for this to ever work properly. The
	main problem is that Internet content is mainly in the form of
	HTML pages, and they are written in such way that they require
	fast connections, fast processors, large memories, big screens,
	audio output and often also fairly efficient input mechanisms.
	That's OK, since they hopefully work better for traditional
	computers and networks that way. However, portable phones have
	very slow processors, very little memory, abysmal and intermittent
	bandwidth, and extremely awkward input mechanisms. Most existing
	HTML pages do not work on mobiles phones, and never will.</P
><P
>WAP defines a completely new markup language, the Wireless
	Markup Language (WML), which is simpler and much more strictly
	defined than HTML.  It also defines a scripting language,
	WMLScript, which all browsers are required to support. To make
	things even simpler for the phones, it even defines its own
	bitmap format (Wireless Bitmap, or WBMP).</P
><P
>HTTP is also too inefficient for wireless use. However, by using
	a semantically similar binary and compressed format it
	is possible to reduce the protocol overhead to a few bytes per
	request, instead of the usual hundreds of bytes. Thus, WAP defines a
	new protocol stack to be used. However, to make things simpler
	also for the people actually implementing the services, WAP
	introduces a gateway between the phones and the servers providing
	content to the phones.</P
><DIV
CLASS="figure"
><A
NAME="AEN105"
></A
><P
><B
>Figure 1-1. Logical position of WAP gateway (and PPG) between a phone and a 
        content server.</B
></P
><P
><IMG
SRC="wap-gateway.png"></P
></DIV
><P
>The WAP gateway talks to the phone using the WAP protocol
	stack, and translates the requests it receives to normal
	HTTP. Thus content providers can use any HTTP servers and
	utilize existing know-how about HTTP service implementation
	and administration.</P
><P
>In addition to protocol translations, the gateway
	also compresses the WML pages into a more compact form, to
	save on-the-air bandwidth and to further reduce the phone's
	processing requirements. It also compiles WMLScript programs
	into a byte-code format. Latest WAP specifications defines some 
	additional conversions that Kannel is starting to implement, like
	multipart/form-data, multipart/mixed or MMS content conversion.</P
><P
>Kannel is not just a WAP gateway. It also works as an
	SMS gateway.  Although WAP is the hot and technically superior
	technology, SMS phones exist in huge numbers and SMS services are
	thus quite useful. Therefore, Kannel functions simultaneously
	as both a WAP and an SMS gateway.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN111"
>Overview of WAP Push</A
></H2
><P
>Previous chapter explained pull mode of operation: the phone
       initiates the transaction. There is, however, situations when the
       server (called in this context a push initiator) should be the 
       initiator, for instance, when it must send a mail notification or a
       stock quote. For this purpose WAP Forum defined WAP Push.</P
><P
>Push is an application level service, sitting on the top of
       existing WAP stack. It defines two protocols, OTA and PAP. OTA is
       a ligthweigth protocol speaking with WAP stack (to be more specific,
       with WSP), PAP speaks with the push initiator. It defines three kind
       of XML documents, one for the push data itself and another for 
       protocol purposes (these are called pap document or push control 
       documents). </P
><P
>The server does not simply send push content to the phone, the
       user would surely not accept, for instance, interrupting of a voice 
       call. Instead it sends a specific XML document, either Service 
       Indication or Service Loading. These inform the user about the content 
       become available, and it is displayed only when it is not interrupting 
       anything. It contains an URL specifying the service and a text for user 
       describing the content. Then the user can decide does he accept push or not.
       </P
><P
>The push content is send ed to the phones over SMS, but the 
       content is fetched by the phone over IP bearer, for instance CSD
       or GPRS. Because Push Proxy Gateway tokenises SI and SL documents, it 
       may fit one SMS message (if not, it is segmented for transfer). </P
><P
>Using two bearers seems to be an unnecessary complication. But
       quite simply, phones currently operate this way. Push over GPRS can 
       only simplify matters.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN118"
>Overview of SMS</A
></H2
><P
>SMS, short messaging service, is a way to send short (160
      character) messages from one GSM phone to another. It can also
      be used to send regular text as well as advanced content like 
      operator logos, ringing tones, business cards
      and phone configurations.</P
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>SMS services</I
></SPAN
> are content services
      initiated by SMS message to certain (usually short) phone
      number, which then answers with requested content, if available.</P
><P
>When SMS services are used, the client (mobile terminal) 
      sends an SMS
      message to certain number, usually a very short specialized
      number, which points to specific SMS center responsible
      for that number (plus possibly many others). This SMS center
      then sends the message onward to specified receiver in intra- or
      Internet, using an SMS center specific protocol. For example, a
      Nokia SMS center uses CIMD protocol.</P
><P
>As practically every different kind of SMS center uses different
      protocol, an <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>SMS gateway</I
></SPAN
> is used to handle
      connections with SMS centers and to relay them onward in an
      unified form. Kannel's biggest feature is to abstract each SMSC protocol
      to a well-known HTTP protocol, simplifying services deployment.</P
><DIV
CLASS="figure"
><A
NAME="AEN126"
></A
><P
><B
>Figure 1-2. Logical position of SMS gateway between a phone and a content server.</B
></P
><P
><IMG
SRC="sms-gateway.png"></P
></DIV
><P
>An SMS gateway can also be used to relay SMS messages from
      one GSM network to another, if the networks do not roam messages
      normally.</P
><P
>Kannel works as an SMS gateway, talking with many
      different kind of SMS centers, and relaying the messages onward
      to content providers, as HTTP queries. Content providers then
      answer to this HTTP query and the answer is sent back to mobile
      terminal, with appropriate SMS center connection using SMS center
      specific protocol.</P
><P
>In addition to serving mobile originated (MO) SMS messages
      Kannel also works as an SMS push gateway - content providers can
      request Kannel to send SMS messages to terminals. Kannel then
      determines the correct SMS center to relay the SMS message and
      sends the SMS message to that SMS center, again using SMS center
      specific protocol. This way the content provider does not need
      to know any SMS center specific protocol, just unified Kannel
      SMS sending interface.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN132"
>Features</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
NAME="AEN134"
>WAP</A
></H3
><P
>&#13;			<P
></P
><UL
><LI
><P
>Fully compliant with WAP 1.1 specification</P
></LI
><LI
><P
>Already implements some WAP 1.2 and even WAP 2.0 features.</P
></LI
></UL
>
		</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN142"
>WAP Push</A
></H3
><P
>&#13;			<P
></P
><UL
><LI
><P
>Supports WAP Push SI and SL</P
></LI
><LI
><P
>...</P
></LI
></UL
>
		</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN150"
>SMS</A
></H3
><P
>&#13;			<P
></P
><UL
><LI
><P
>Supports a variety of SMSC protocols, namely:</P
><P
></P
><UL
><LI
><P
>CMG's UCP/EMI 4.0 and 3.5</P
></LI
><LI
><P
>...</P
></LI
></UL
></LI
><LI
><P
>Full support for MO and MT messages</P
></LI
></UL
>
		</P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN163"
>Requirements</A
></H2
><P
>Kannel is being developed on Linux systems,
	and should be fairly easy to export to other Unix-like
	systems. However, we don't yet support other platforms, due to lack
	of time, although it should be working without major problems on 
	Windows (through Cygwin), Solaris and FreeBSD.
	</P
><P
>Kannel requires the following software environment:
	
	<P
></P
><UL
><LI
><P
>C compiler and libraries for ANSI C, with normal
		Unix extensions such as BSD sockets and related tools. 
		(GNU's GCC tool-chain is recommended)</P
></LI
><LI
><P
>The Gnome XML library (known as
		gnome-xml and libxml), version 2.2.5 or newer. See <A
HREF="http://xmlsoft.org/xml.html"
TARGET="_top"
>http://xmlsoft.org/xml.html</A
>.
		</P
><P
>If you are installing it from your distribution's packages, you'll need
		<TT
CLASS="literal"
>libxml2-dev</TT
> in addition to run-time <TT
CLASS="literal"
>libxml2</TT
> package
		libraries.</P
></LI
><LI
><P
>GNU Make.</P
></LI
><LI
><P
>An implementation of POSIX threads
		(<TT
CLASS="filename"
>pthread.h</TT
>).</P
></LI
><LI
><P
>GNU Bison 1.28, if you want to modify the WMLScript
		compiler (a pre-generated parser is included for those who just
		want to compile Kannel).</P
></LI
><LI
><P
>DocBook processing tools: DocBook style-sheets,
		jade, jadetex, etc; see <TT
CLASS="filename"
>README</TT
>, section
                `Documentation', for more information (pre-formatted versions
                of the documentation are available, and you can compile Kannel
                itself even without the documentation tools).</P
></LI
><LI
><P
>GNU autoconf, if you want to modify the
		configuration script.</P
></LI
></UL
>
	</P
><P
>Hardware requirements are fluffier. Some informal benchmarking 
	have shown that with a reasonably fast PC architecture (e.g. 400MHz 
	Pentium II with 128MB RAM), SMS performance's bottleneck is always on the
	SMSC side, even for example with multiple connections summing a pipeline with 
	400 msg/sec.  We haven't benchmarked Kannel yet on WAP side, so there are 
	no hard numbers.</P
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="AEN189"
></A
>Chapter 2. Installing the gateway</H1
><P
>This chapter explains how the gateway can be installed,
	either from a source code package or by using a pre-compiled
	binary version. The goal of this chapter is to get the gateway
	compiled and all the files in the correct places; the next
	chapter will explain how the gateway is configured.</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you are upgrading from a previous version, please look at
	<A
HREF="#upgrading-notes"
>Appendix A</A
> for any important information.</P
></BLOCKQUOTE
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN195"
>Getting the source code</A
></H2
><P
>The source code to
	Kannel is available for download at <A
HREF="http://www.kannel.org/download.shtml"
TARGET="_top"
>http://www.kannel.org/download.shtml</A
>.
	It is available in various formats and you can choose to download
	either the latest release version or the daily snapshot of the
	development source tree for the next release version, depending
	on whether you want to use Kannel for production use or to
	participate in the development.</P
><P
>If you're serious about development, you probably want to
	use CVS, the version control system used by the Kannel project.
	This allows you to participate in Kannel development much
	more easily than by downloading the current daily snapshot and
	integrating any changes you've made every day. CVS does that
	for you. (See the Kannel web site for more information on how
	to use CVS.)</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN200"
>Finding the documentation</A
></H2
><P
>The documentation for Kannel consists of three parts:
	
	<P
></P
><OL
TYPE="1"
><LI
><P
><I
CLASS="citetitle"
>User's Guide</I
>, i.e., the one
		you're reading at the moment.</P
></LI
><LI
><P
><I
CLASS="citetitle"
>Architecture and
		Design</I
>, in <TT
CLASS="filename"
>doc/arch</TT
> or
		at <A
HREF="http://www.kannel.org/arch.shtml"
TARGET="_top"
>&#13;		http://www.kannel.org/arch.shtml</A
></P
></LI
><LI
><P
>The <TT
CLASS="filename"
>README</TT
> and various other
		text files in the source tree.</P
></LI
></OL
>
	</P
><P
>You can also find general information on Kannel's 
		<A
HREF="http://www.kannel.org"
TARGET="_top"
>website</A
> and
		information about existing problems at 
		<A
HREF="http://bugs.kannel.org"
TARGET="_top"
>our bug tracker</A
>.
	</P
><P
>&#13;	We intend to cover everything you need to install and use Kannel
	is in <I
CLASS="citetitle"
>User's Guide</I
>, but the guide is still 
	incomplete in this respect. Similarly, the <I
CLASS="citetitle"
>Architecture and
	Design</I
> document should tell you everything you need
	to know to dive into the sources and quickly make your own modifications. 
	It's not a replacement for actually
	reading the source code, but it should work as a map to the
	source code.  The <TT
CLASS="filename"
>README</TT
> is not supposed
	to be very important, nor contain much information. Instead,
	it will just point at the other documentation.
	</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN222"
>Compiling the gateway</A
></H2
><P
>If you are using Kannel on a supported platform, or one
	that is similar enough to one, compiling Kannel should be trivial.
	After you have unpacked the source package of your choose,
	or after you have checked out the source code from CVS, enter
	the following commands:
	
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;        ./configure
        make
	</KBD
></PRE
>
	
	The <TT
CLASS="filename"
>configure</TT
> script investigates various
	things on your computer for the Kannel compilation needs, and
	writes out the <TT
CLASS="filename"
>Makefile</TT
> used to compile
	Kannel. <B
CLASS="command"
>make</B
> then runs the commands to actually
	compile Kannel.</P
><P
>If either command writes out an error message and stops
	before it finishes its job, you have a problem, and you either
	need to fix it yourself, if you can, or report the
	problem to the Kannel project. See <A
HREF="#bug-reporting"
>Chapter 11</A
>
	for details.</P
><P
>For detailed instruction on using the configuration
	script, see file <TT
CLASS="filename"
>INSTALL</TT
>. That file is
	a generic documentation for <B
CLASS="command"
>configure</B
>. Kannel
	defines a few additional options:
	
    	<P
></P
><UL
><LI
><P
><TT
CLASS="literal"
>--with-defaults=</TT
><TT
CLASS="replaceable"
><I
>type</I
></TT
>

	    Set defaults for the other options.
	    <TT
CLASS="replaceable"
><I
>type</I
></TT
> is either <TT
CLASS="literal"
>speed</TT
>
	    or <TT
CLASS="literal"
>debug</TT
>.  The default is
            <TT
CLASS="literal"
>speed</TT
>. <TT
CLASS="literal"
>speed</TT
> options is equivalent to 
	    <TT
CLASS="literal"
>--with-malloc=native --disable-assertions</TT
>, while 
	    <TT
CLASS="literal"
>debug</TT
> is <TT
CLASS="literal"
>--with-malloc=checking --enable-assertions</TT
>.

	    </P
></LI
><LI
><P
><TT
CLASS="literal"
>--disable-docs (default is --enable-docs)</TT
>

	    Use this option if you don't have DocBook installed and/or 
	    you want to save some time and CPU cycles. 
	    Pre-generated documentation is available on Kannel's site.
	    Default behavior is to build documentation, b.e., converting the User Guide and
	    the Architecture Guide from the DocBook markup language to
	    PostScript and HTML if DocBook is available.
	    </P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-drafts (default is --disable-drafts)</TT
>

	    When building documentation, include the sections marked as
	    <TT
CLASS="literal"
>draft</TT
>.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-debug (default is --disable-debug)</TT
>

	    Enable non-reentrant development time
	    debugging of WMLScript compiler.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--disable-localtime (default is --enable-localtime)</TT
>

	    Write log file time stamps in GMT, not in local time.
	    </P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-assertions / --disable-assertions</TT
>

	    Turn on or off runtime assertion checking.  <TT
CLASS="literal"
>enable</TT
> makes
	    Kannel faster, but gives less information if it crashes.
	    Default value is dependent on <TT
CLASS="literal"
>--with-defaults</TT
>.
	    </P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-malloc=</TT
><TT
CLASS="replaceable"
><I
>type</I
></TT
>

	    Select memory allocation module to use:
	    <TT
CLASS="replaceable"
><I
>type</I
></TT
> is <TT
CLASS="literal"
>native</TT
>,
            <TT
CLASS="literal"
>checking</TT
>, or
            <TT
CLASS="literal"
>slow</TT
>.  For production use you probably
	    want <TT
CLASS="literal"
>native</TT
>.  The <TT
CLASS="literal"
>slow</TT
>
            module is more thorough than <TT
CLASS="literal"
>checking</TT
>,
	    but much slower. 
	    Default value is dependent on <TT
CLASS="literal"
>--with-defaults</TT
>.
	    </P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-mutex-stats</TT
>

	    Produce information about lock contention.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-start-stop-daemon</TT
>

	    Compile the start-stop-daemon program.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--enable-pam</TT
>

	    Enable using PAM for authentication of sendsms users for
	    smsbox.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-mssql<TT
CLASS="replaceable"
><I
>[=DIR]</I
></TT
></TT
>

            Enable using FreeTDS libraries for DBPool and
            DLR support on MS-SQL and Sybase. Optional DIR specifies where to look for
            FreeTDS libraries and include files (defaults to /usr/local).</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-mysql</TT
>

            Enable using MySQL libraries for DBPool and
            DLR support.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-mysql-dir=</TT
><TT
CLASS="replaceable"
><I
>DIR</I
></TT
>

            Where to look for MySQL libs and header files.
            DIR points to the installation of MySQL.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-sdb</TT
>

            Enable using LibSDB libraries for dlr support.
            </P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-oracle</TT
>

            Enable using Oracle OCI-Libraries for Oracle 8i/9i DBPool and
            DLR support.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-oracle-includes=</TT
><TT
CLASS="replaceable"
><I
>DIR</I
></TT
>

            Where to look for Oracle OCI-Header files.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-oracle-libs=</TT
><TT
CLASS="replaceable"
><I
>DIR</I
></TT
>

            Where to look for Oracle OCI-Library files.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-redis</TT
>
                
            Enable using Redis for DBPool and DLR support. Requires the hiredis library.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-redis-dir=</TT
><TT
CLASS="replaceable"
><I
>DIR</I
></TT
>
                
                Where to look for the hiredis library and header files.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-cassandra</TT
>
                
            Enable using Cassandra for DBPool and DLR support. Requires the DataStax C/C++ driver for 
            Apache Cassandra.</P
></LI
><LI
><P
><TT
CLASS="literal"
>--with-cassandra-dir=</TT
><TT
CLASS="replaceable"
><I
>DIR</I
></TT
>
                
                Where to look for the DataStax C/C++ Cassandra library and header files.</P
></LI
></UL
>
	</P
><P
>You may need to add compilations flags to configure:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	CFLAGS='-pthread' ./configure
	</KBD
></PRE
>

	The above, for instance, seems to be required on FreeBSD. If you
	want to develop Kannel, you probably want to add CFLAGS that make
	your compiler use warning messages. For example, for GCC:
	
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	CFLAGS='-Wall -O2 -g' ./configure
	</KBD
></PRE
>
	
	(You may, at your preference, use even stricter checking options.)
	</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN331"
>Installing the gateway</A
></H2
><P
>After you have compiled Kannel, you need to install
	certain programs in a suitable place. This is most easily
	done by using <B
CLASS="command"
>make</B
> again:
	
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	make bindir=<TT
CLASS="replaceable"
><I
>/path/to/directory</I
></TT
> install
	</KBD
></PRE
>

	Replace <TT
CLASS="replaceable"
><I
>/path/to/directory</I
></TT
> with the
	pathname of the actual directory where the programs should be
	installed. The programs that are installed are (as filenames
	from the root of the source directory):
	
	<P
></P
><TABLE
BORDER="0"
><TBODY
><TR
><TD
><TT
CLASS="filename"
>gw/bearerbox</TT
></TD
></TR
><TR
><TD
><TT
CLASS="filename"
>gw/smsbox</TT
></TD
></TR
><TR
><TD
><TT
CLASS="filename"
>gw/wapbox</TT
></TD
></TR
></TBODY
></TABLE
><P
></P
>
	
	The version number of the gateway is added to the file names
	during installation. This makes it easier to have several
	versions installed, and makes it easy to go back to an older
	version if the new version proves problematic.</P
><P
>Kannel consists of three programs called boxes: the
	bearer box is the interface towards the phones. It accepts
	WAP and SMS messages from the phones and sends them to the
	other boxes. The SMS box handles SMS gateway functionality,
	and the WAP box handles WAP gateway functionality. There can
	be several SMS boxes and several WAP boxes running and they
	don't have to run on the same host. This makes it possible
	to handle much larger loads.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN347"
>Using pre-compiled binary packages</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
NAME="AEN349"
>Installing Kannel from RPM packages</A
></H3
><P
>This chapter explains how to install, upgrade and remove
	Kannel binary RPM packages.</P
><P
>Before you install Kannel, check that you have libxml2
	installed on your system:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	rpm -q libxml2
	</KBD
></PRE
><P
>Installing Kannel</P
><P
>1. Download the binary RPM packet from the Kannel
	web site.</P
><P
>2. Install the RPM package:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	rpm -ivh kannel-<TT
CLASS="replaceable"
><I
>VERSION</I
></TT
>.<TT
CLASS="replaceable"
><I
>i386</I
></TT
>.rpm
	</KBD
></PRE
>
	</P
><P
>Upgrading Kannel</P
><P
>1. Download the binary RPM packet from the Kannel
        web site.</P
><P
>2. Upgrade the RPM package:

        <PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	rpm -Uvh kannel-<TT
CLASS="replaceable"
><I
>VERSION</I
></TT
>.<TT
CLASS="replaceable"
><I
>i386</I
></TT
>.rpm
	</KBD
></PRE
>
        </P
><P
>Removing Kannel</P
><P
>1. Remove the RPM package:
	
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	rpm -e kannel
	</KBD
></PRE
>
	</P
><P
>After you have installed Kannel from the RPM packages you
	should now be able to run the Kannel init.d script that will
	start Kannel as a WAP gateway. Run the script as root.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/rc.d/init.d/kannel start
	</KBD
></PRE
><P
>To stop the gateway just run the same script with the
	stop parameter.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/rc.d/init.d/kannel stop
	</KBD
></PRE
><P
>If Kannel is already running and you just want to quickly
	stop and start the gateway,e.g.to set a new configuration option,
	run the script with the restart parameter.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/rc.d/init.d/kannel restart
	</KBD
></PRE
><P
>If you want Kannel to run as a daemon, you need to add a
	symbolic link to the Kannel script from the runlevel you want
	Kannel to run in. E.g. to run Kannel in runlevel 5 add symbolic
	links to /etc/rc.d/rc5.d/.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	cd /etc/rc.d/rc5.d/
	ln -s ../init.d/kannel S91kannel
	ln -s ../init.d/kannel K91kannel
	</KBD
></PRE
><P
>To run Kannel as a SMS gateway you need to edit the
	configuration file which is at /etc/kannel/kannel.conf.
	In Kannel's documentation directory 
	(<TT
CLASS="filename"
>/usr/share/doc/kannel</TT
>) 
	there is an example file called examples/smskannel.conf. 
	It has some basic examples of the configuration groups needed 
	to run Kannel as a SMS gateway. For more detailed information 
	please see <TT
CLASS="filename"
>examples/kannel.conf</TT
> in the
	same directory for a commented complete example, and read the 
	section "SMS gateway configuration" later in this same 
	document.</P
><P
>The logging is disabled by default and you can enable
	it from the kannel.conf file. Just add the log-file option
	to the group of which box you want to log.</P
><P
>The documentation will be installed at 
	/usr/doc/kannel-VERSION/ or /usr/share/doc/kannel-VERSION/
	depending on if you used the RedHat 6.x or a 7.x or newer 
	package.</P
><P
>In the Kannel documentation directory there is a HTML
	file called control.html. It is an example file that shows
	how to use the Kannel HTTP administration interface. It
	also has a template for sending SMS messages.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN391"
>Installing Kannel from DEB packages</A
></H3
><P
>This chapter explains how to install, upgrade and remove
	Kannel binary DEB packages.</P
><P
>Kannel's packages are available on main Debian repository 
	(<A
HREF="http://packages.debian.org/kannel"
TARGET="_top"
>http://packages.debian.org/kannel</A
>)
	although that version may be out-of-sync with latest Kannel version.
	</P
><P
>Before you install Kannel, check that you have libxml2
	installed on your system:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	dpkg -l libxml2
	</KBD
></PRE
><P
>Installing or upgrading Kannel from Debian or Kannel repository</P
><P
>1. Install or upgrade the package:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	apt-get install kannel
	</KBD
></PRE
>
	</P
><P
>See http://kannel.org/download.shtml#debian_repository for 
	information about kannel repository sources.list</P
><P
>Installing or upgrading Kannel from a file</P
><P
>1. Download the binary DEB packet from the Kannel
	web site.</P
><P
>2. Log in as root:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	su -
	</KBD
></PRE
><P
>3. Install or upgrade the DEB package:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	dpkg -i kannel-<TT
CLASS="replaceable"
><I
>VERSION</I
></TT
>.deb
	</KBD
></PRE
><P
>Removing Kannel</P
><P
>1. Log in as root:</P
><P
>2. Remove the package keeping configuration files:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	dpkg --remove kannel
	</KBD
></PRE
><P
>3. Remove the package completely:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	dpkg --purge kannel
	</KBD
></PRE
><P
>After you have installed Kannel from the DEB packages you
	should now be able to run the Kannel init.d script that will
	start Kannel as a WAP gateway. Run the script as root.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/init.d/kannel start
	</KBD
></PRE
><P
>To stop the gateway just run the same script with the
	stop parameter.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/init.d/kannel stop
	</KBD
></PRE
><P
>If Kannel is already running and you just want to quickly
	stop and start the gateway,e.g.to set a new configuration option,
	run the script with the restart parameter.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/etc/init.d/kannel restart
	</KBD
></PRE
><P
>If you don't want Kannel to run as a daemon, 
	run: </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	update-rc.d -f kannel remove
	</KBD
></PRE
><P
>If you want to restore Kannel running as a daemon, you 
	need to add a
	symbolic link to the Kannel script from the runlevel you want
	Kannel to run in. E.g. to run Kannel in default runlevel, 
	just run: </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	update-rc.d kannel defaults
	</KBD
></PRE
><P
>Kannel package starts by default with a wapbox daemon.
	To activate smsbox or select which box you want to start, 
	edit /etc/default/kannel and comment/uncomment START_xxxBOX.
	</P
><P
>To run Kannel as a SMS gateway you need to edit the
	configuration file which is at /etc/kannel/kannel.conf.
	In /usr/share/docs/kannel/examples/ there are example files. 
	They have some basic examples of the configuration groups 
	needed to run Kannel as a SMS gateway. For
	more detailed information please read the section "SMS gateway
	configuration" later in this same document.</P
><P
>The documentation will be installed at 
	/usr/share/doc/kannel/.</P
><P
>In the Kannel documentation directory there is a html
	file called control.html. It is an example file that shows
	how to use the Kannel HTTP administration interface. It
	also has a template for sending SMS messages.</P
><P
>Additionally to kannel-VERSION.deb, there's now an optional
	kannel-docs-VERSION.deb with documentation (userguide et al) and
	a kannel-extras-VERSION.deb with contrib and test stuff.</P
><P
>If you want to test development version, use the packages
	called kannel-devel-*.deb.</P
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="AEN442"
></A
>Chapter 3. Using the gateway</H1
><P
>This chapter explains how the gateway core, bearerbox,
        is configured and used.
	It covers the configuration file, keeping an eye on the gateway
	while it is running, and using the HTTP interface to control
	the gateway.</P
><P
>After this chapter there is distinct chapter for each
        kind of gateway use: WAP gateway, SMS gateway and WAP Push
        proxy. These chapters explain the configuration and other
        aspects of gateway of that type.</P
><P
>You can configure your Kannel to be only a WAP or a SMS
	gateway, or to be both at the same time. You just need to read
	each chapter and combine all configurations.</P
><P
>There is only one configuration file for all parts of
	Kannel, although when Kannel is distributed to several hosts
	some lines from the configuration file can be removed in some
	hosts.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN448"
>Configuring the gateway</A
></H2
><P
>The configuration file can be divided into three parts:
	bearerbox configurations, smsbox configurations and
	wapbox configurations. Bearerbox part has one 'core' group
	and any used SMS center groups, while wapbox part has only
	one wapbox group. In smsbox part there is one smsbox group and
	then number of sms-service and sendsms-user groups.</P
><P
>Details of each part are in an appropriate section of this
        documentation. The 'core' group used by the bearerbox is
        explained in this chapter, while 'wapbox' part is in the next
        chapter and 'smsbox', 'smsc' (SMS center), 'sms-service' and
        'sendsms-user' groups are in the SMS Kannel chapter.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN452"
>Configuration file syntax</A
></H3
><P
>A configuration file consists of groups of configuration variables. Groups are
	separated by empty lines, and each variable is defined on its
	own line. Each group in Kannel configuration is distinguished
	with a group variable. Comments are lines that begin with a number sign
	(<TT
CLASS="literal"
>#</TT
>) and are ignored (they don't, for example,
	separate groups of variables).</P
><P
>A variable definition line has the name of the variable,
	and equals sign (<TT
CLASS="literal"
>=</TT
>) and the value of the
	variable. The name of the variable can contain any characters
	except white space and equals. The value of the variable is a
	string, with or without quotation marks (<TT
CLASS="literal"
></TT
>)
	around it. Quotation marks are needed if the variable needs to
	begin or end with white space or contain special
	characters. Normal C 	escape character syntax works inside 
	quotation marks.</P
><P
>Perhaps an example will make things easier to comprehend:

<PRE
CLASS="programlisting"
>&#13;1    # A do-nothing service.
2    group = sms-service
3    keyword = nop
4    text = "You asked nothing and I did it!"
5
6    # Default service.
7    group = sms-service
8    keyword = default
9    text = "No services defined"
</PRE
>

	The above snippet defines the keyword <TT
CLASS="literal"
>nop</TT
>
	for an SMS service, and a default action for situation when
	the keyword in the SMS message does not match any defined
	service.</P
><P
>Lines 1 and 6 are comment lines. Line 5 separates the
	two groups. The remaining lines define variables. The
	group type is defined by the group variable value.</P
><P
>The various variables that are understood in each type
	of configuration group are explained below.</P
><P
>Some variable values are marked as
	<TT
CLASS="literal"
>'bool'</TT
>. The value for variable can be like
	true, false, yes, no, on, off, 0 or 1. Other values are
	treated as 'true' while if the variable is not present at all,
	it is treated as being 'false'.</P
><P
>In order to make some configuration lines more readable
	you may use the delimiter '\' at the end of a line to wrap
	and concatenate the next line up to the current line. Here is 
	an example:

<PRE
CLASS="programlisting"
>&#13;1    # A group with a wrapped alias line
2    group = sms-service
3    keyword = hello
4    aliases = hallo;haalloo;\
5      heelloo;haelloo;healloo
5    text = "Hello world!"
</PRE
>
 
     The above example shows how a list for various alias keywords
     is wrapped to two lines using the line wrap delimiter. In order
     to use the delimiter '\' itself, you need to escape it via a
     prefixed '\' itself. So this is '\\' to escape the wrapping
     function and use the character in the string.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="includes"
>Inclusion of configuration files</A
></H3
><P
>A configuration file may contain a special directive 
	called <TT
CLASS="literal"
>include</TT
> to include other 
	file or a directory with files to the configuration 
	processing.</P
><P
>This allows to segment the specific configuration groups
	required for several services and boxes to different files and
	hence to have more control in larger setups.</P
><P
>Here is an example that illustrates the <TT
CLASS="literal"
>include
	</TT
> statement :

<PRE
CLASS="programlisting"
>&#13;group = core
admin-port = 13000
wapbox-port = 13002
admin-password = bar
wdp-interface-name = "*"
log-file = "/var/log/bearerbox.log"
log-level = 1
box-deny-ip = "*.*.*.*"
box-allow-ip = "127.0.0.1"

include = "wapbox.conf"

include = "configurations"
</PRE
>

	Above is the main <TT
CLASS="literal"
>kannel.conf</TT
> configuration
	file that includes the following <TT
CLASS="literal"
>wapbox.conf</TT
>
	file with all required directives for the specific box, and a 
	<TT
CLASS="literal"
>configurations</TT
> directory which may include 
	more files to include.

<PRE
CLASS="programlisting"
>&#13;group = wapbox
bearerbox-host = localhost
log-file = "/var/log/wapbox.log"
log-level = 0
syslog-level = none
</PRE
>


	The above <TT
CLASS="literal"
>include</TT
> statement may be defined
	at any point in the configuration file and at any inclusion 
	depth. Hence you can cascade numerous inclusions if necessary.
	</P
><P
>At process start time inclusion of configuration files 
	breaks if either the included file can not be opened and 
	processed or the included file has been processed already in 
	the stack and a recursive cycling has been detected.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN482"
>Core configuration</A
></H3
><P
>Configuration for Kannel <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>MUST</I
></SPAN
> always
  include a group for general bearerbox configuration. This group is
  named as 'core' in configuration file, and should be the first group
  in the configuration file.</P
><P
>As its simplest form, 'core' group looks like this:

<PRE
CLASS="programlisting"
>&#13;group = core
admin-port = 13000
admin-password = f00bar
</PRE
>

   Naturally this is not sufficient for any real use, as you want to
   use Kannel as an SMS gateway, or WAP gateway, or both. Thus, one or
   more of the optional configuration variables are used. In following
   list (as in any other similar lists), all mandatory variables are
   marked with <TT
CLASS="literal"
>(m)</TT
>, while conditionally mandatory
   (variables which must be set in certain cases) are marked with
   <TT
CLASS="literal"
>(c)</TT
>.</P
><DIV
CLASS="table"
><A
NAME="AEN490"
></A
><P
><B
>Table 3-1. Core Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>core</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>admin-port (m)</TT
></TD
><TD
>port-number</TD
><TD
VALIGN="bottom"
>&#13;        The port number in which the bearerbox listens to HTTP
        administration commands. It is NOT the same as the HTTP
        port of the local HTTP server, just invent any port, but
        it must be over 1023 unless you are running Kannel as a
        root process (not recommended)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>admin-port-ssl (o)</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        If set to true a SSL-enabled administration HTTP server
		  will be used instead of the default insecure plain HTTP
		  server. To access the administration pages you will have
		  to use a HTTP client that is capable of talking to such
		  a server. Use the "https://" scheme to access the
		  secured HTTP server. Defaults to "no".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>admin-password (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         Password for HTTP administration commands (see below)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status-password</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         Password to request Kannel status. If not set, no password is
	 required, and if set, either this or
	 <TT
CLASS="literal"
>admin-password</TT
> can be used
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>admin-deny-ip</TT
></TD
><TD
ROWSPAN="2"
>IP-list</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        These lists can be used to prevent connection from given IP 
  addresses. Each list can have several addresses, separated with    
  semicolons (';'). An asterisk ('*') can be used
        as a wild-card in a place of any ONE number, so *.*.*.*
        matches any IP.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>admin-allow-ip</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-interface (o)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If this is set, the smsbox listener will only bind
        to a specified address. For example: "127.0.0.1".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-port (c)</TT
></TD
><TD
>port-number</TD
><TD
VALIGN="bottom"
>&#13;        This is the port number to which the smsboxes, if any, connect.
        As with admin-port, this can be anything you want. Must be set
        if you want to handle any SMS traffic.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-port-ssl (o)</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;	     If set to true, the smsbox connection module will be SSL-enabled.
		  Your smsboxes will have to connect using SSL to the bearerbox
		  then. This is used to secure communication between bearerbox
		  and smsboxes in case they are in separate networks operated and
		  the TCP communication is not secured on a lower network layer.
		  Defaults to "no".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wapbox-port (c)</TT
></TD
><TD
>port-number</TD
><TD
VALIGN="bottom"
>&#13;        Like smsbox-port, but for wapbox-connections. If not set,
        Kannel cannot handle WAP traffic
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wapbox-port-ssl (o)</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;	     If set to true, the wapbox connection module will be SSL-enabled.
		  Your wapboxes will have to connect using SSL to the bearerbox
		  then. This is used to secure communication between bearerbox
		  and wapboxes in case they are in separate networks operated and
		  the TCP communication is not secured on a lower network layer.
		  Defaults to "no".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>box-deny-ip</TT
></TD
><TD
ROWSPAN="2"
>IP-list</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        These lists can be used to prevent box connections from given IP 
        addresses. Each list can have several addresses, 
        separated with semicolons (';'). An asterisk ('*') can be used
        as a wild-card in place of any ONE number, so *.*.*.*
        matches any IP.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>box-allow-ip</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>udp-deny-ip</TT
></TD
><TD
ROWSPAN="2"
>IP-list</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        These lists can be used to prevent UDP packets from given IP 
        addresses, thus preventing unwanted use of the WAP gateway.
	Used the same way as <TT
CLASS="literal"
>box-deny-ip</TT
> and
	<TT
CLASS="literal"
>box-allow-ip</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>udp-allow-ip</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wdp-interface-name (c)</TT
></TD
><TD
>IP or '*'</TD
><TD
VALIGN="bottom"
>&#13;        If this is set, Kannel listens to WAP UDP packets incoming to
        ports 9200-9208, bound to given IP. If no specific IP is
        needed, use just an asterisk ('*'). If UDP messages are
        listened to, wapbox-port variable MUST be set.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-file</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        A file in which to write a log. This in addition to <TT
CLASS="literal"
>stdout</TT
>
        and any log file defined in command line. Log-file in 'core'
        group is only used by the bearerbox.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-level</TT
></TD
><TD
>number 0..5</TD
><TD
VALIGN="bottom"
>&#13;        Minimum level of log-file events logged. 0 is for 'debug', 1
        'info', 2 'warning, 3 'error' and 4 'panic' (see Command Line
        Options)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        A file in which information about received/sent SMS messages 
        is stored. Access-log in 'core' group is only used by the
        bearerbox.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log-clean</TT
></TD
><TD
>boolean</TD
><TD
VALIGN="bottom"
>&#13;        Indicates if <TT
CLASS="literal"
>access-log</TT
> will contain standard 'markers', 
		  which means the 'Log begins', 'Log ends' markers and the prefixed
		  timestamp. This config directive should be set to 'true' if a custom 
		  logging format is desired without a prefixed default timestamp. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log-format</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;		  String defining a custom log file line format. May use escape codes as defined
		  later on to substitute values of the messages into the log entry. If no
		  custom log format is used the standard format will be:
		  <TT
CLASS="literal"
>"%t %l [SMSC:%i] [SVC:%n] [ACT:%A] [BINF:%B] [FID:%F] [META:%D] [from:%p] [to:%P] 
		           [flags:%m:%c:%M:%C:%d] [msg:%L:%b] [udh:%U:%u]"</TT
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-level</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;	 Messages of this log level or higher will also be
	 sent to syslog, the UNIX system log daemon. If not explicitly
         set with <TT
CLASS="literal"
>syslog-facility</TT
>, it logs under the
         'daemon' category. The default is not to use syslog, and you can
         set that explicitly by setting <TT
CLASS="literal"
>syslog-level</TT
>
	 to 'none'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-facility</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         The syslog facility to send the syslog entries to. The
         default is 'daemon'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>unified-prefix</TT
></TD
><TD
>prefix-list</TD
><TD
VALIGN="bottom"
>&#13;        String to unify received phone numbers, for SMSC routing and
        to ensure that SMS centers can handle them properly. 
        This is applied to 'sender' number when receiving SMS
        messages from SMS Center and for 'receiver' number when
        receiving messages from smsbox (either sendsms message or
         reply to original message). Format is that first comes the
        unified prefix, then all prefixes which are replaced by the
        unified prefix, separated with comma (','). For example,
        for Finland an unified-prefix "+358,00358,0;+,00" should do the trick. 
        If there are several unified prefixes, separate their rules with
        semicolon (';'), like "+35850,050;+35840,040". <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Note
        that prefix routing is next to useless now that there are
        SMSC ID entries. To remove prefixes, use like 
	"-,+35850,050;-,+35840,040".
	</I
></SPAN
>

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        (Deprecated, see <TT
CLASS="literal"
>white-list-sender</TT
>).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        (Deprecated, see <TT
CLASS="literal"
>white-list-sender-regex</TT
>).
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        (Deprecated, see <TT
CLASS="literal"
>black-list-sender</TT
>).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        (Deprecated, see <TT
CLASS="literal"
>black-list-sender-regex</TT
>).
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-sender</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Load a list of accepted senders of SMS messages. If a sender
        of an SMS message is not in this list, any message received
        from the SMS Center, or tried to be delivered to the SMS Center
        is rejected. See notes of phone number
        format from numhash.h header file. NOTE: the system has only
        a precision of last 9 or 18 digits of phone numbers, so
        beware!
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-sender-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A regular expression defining the set of accepted senders.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-sender</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        As white-list-sender, but SMS messages from these sender numbers are
        automatically rejected.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-sender-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A regular expression defining the set of rejected senders.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-receiver</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Load a list of accepted receiver of SMS messages. If a receiver
        of an SMS message is not in this list, any message received
        from the SMS Center, or tried to be delivered to the SMS Center
        is rejected. See notes of phone number
        format from numhash.h header file. NOTE: the system has only
        a precision of last 9 or 18 digits of phone numbers, so
        beware!
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-receiver-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A regular expression defining the set of accepted receivers.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-receiver</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        As white-list, but SMS messages from these receiver numbers are
        automatically rejected.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-receiver-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A regular expression defining the set of rejected receivers.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-type</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        Kannel can use store subsystem that means storing messages
        on hard disk or in a remote key store until they are successfully 
        handled. By using this subsystem, no SMS messages are lost in Kannel even by
        crash, but theoretically some messages can duplicate when
        system is taken down violently. 
        This variable defines a type of backend used for store
        subsystem. Now two types are supported:
        a) file: writes store into one single file
        b) spool: writes store into spool directory (one file for each message)
        c) redis: writes store into a redis key storage. For redis as message storage
           you will need a <TT
CLASS="literal"
>group = redis-connection</TT
> and a
           <TT
CLASS="literal"
>group = store-db</TT
> configuration group that define the
           connection to the redis server and the table name to be used. See file
           <TT
CLASS="literal"
>doc/examples/store-redis.conf</TT
> for an example config
           secttion.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-location</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        Depends on <TT
CLASS="literal"
>store-type</TT
> option used, it is ether file or spool directory,
        or none if redis is used as storage subsystem.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-dump-freq</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        Approximated frequency how often the memory dump of current
        pending messages are stored to store-file, providing something
        has happened. Defaults to 10 seconds if not set.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-host</TT
></TD
><TD
>hostname</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        Enable the use of an HTTP proxy for all HTTP requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-port</TT
></TD
><TD
>port-number</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-exceptions</TT
></TD
><TD
>URL-list</TD
><TD
VALIGN="bottom"
>&#13;         A list of excluded hosts from being used via a
         proxy. Separate each entry with space.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-exceptions-regex</TT
></TD
><TD
>UNIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;         Same as http-proxy-exceptions but match against UNIX regular expression.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-username</TT
></TD
><TD
>username</TD
><TD
VALIGN="bottom"
>&#13;         Username for authenticating proxy use, for proxies that
	 require this.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-proxy-password</TT
></TD
><TD
>URL-list</TD
><TD
VALIGN="bottom"
>&#13;         Password for authenticating proxy use, for proxies that
	 require this.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-client-certkey-file (c)</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;      A PEM encoded SSL certificate and private key file to be used
      with SSL client connections. This certificate is used for
  	   the HTTPS client side only, i.e. for SMS service requests to 
		SSL-enabled HTTP servers. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-server-cert-file (c)</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;      A PEM encoded SSL certificate file to be used with SSL server
		connections. This certificate is used for the HTTPS server
		side only, i.e. for the administration HTTP server and the
		HTTP interface to send SMS messages.
	  </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-server-key-file (c)</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;      A PEM encoded SSL private key file to be used with SSL server
		connections. This key is associated to the specified 
		certificate and is used for the HTTPS server side only.
	  </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-trusted-ca-file</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;     This file contains the certificates Kannel is willing to trust when
     working as a HTTPS client. If this option is not set, certificates
     are not validated and those the identity of the server is not proven.
	  </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-client-cipher-list</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;     Defines the list of encryption suites and ciphers to be used for 
     client side connections. For further details please see
     https://www.openssl.org/docs/manmaster/man1/ciphers.html
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-server-cipher-list</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;     Defines the list of encryption suites and ciphers to be used for 
     server side connections. For further details please see
     https://www.openssl.org/docs/manmaster/man1/ciphers.html
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-storage</TT
></TD
><TD
>type</TD
><TD
VALIGN="bottom"
>&#13;        Defines the way DLRs are stored. Natively in-memory storage is 
        supported, which is very fast, but has no persistancy. This means 
        you will loose all your temporary DLR information on bearebox 
        re-start. In addition a spool directory approach is natively 
        supported, which garantees persistancy with a reasonable 
        performance, depending on your disk IO performance.
        If you have build-in external DLR storage support, i.e. using 
        MySQL you may define here the alternative storage type like 
        <TT
CLASS="literal"
>mysql</TT
>. 
        Supported types are:
        <TT
CLASS="literal"
>internal</TT
>, 
        <TT
CLASS="literal"
>spool</TT
>, 
        <TT
CLASS="literal"
>mysql</TT
>,
        <TT
CLASS="literal"
>pgsql</TT
>,
        <TT
CLASS="literal"
>sdb</TT
>,
        <TT
CLASS="literal"
>mssql</TT
>,
        <TT
CLASS="literal"
>sqlite3</TT
>,
        <TT
CLASS="literal"
>oracle</TT
>,
        <TT
CLASS="literal"
>redis</TT
> and
        <TT
CLASS="literal"
>cassandra</TT
>.
        By default this is set to <TT
CLASS="literal"
>internal</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-spool</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        Depends on <TT
CLASS="literal"
>dlr-storage = spool</TT
> option used, it 
        is the spool directory to use for DLR storage data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>maximum-queue-length</TT
></TD
><TD
>number of messages</TD
><TD
VALIGN="bottom"
>&#13;   	 (Deprecated, see <TT
CLASS="literal"
>sms-incoming-queue-limit</TT
>).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-incoming-queue-limit</TT
></TD
><TD
>number of messages</TD
><TD
VALIGN="bottom"
>&#13;        Set maximum size of incoming message queue. After number of messages
        has hit this value, Kannel began to discard them.
        Value 0 means giving strict priority to outgoing messages. -1,
        default, means that the queue of infinite length is accepted. (This
        works with any normal input, use this variable only when Kannel message
        queues grow very long).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-outgoing-queue-limit</TT
></TD
><TD
>number of messages</TD
><TD
VALIGN="bottom"
>&#13;        Set maximum size of outgoing message queue. After number of messages
        has hit this value, Kannel began to discard them.
        The default value, 1 million, works for most installations.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-max-pending</TT
></TD
><TD
>number of messages</TD
><TD
VALIGN="bottom"
>&#13;        Maximum number of pending messages on the line to smsbox compatible boxes.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-resend-freq</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        Frequency for the SMS resend thread in which temporarily failed or queued messages will be resent.
        Defaults to 60 seconds.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-resend-retry</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        Maximum retry attempts for the temporarily failed messages.
        Defaults to -1, means: unlimited.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-combine-concatenated-mo</TT
></TD
><TD
>boolean</TD
><TD
VALIGN="bottom"
>&#13;        Whether Kannel should attempt to combine concatenated MO SMS
        prior to passing them over to smsbox. Default is true
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-combine-concatenated-mo-timeout</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        How long to wait for all concatenated message parts to arrive before timeouting.
        Default 1800 seconds.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-timeout</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        Sets socket timeout in seconds for outgoing client http
        connections. Optional. Defaults to 240 seconds.
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample more complex 'core' group could be something like
  this:

<PRE
CLASS="programlisting"
>&#13;group = core
admin-port = 13000
admin-password = f00bar
status-password = sTat
admin-deny-ip = "*.*.*.*"
admin-allow-ip = "127.0.0.1;200.100.0.*"
smsbox-port = 13003
wapbox-port = 13004
box-deny-ip = "*.*.*.*"
box-allow-ip = "127.0.0.1;200.100.0.*"
wdp-interface-name = "*"
log-file = "kannel.log"
log-level = 1
access-log = "kannel.access"
unified-prefix = "+358,00358,0;+,00"
white-list = "http://localhost/whitelist.txt"
</PRE
>
  
    </P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN845"
>Running Kannel</A
></H2
><P
>To start the gateway, you need to start each box you need.
	You always need the bearer box, and depending on whether you want
	WAP and SMS gateways you need to start the WAP and SMS boxes. If
	you want, you can run several of them, but we'll explain the
	simple case of only running one each.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN848"
>Starting the gateway</A
></H3
><P
>After you have compiled Kannel and edited configuration file
  for your taste, you can either run Kannel from command line or use
  supplied <TT
CLASS="literal"
>start-stop-daemon</TT
> and
  <TT
CLASS="literal"
>run_kannel_box</TT
> programs to use it as a daemon
  service (more documentation about that later).</P
><P
>If you cannot or do not know how to set up daemon systems or
  just want to test Kannel, you probably want to start it from
  command line. This means that you probably want to have one terminal
  window for each box you want to start (xterm or screen will do
  fine). To start the bearerbox, give the following command:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	./bearerbox -v 1 [config-file]
	</KBD
></PRE
>

  The <CODE
CLASS="option"
>-v 1</CODE
> sets the logging level to
  <TT
CLASS="literal"
>INFO</TT
>. This way, you won't see a large amount of
  debugging output (the default is <TT
CLASS="literal"
>DEBUG</TT
>). Full
  explanation of Kannel command line arguments is below.</P
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>[config-file]</I
></SPAN
> is the name of the
  configuration file you are using with Kannel. The basic distribution
  packet comes with two sample configuration files,
  <TT
CLASS="literal"
>smskannel.conf</TT
> and
  <TT
CLASS="literal"
>wapkannel.conf</TT
> (in <TT
CLASS="literal"
>gw</TT
>
  sub directory), of which the first one is for
  testing out SMS Kannel and the second one for setting up a WAP
  Kannel. Feel free to edit those configuration files to set up your
  own specialized system.</P
><P
>After the bearer box, you can start the WAP box:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	./wapbox -v 1 [config-file]
	</KBD
></PRE
>

  or the SMS box:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	./smsbox -v 1 [config-file]
	</KBD
></PRE
>

  or both, of course. The order does not matter, except that you need
  to start the bearer box before the other boxes. Without the bearer
  box, the other boxes won't even start.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="arguments"
>Command line options</A
></H3
><P
>Bearerbox, smsbox and wapbox each accept certain command line options
   and arguments when they are launched. These arguments are:</P
><DIV
CLASS="table"
><A
NAME="AEN872"
></A
><P
><B
>Table 3-2. Kannel Command Line Options</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
></TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Print the version of the Kannel binary.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--version</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-v &#60;level&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Set verbosity level for stdout (screen) logging. Default is 0,
             which means 'debug'. 1 is 'info, 2 'warning', 3
             'error' and 4 'panic'
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--verbosity &#60;level&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-D &#60;places&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Set debug-places for 'debug' level output.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--debug &#60;places&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-F &#60;file-name&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;              Log to file named file-name, too. Does not overrun or
              affect any log-file defined in configuration file.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--logfile &#60;file-name&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-V &#60;level&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;            Set verbosity level for that extra log-file (default 0,
            which means 'debug'). Does not affect verbosity level of
            the log-file defined in configuration file, not verbosity
            level of the <TT
CLASS="literal"
>stdout</TT
> output.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--fileverbosity &#60;level&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-S</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Start the system initially at SUSPENDED state (see below,
              bearerbox only)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--suspended</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-I</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Start the system initially at ISOLATED state (see below,
              bearerbox only)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--isolated</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-H</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Only try to open HTTP sendsms interface; if it
             fails, only warn about that, do not exit. (smsbox only)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--tryhttp</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-g</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Dump all known config groups and config keys to stdout
             and exit.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--generate</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-u &#60;username&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Change process user-id to the given.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--user &#60;username&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-p &#60;filename&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Write process PID to the given file.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--pid-file &#60;filename&#62;</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-d</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Start process as daemon (detached from a current shell session).
             Note: Process will change CWD (Current working directory) to <TT
CLASS="literal"
>/</TT
>,
                   therefore you should ensure that all paths to binary/config/config-includes are
                   absolute instead of relative.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--daemonize</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-P</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Start watcher process. This process watch a child process and if child process
             crashed will restart them automatically.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--parachute</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-X &#60;scriptname&#62;</TT
></TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;             Execute a given shell script or binary when child process crash detected. This option
             is usable only with <TT
CLASS="literal"
>--parachute/-P</TT
>.
             Script will be executed with 2 arguments:
                 scriptname 'processname' 'respawn-count'.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>--panic-script &#60;scriptname&#62;</TT
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN977"
>Kannel statuses</A
></H3
><P
>In Kannel, there are four states for the program (which
    currently directly only apply to bearerbox):</P
><P
></P
><OL
TYPE="a"
><LI
><P
>&#13;       Running. The gateway accepts, proceeds and relies 
       messages normally. This is the default state for the bearerbox.
     </P
></LI
><LI
><P
>&#13; Suspended. The gateway does not accept any new messages from SMS
   centers nor from UDP ports. Neither does it accept new sms and wapbox
   connections nor sends any messages already in the system
   onward.

     </P
></LI
><LI
><P
>&#13; Isolated. In this state, the gateway does not accept any messages
   from external message providers, which means SMS Centers and UDP
   ports. It still processes any messages in the system and can
   accept new messages from sendsms interface in smsbox.
     </P
></LI
><LI
><P
>&#13;   Full. Gateway does not accept any messages from SMS centers, because 
   <TT
CLASS="literal"
>maximum-queue-length</TT
> is achieved.
     </P
></LI
><LI
><P
>&#13;   Shutdown. When the gateway is brought down, it does not accept any
   new messages from SMS centers and UDP ports, but processes all
   systems already in the system. As soon as any queues are emptied,
   the system exits

   </P
></LI
></OL
><P
>&#13;The state can be changed via HTTP administration interface (see below),
and shutdown can also be initiated via TERM or INT signal from
terminal. In addition, the bearerbox can be started already in
suspended or isolated state with -S or -I command line option, see
above.
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN993"
>HTTP administration</A
></H3
><P
>Kannel can be controlled via an HTTP administration interface. All
commands are done as normal HTTP queries, so they can be easily done
from command line like this:

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	lynx -dump "http://localhost:12345/shutdown?password=bar"
	</KBD
></PRE
>

...in which the '12345' is the configured admin-port in Kannel
configuration file (see above). For most commands, admin-password is required as a
argument as shown above. In addition, HTTP administration can
be denied from certain IP addresses, as explained in configuration
chapter.</P
><P
>Note that you can use these commands with WAP terminal, too, but
if you use it through the same Kannel, replies to various suspend
commands never arrive nor can you restart it via WAP anymore.</P
><DIV
CLASS="table"
><A
NAME="AEN999"
></A
><P
><B
>Table 3-3. Kannel HTTP Administration Commands</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
>status or status.txt</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Get the current status of the gateway in a text version. Tells the current 
	state (see above) and total number of messages relied and queuing 
	in the system right now. Also lists the total number of smsbox
        and wapbox connections. No password required, unless
        <TT
CLASS="literal"
>status-password</TT
> set, in which case either
        that or main admin password must be supplied.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status.html</TT
></TD
><TD
VALIGN="bottom"
>&#13;        HTML version of status
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status.xml</TT
></TD
><TD
VALIGN="bottom"
>&#13;        XML version of status
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status.wml</TT
></TD
><TD
VALIGN="bottom"
>&#13;        WML version of status
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-status or store-status.txt</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Get the current content of the store queue of the gateway 
		  in a text version. No password required, unless
        <TT
CLASS="literal"
>status-password</TT
> set, in which case either
        that or main admin password must be supplied.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-status.html</TT
></TD
><TD
VALIGN="bottom"
>&#13;        HTML version of store-status
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>store-status.xml</TT
></TD
><TD
VALIGN="bottom"
>&#13;        XML version of store-status
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>suspend</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Set Kannel state as 'suspended' (see above). Password
        required.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>isolate</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Set Kannel state as 'isolated' (see above). Password required.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>resume</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Set Kannel state as 'running' if it is suspended or isolated.
        Password required.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>shutdown</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Bring down the gateway, by setting state to 'shutdown'. After
        a shutdown is initiated, there is no other chance to resume
        normal operation. However, 'status' command still works.
        Password required. If shutdown is sent for a second time, the
        gateway is forced down, even if it has still messages in
        queue.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>flush-dlr</TT
></TD
><TD
VALIGN="bottom"
>&#13;        If Kannel state is 'suspended' this will flush all queued DLR
		  messages in the current storage space. Password required.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>start-smsc</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Re-start a single SMSC link. Password required. Additionally
		  the <TT
CLASS="literal"
>smsc</TT
> parameter must be given to identify
 		  which <TT
CLASS="literal"
>smsc-admin-id</TT
> should be re-started.
        The configuration for the SMSC link is re-read from disk before
        the action is performed.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>stop-smsc</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Shutdown a single SMSC link. Password required. Additionally
		  the <TT
CLASS="literal"
>smsc</TT
> parameter must be given (see above).
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>add-smsc</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Adds an SMSC link previously removed or created after the service was
        started. Password required. Additionally the <TT
CLASS="literal"
>smsc</TT
>
        parameter must be given (see above).
    </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>remove-smsc</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Removes an existing SMSC link. Password required. Additionally the
        <TT
CLASS="literal"
>smsc</TT
> parameter must be given (see above). If you
        want a permanent removal, you should also remove the entry from the
        configuration file or it will be recreated after a service restart.
    </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>restart</TT
></TD
><TD
VALIGN="bottom"
>&#13;        This is the hard restarting version, where we fully stop the
        bearerbox and then initiate from ground up.
        Beware that you loose the smsbox connections in such a case.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>graceful-restart</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Re-start bearerbox gracefully, hence only the changes in the
        configuration for the SMSC connections are performed. I.e.
        an added SMSC group will be start, and a removed SMSC group
        will be shutdown and destroyed. Any unchanged SMSC connection
        keeps on running without interruption. Password required.
        This is the soft restarting version, where we keep all internal
        parts of the bearebox running, including the smsbox connections.
        The same graceful restart can be initiated by sending a SIGHUP
        signal to the bearerbox daemon process.
    </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-level</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Set Kannel log-level of log-files while running. This allows
		you to change the current log-level of the log-files on the fly.
		This includes the main event log and the SMSC specific logs, if
		any exist.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reload-lists</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Re-loads the 'white-list' and 'black-list' URLs provided in the
        core group. This allows Kannel to keep running while the remote
        lists change and signal bearerbox to re-load them on the fly.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>remove-message</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Removes the message with the give <TT
CLASS="literal"
>id</TT
> (an UUID)
        from the local storage subsystem.
   </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="wap-gateway"
></A
>Chapter 4. Setting up a WAP gateway</H1
><P
>This chapter tells you how to set Kannel up as a WAP
    gateway.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1098"
>WAP gateway configuration</A
></H2
><P
>To set up a WAP Kannel, you have to edit the 'core' group in the
  configuration file, and define the 'wapbox' group.</P
><P
>You must set following variables for the 'core' group:  
    <TT
CLASS="literal"
>wapbox-port</TT
> and
    <TT
CLASS="literal"
>wdp-interface-name</TT
>. See previous chapter about
    details of these variables.</P
><P
>With standard distribution, a sample configuration file
  <TT
CLASS="literal"
>wapkannel.conf</TT
> is supplied. You may want to take
  a look at that when setting up a WAP Kannel.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1106"
>Wapbox group</A
></H3
><P
>If you have set <TT
CLASS="literal"
>wapbox-port</TT
> variable in the
  'core' configuration group, you <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>MUST</I
></SPAN
> supply
  a 'wapbox' group.</P
><P
>The simplest working 'wapbox' group looks like this:
<PRE
CLASS="programlisting"
>&#13;group = wapbox
bearerbox-host = localhost
</PRE
>

   There is, however, multiple optional variables for the 'wapbox'
   group.</P
><DIV
CLASS="table"
><A
NAME="AEN1113"
></A
><P
><B
>Table 4-1. Wapbox Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>wapbox</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bearerbox-host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        The machine in which the bearerbox is. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>timer-freq</TT
></TD
><TD
>value-in-seconds</TD
><TD
VALIGN="bottom"
>&#13;         The frequency of how often timers are checked out. Default is 1 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-interface-name</TT
></TD
><TD
>IP address</TD
><TD
VALIGN="bottom"
>&#13;         If this is set then Kannel do outgoing HTTP requests
         using this interface.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>map-url</TT
></TD
><TD
>URL-pair</TD
><TD
VALIGN="bottom"
>&#13;        The pair is separated with space.
        Adds a single mapping for the left side URL to the given destination.
        If you append an asterisk `*' to the left side URL, its prefix
        Is matched against the incoming URL. Whenever the prefix matches,
        the URL will be replaced completely by the right side. In addition, if 	  if you append an asterisk to the right side URL, the part
        of the incoming URL coming after the prefix, will be appended
        to the right side URL. Thus, for a line:
                map-url = "http://source/* http://destination/*"
        and an incoming URL of "http://source/some/path", the result
        will be "http://destination/some/path"
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>map-url-max</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        If you need more than one mapping, set this to the highest number
        mapping you need. The default gives you 10 mappings, numbered
        from 0 to 9. Default: 9
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>map-url-0</TT
></TD
><TD
>URL-pair</TD
><TD
VALIGN="bottom"
>&#13;        Adds a mapping for the left side URL to the given destination URL.
        Repeat these lines, with 0 replaced by a number up to map-url-max,
        if you need several mappings.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>device-home</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Adds a mapping for the URL DEVICE:home (as sent by Phone.com browsers)
        to the given destination URL. There is no default mapping.
        NOTE: the mapping is added with both asterisks, as described above
        for the "map-url" setting. Thus, the above example line is
        equivalent to writing
                map-url = "DEVICE:home* http://some.where/*"

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-file</TT
></TD
><TD
>filename</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;       As with bearerbox 'core' group. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-level</TT
></TD
><TD
>number 0..5</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        A file containing all requested URLs from clients while wapbox operation,
        including client IP, HTTP server User-Agent string, HTTP response code, 
        size of reply.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log-clean</TT
></TD
><TD
>boolean</TD
><TD
VALIGN="bottom"
>&#13;        Indicates if <TT
CLASS="literal"
>access-log</TT
> will contain standard 'markers', 
		  which means the 'Log begins', 'Log ends' markers and the prefixed
		  timestamp. This config directive should be set to 'true' if a custom 
		  logging format is desired without a prefixed default timestamp. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log-time</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;          Determine which timezone we use for access logging. Use 'gmt' for GMT time, 
          anything else will use local time. Default is local time.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-level</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;	 Messages of this log level or higher will also be
	 sent to syslog, the UNIX system log daemon. If not explicitly
         set with <TT
CLASS="literal"
>syslog-facility</TT
>, it logs under the
         'daemon' category. The default is not to use syslog, and you can
         set that explicitly by setting <TT
CLASS="literal"
>syslog-level</TT
>
	 to 'none'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-facility</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         The syslog facility to send the syslog entries to. The
         default is 'daemon'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smart-errors</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;	 If set wapbox will return a valid WML deck describing the 
	 error that occurred while processing an WSP request. This may
	 be used to have a smarter gateway and let the user know what
	 happened actually.
	 </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wml-strict</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;	 If set wapbox will use a strict policy in XML parsing the WML
	 deck. If not set it will be more relaxing and let the XML parser
	 recover from parsing errors. This has mainly impacts in how smart
	 the WML deck and it's character set encoding can be adopted, even
	 while you used an encoding that does not fit the XML preamble.
	 BEWARE: This may be a vulnerability in your wapbox for large bogus 
	 WML input. Therefore this defaults to 'yes', strict parsing.
	 is assumed.
	 </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-timeout</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        Sets socket timeout in seconds for outgoing client http
        connections. Optional. Defaults to 240 seconds.
     </TD
></TR
></TBODY
></TABLE
></DIV
><PRE
CLASS="programlisting"
>&#13;</PRE
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1217"
>Running WAP gateway</A
></H2
><P
>WAP Gateway is ran as explained in previous chapter.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1220"
>Checking whether the WAP gateway is alive</A
></H2
><P
>You can check whether the WAP gateway (both the
    bearerbox and the wapbox) is alive by fetching the URL
    <TT
CLASS="literal"
>kannel:alive</TT
>.</P
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="wtls"
></A
>Chapter 5. Setting up wtls security</H1
><P
>This chapter tells you how to set Kannel up to handle wtls traffic.
	</P
><P
><TT
CLASS="literal"
>wtls</TT
> group is optional and single. The prerequisites for this group
		are to have defined a wapbox group, and a pair of SSL certificates
		available. Instructions on how to create self-signed 1024-bit RSA
		certificates are in <A
HREF="#certificates"
>Appendix B</A
>.
	</P
><P
>Current imlementation provides for the following functionality:</P
><P
>&#13;		<P
></P
><OL
TYPE="A"
><LI
><P
>Supported MACs:</P
><P
></P
><UL
><LI
><P
>SHA_0</P
></LI
><LI
><P
>SHA_40</P
></LI
><LI
><P
>SHA_80</P
></LI
><LI
><P
>SHA_NOLIMIT</P
></LI
><LI
><P
>MD5_40</P
></LI
><LI
><P
>MD5_80</P
></LI
><LI
><P
>MD5_NOLIMIT</P
></LI
></UL
><P
>Missing:</P
><P
></P
><UL
><LI
><P
>SHA_XOR_40</P
></LI
></UL
></LI
><LI
><P
>Supported Ciphers:</P
><P
></P
><UL
><LI
><P
>RC5_CBC_40</P
></LI
><LI
><P
>RC5_CBC_56</P
></LI
><LI
><P
>RC5_CBC</P
></LI
><LI
><P
>DES_CBC</P
></LI
><LI
><P
>DES_CBC_40</P
></LI
></UL
><P
>Missing:</P
><P
></P
><UL
><LI
><P
>NULL_bulk</P
></LI
><LI
><P
>TRIPLE_DES_CBC_EDE</P
></LI
><LI
><P
>IDEA_CBC_40</P
></LI
><LI
><P
>IDEA_CBC_56</P
></LI
><LI
><P
>IDEA_CBC</P
></LI
></UL
></LI
><LI
><P
>Supported Keys:</P
><P
></P
><UL
><LI
><P
>RSA_anon</P
></LI
></UL
><P
>Missing:</P
><P
></P
><UL
><LI
><P
>RSA_anon_512</P
></LI
><LI
><P
>RSA_anon_768</P
></LI
><LI
><P
>RSA_NOLIMIT</P
></LI
><LI
><P
>RSA_512</P
></LI
><LI
><P
>RSA_768</P
></LI
><LI
><P
>ECDH_anon</P
></LI
><LI
><P
>ECDH_anon_113</P
></LI
><LI
><P
>ECDH_anon_131</P
></LI
><LI
><P
>ECDH_ECDSA_NOLIMIT</P
></LI
></UL
><P
>Keys might seem a shortcoming, but all mobiles support
					RSA_anon. Some of the other RSA_anon keys (i.e. RSA_anon_512,
					RSA_anon_768) are propably supported as well, just haven't been
					tested yet.</P
></LI
><LI
><P
>All wtls states except:</P
><P
></P
><UL
><LI
><P
>Suspend/Resume wtls session</P
></LI
><LI
><P
>Cipher change when already connected. In practice
							this is handled through another client hello, while
							already connected to the same client</P
></LI
></UL
></LI
></OL
></P
><P
>The simplest working <TT
CLASS="literal"
>wtls</TT
> group looks like this:
<PRE
CLASS="programlisting"
>&#13;group = wtls
certificate-file = /etc/kannel/server.crt
privatekey-file = /etc/kannel/server.key
</PRE
>

	Can also be the same single combined pem file with both certificate and
	privatekey parts. The complete variable list for the <TT
CLASS="literal"
>wtls</TT
> group is:</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1316"
>Wtls configuration</A
></H2
><DIV
CLASS="table"
><A
NAME="AEN1318"
></A
><P
><B
>Table 5-1. Wtls Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>wtls</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>certificate-file (m)</TT
></TD
><TD
><TT
CLASS="literal"
>filename</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Public key SSL certificate.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>privatekey-file (m)</TT
></TD
><TD
><TT
CLASS="literal"
>filename</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Private key SSL certificate.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>privatekey-password (o)</TT
></TD
><TD
><TT
CLASS="literal"
>Phrase</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional. Needed only if private key was created with a passphrase.
     </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="msisdn-provisioning"
></A
>Chapter 6. Setting up MSISDN provisioning for WAP gateway</H1
><P
>This chapter tells you how to set Kannel up to deliver the MSISDN
	 number of the WAP device using the WAP gateway.</P
><P
>Mostly this feature is interested because the WAP protocol stack
	 itself does not provide such a protocol layer bridging of information.
	 In case you want to know which unique MSISDN is used by the WAP device
	 your HTTP application is currently interacting, then you can pick this
	 information from a RADIUS server that is used by a NAS (network access
	 server) for authentication and accounting purposes.
	 </P
><P
>Kannel provides a RADIUS accounting proxy thread inside wapbox
	 which holds a mapping table for the dynamically assigned (DHCP) IP 
	 addresses of the WAP clients and their MSISDN numbers provided to the
	 NAS device.
	 </P
><P
>Beware that you <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>HAVE TO</I
></SPAN
> to be in control of 
	 the NAS to configure it to use Kannel's wapbox as RADIUS accounting 
	 server. You can not use
	 MSISDN provisioning via Kannel's RADIUS accounting proxy if you can
	 not forward the accounting packets to Kannel's accounting proxy thread.
	 So obviously this feature is for operators and people who have dedicated
	 dial-in servers (NAS).
	 </P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1358"
>RADIUS accounting proxy configuration</A
></H2
><P
>To set up the RADIUS accounting proxy thread inside Kannel you 
  have to define a 'radius-acct' group.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1361"
>RADIUS-Acct configuration</A
></H3
><P
>The simplest working 'radius-acct' group looks like this:
<PRE
CLASS="programlisting"
>&#13;group = radius-acct
our-port = 1646
secret-nas = radius
</PRE
>

   This example does not forward any accounting packets to a remote 
	RADIUS server. There is, however, multiple optional variables for 
	the 'radius-acct' group.</P
><DIV
CLASS="table"
><A
NAME="AEN1365"
></A
><P
><B
>Table 6-1. RADIUS-Acct Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>radius-acct</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is mandatory variable if you want to have Kannel's 
		 RADIUS accounting proxy thread to be active inside wapbox.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>secret-nas (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the shared secret between NAS and our RADIUS accounting proxy.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>secret-radius</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the shared secret between our RADIUS accounting proxy and the
		 remote RADIUS server itself in case we are forwarding packets.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-host</TT
></TD
><TD
><TT
CLASS="literal"
>IP address</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the local interface where our-port value will bind
		 to. (defaults to 0.0.0.0)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>remote-host</TT
></TD
><TD
><TT
CLASS="literal"
>FQDN or IP address</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the remote RADIUS server to which we forward the 
		 accounting packets. If none is given, then no forwarding of
		 accounting packets is performed.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-port</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the port to which our RADIUS accounting proxy thread
		 will listen to. (defaults according to RFC2866 to 1813)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>remote-port</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the port to which our RADIUS accounting proxy thread
		 will forward any packets to the remote-host. 
		 (defaults according to RFC2866 to 1813)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>remote-timeout</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies the timeout value in milliseconds for waiting on a 
	    response from the remote RADIUS server.
		 (defaults to 40 msecs.)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>nas-ports</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Specifies how many possible clients can connect simultaneously 
		 to the NAS. This value is used to initialize the mapping hash table.
		 If does not require to be exact, because the table grows automatically
		 if required. (defaults to 30)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>unified-prefix</TT
></TD
><TD
>prefix-list</TD
><TD
VALIGN="bottom"
>&#13;        String to unify provided phone numbers from NAS.
		  Format is that first comes the
        unified prefix, then all prefixes which are replaced by the
        unified prefix, separated with comma (','). For example,
        for Finland an unified-prefix "+358,00358,0;+,00" should do the trick. 
        If there are several unified prefixes, separate their rules with
        semicolon (';'), like "+35850,050;+35840,040".
	  </TD
></TR
></TBODY
></TABLE
></DIV
><PRE
CLASS="programlisting"
>&#13;</PRE
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1434"
>Using the MSISDN provisioning on HTTP server side</A
></H3
><P
>Kannel's wapbox will include a specific HTTP header in the HTTP
  request issued to the URL provided by the WAP client. That HTTP header 
  is <TT
CLASS="literal"
>X-WAP-Network-Client-MSISDN</TT
>. It will carry as value
  the MSISDN of the WAP client if the RADIUS accounting proxy has received
  a valid accounting packet from the NAS that provided the client IP.
  </P
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="sms-gateway"
></A
>Chapter 7. Setting up a SMS Gateway</H1
><P
>This chapter is a more detailed guide on how to set up Kannel as an
    SMS gateway.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1441"
>Required components</A
></H2
><P
>To set up an SMS gateway, you need, in addition to a machine
    running Kannel, access to (an operator's) SMS center, or possibly
    to multiple ones. The list of supported SMS centers and their
    configuration variables is below.</P
><P
>If you do not have such access, you can still
    use Kannel as an SMS gateway via <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>phone-as-SMSC</I
></SPAN
> 
    feature, by using a GSM phone as a virtual SMS center.</P
><P
>In addition to an SMS center (real or virtual), you need some
    server to handle any SMS requests received. This server then has
    simple or more complex cgi-bins, programs or scripts to serve HTTP
    requests generated by Kannel in response to received SMS
    messages. These services can also initiate SMS push via Kannel
    smsbox HTTP sendsms interface.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1447"
>SMS gateway configuration</A
></H2
><P
>To set up a SMS Kannel, you have to edit the 'core' group in the
  configuration file, and define an 'smsbox' group plus one or more
  'sms-service' groups, plus possibly one or more 'sendsms-user' groups.</P
><P
>For the 'core' group, you must set the following variable:  
    <TT
CLASS="literal"
>smsbox-port</TT
>. In addition, you may be interested
    to set <TT
CLASS="literal"
>unified-prefix</TT
>,
    <TT
CLASS="literal"
>white-list</TT
> and/or <TT
CLASS="literal"
>black-list</TT
>
    variables. See above for details of these variables.</P
><P
> A sample configuration file <TT
CLASS="literal"
>smskannel.conf</TT
> 
  is supplied with the standard distribution. You may want to take
  a look at that when setting up an SMS Kannel.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN1457"
>SMS centers</A
></H2
><P
>To set up the SMS center at Kannel, you have to add a 'smsc'
    group into configuration file. 
    This group must include all the data needed to connect
    that SMS center. You may also want to define an ID
    (identification) name for the SMSC, for logging and routing
    purposes.</P
><P
>SMSC ID is an abstract name for the connection. It can be
    anything you like, but you should avoid any special
    characters. You do not need to use ID, but rely on SMS center IP
    address and other information. However, if you use the ID, you do
    not need to re-define sms-services nor routing systems if the IP
    of the SMS Center is changed, for example.</P
><P
>Common 'smsc' group variables are defined in the following
    table. The first two (<TT
CLASS="literal"
>group</TT
> and
    <TT
CLASS="literal"
>smsc</TT
>) are mandatory, but rest can be used if
    needed.</P
><DIV
CLASS="table"
><A
NAME="AEN1464"
></A
><P
><B
>Table 7-1. SMSC Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>smsc</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Identifies the SMS center type. See below
       for a complete list.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        An optional name or id for the smsc. Any string is
        acceptable, but semicolon ';' may cause problems, so avoid
        it and any other special non-alphabet characters. 
        This 'id' is written into log files and can be used to
        route SMS messages, and to specify the used SMS-service. 
        Several SMSCs can have the same id. The name is
        case-insensitive. Note that if SMS Center connection has an
	assigned SMSC ID, it does NOT automatically mean that messages
	with identical SMSC ID are routed to it; instead configuration
	variables <TT
CLASS="literal"
>denied-smsc-id</TT
>, 
	<TT
CLASS="literal"
>allowed-smsc-id</TT
> and
	<TT
CLASS="literal"
>preferred-smsc-id</TT
> is used for that.
	If you want to use Delivery Reports, you must define this.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-admin-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        An optional id for the smsc to be used on administrative
        commands. This allows commands targeted to individual binds
        even if they share the same <TT
CLASS="literal"
>smsc-id</TT
>
        (for load balancing scenarios, for example). Any string is
        acceptable, but semicolon ';' may cause problems, so avoid
        it and any other special non-alphabet characters.
        Several SMSCs can have the same admin-id, though it's not
        recommended. The name is case-insensitive.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>throughput</TT
></TD
><TD
><TT
CLASS="literal"
>float (messages/sec)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        If SMSC requires that Kannel limits the number of messages per second, 
        use this variable. This is considered as active throttling. (optional)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>id-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        SMS messages with SMSC ID equal to any of the IDs in this list
        are never routed to this SMSC. Multiple entries are separated 
        with semicolons (';')
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>id-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        This list is opposite to previous: only SMS messages with SMSC
        ID in this list are ever routed to this SMSC.
        Multiple entries are separated with semicolons (';')
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>preferred-smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>id-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        SMS messages with SMSC ID from this list are sent to this SMSC
        instead than to SMSC without that ID as preferred. Multiple
        entries are separated with semicolons (';')
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes which are accepted to be
        sent through this SMSC. Multiple entries are separated with 
        semicolon (';'). For example, "040;050" prevents sending of
        any SMS message with prefix of 040 or 050 through this SMSC.
	If denied-prefix is unset, only these numbers are allowed. If
	set, number are allowed if present in allowed or not in 
	denied list.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes which are NOT accepted to be
        sent through this SMSC.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>preferred-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        As <TT
CLASS="literal"
>denied-prefix</TT
>, but SMS messages with receiver starting
        with any of these prefixes are preferably sent through this
        SMSC. In a case of multiple preferences, one is selected at random
        (also if there are preferences, SMSC is selected randomly)

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>unified-prefix</TT
></TD
><TD
>prefix-list</TD
><TD
VALIGN="bottom"
>&#13;        String to unify received phone numbers, for SMSC routing and
        to ensure that SMS centers can handle them properly. 
        This is applied to 'sender' number when receiving SMS
        messages from SMS Center and for 'receiver' number when
        receiving messages from smsbox (either sendsms message or
        reply to original message). Format is that first comes the
        unified prefix, then all prefixes which are replaced by the
        unified prefix, separated with comma (','). For example,
        for Finland an unified-prefix "+358,00358,0;+,00" should do the trick. 
        If there are several unified prefixes, separate their rules with
        semicolon (';'), like "+35850,050;+35840,040". <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Note
        that prefix routing is next to useless now that there are
        SMSC ID entries. To remove prefixes, use like 
	     "-,+35850,050;-,+35840,040".
	</I
></SPAN
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-charset</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        As some SMS Centers do not follow the standards in character
        coding, an <TT
CLASS="literal"
>alt-charset</TT
> character conversion is
        presented. This directive acts different for specific SMSC types.
		Please see your SMSC module type you want to use for more details.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-dcs</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional data coding scheme value usage. Sets the 'alt-dcs' value 
	   for the sendsms HTTP interface to a fixed value for each SMS sent 
	   via this SMSC connection. 
	   If equals to yes, uses FX. If equals to no (default), uses 0X.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-host</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional hostname or IP address in which to bind the connection in our
       end. TCP/IP connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-file</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        A file in which to write a log of the given smsc output. Hence
        this allows to log smsc specific entries to a separate file.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-level</TT
></TD
><TD
>number 0..5</TD
><TD
VALIGN="bottom"
>&#13;        Minimum level of log-file events logged. 0 is for 'debug', 1
        'info', 2 'warning, 3 'error' and 4 'panic' (see Command Line
        Options)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reconnect-delay</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;			Number of seconds to wait between single re-connection attempts.
			Hence all SMSC modules should use this value for their 
			re-connect behavior. (Defaults to '10' seconds).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reroute</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;			If set for a smsc group, all inbound messages coming from this smsc
			connection are passed internally	to the outbound routing functions. 
			Hence this messages is not delivered to any connected box for 
			processing. It is passed to the bearerbox routing as if it would
 		   have originated from an externally connected smsbox.
			(Defaults to 'no').
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reroute-smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;			Similar to 'reroute'. Defines the explicit smsc-id 
			the MO message should be passed to for MT traffic. Hence all 
			messages coming from the the configuration group smsc are passed
			to the outbound queue of the specified smsc-id. This allows 
			direct proxying of messages between 2 smsc connections without 
			injecting them to the general	routing procedure in bearerbox.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reroute-receiver</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;			Similar to 'reroute'. Defines the explicit smsc-id routes 
 		   for specific receiver numbers of messages that are coming from this
			smsc connection.
			Format is that first comes the smsc-id to route the message to, then 
			all receiver numbers that should be routed, separated with comma (','). 
			For example, route receivers 111 and 222 to smsc-id A and 333 and 444
			to smsc-id B would look like: "A,111,222; B,333,444".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reroute-receiver-regex</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;            Similar to 'reroute-receiver'. Defines the explicit smsc-id routes 
            for specific receiver number regex patterns of messages that are coming from 
            this smsc connection.
            Format is that first comes the smsc-id to route the message to, then 
            all receiver numbers as regular expressions that should be routed, 
            separated with comma (','). 
            For example, route receivers that start with 1 and 2 to smsc-id A and 
            those that start with 3 and 4 to smsc-id B would look like: 
            "A,^1.*,^2.*; B,^3.*,^4.*". (Please ensure the reserved characters ';' and ','
            are not used in the regular expression to avoid parsing errors).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reroute-dlr</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;                       Indicate whether DLR's should be re-routed too, if one of above reroute
                       rules are enabled. Please note, that SMSC-Module should support DLR sending.
                       At time of writing none of SMSC-Module supports DLR sending.
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-smsc-id-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        SMS messages with SMSC ID equal to any of the IDs in this set of SMSC IDs
        are always routed to this SMSC. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-smsc-id-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        SMS messages with SMSC ID equal to any of the IDs in this set of SMSC IDs
        are never routed to this SMSC. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>preferred-smsc-id-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        SMS messages with SMSC ID in this set of SMSC IDs are sent to this SMSC
        as preferred.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes which are accepted to be
        sent through this SMSC. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes which may not be
        sent through this SMSC. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>preferred-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        As <TT
CLASS="literal"
>denied-prefix-regex</TT
>, but SMS messages with receiver matching 
        any of these prefixes are preferably sent through this
        SMSC. In a case of multiple preferences, one is selected at random.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-sms-octets</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        Maximum allowed octets for this SMSC. If this maximum exceeds Kannel will split
        SMS into multiparts.
        Default: 140
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dead-start</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional, defines if the SMSC connection type is started in disconnected mode (dead).
        This allows SMSC to be connected at a later time with the add-smsc HTTP administration command. 
        If set to 'true' the connection will start as 'dead' and will require a start-smsc command 
        to activate it. Defaults to 'false' if not present.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>instances</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        The number of same instances of this group to be created. This allows to declare
        the config group one time in the configuration and to multiply it by this value
        for the numner of runtime instances. (default: 1)
        </TD
></TR
></TBODY
></TABLE
></DIV
><P
>In addition to these common variables there are several
   variables used by certain SMS center connections. Each currently
   supported SMS center type is explained below, with configuration
   group for each. Note that many of them use variables with same
   name, but most also have some specific variables.</P
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>NOTE: SMS center configuration variables are a bit 
   incomplete, and will be updated as soon as people responsible for
   the protocols are contacted. Meanwhile, please have
   patience.</I
></SPAN
></P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1671"
>Nokia CIMD 1.37 and 2.0</A
></H3
><P
>Support for CIMD 1.37 is quite old and will be removed in a
future version of Kannel.  Please let us know if you still need it.</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = cimd
host = 100.101.102.103
port = 600
smsc-username = foo
smsc-password = bar
</PRE
><P
>The driver for CIMD2 is a "receiving SME" and expects the SMSC
to be configured for that.  It also expects the SMSC to automatically
send stored messages as soon as Kannel logs in (this is the normal
configuration).</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = cimd2
host = 100.101.102.103
port = 600
smsc-username = foo
smsc-password = bar
keepalive = 5 
my-number = "12345"
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN1677"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Machine that runs the SMSC. As IP (100.100.100.100) 
        or hostname (their.machine.here)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Port number in the smsc host machine
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Username in the SMSC machine/connection account
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Password in the SMSC machine needed to contact SMSC
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keepalive</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       SMSC connection will not be left idle for longer than this many
       seconds.  The right value to use depends on how eager the SMSC
       is to close idle connections. If you see many unexplained 
       reconnects, try lowering this value.
       Set it to 0 to disable this feature.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-dlr</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional. If defined, status delivery report requests (DLR) won't be
       requested at all. Some CIMD2 SMSC have prohibited these reports so
       if you are getting error like "Incorrect status report request parameter
       usage", this option is for you. Defaults to "false".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>my-number</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        The number that the SMSC will add in front of the sender number
        of all messages sent from Kannel.  If Kannel is asked to send
        a message, it will remove this prefix from the sender number
        so that the SMSC will add it again.  If the prefix was not present,
        Kannel will log a warning and will not send the sender number.
        If <TT
CLASS="literal"
>my-number</TT
> is not set, or is set
        to <TT
CLASS="literal"
>"never"</TT
>, then Kannel will not send the
        sender number to the SMSC at all.
        If you want Kannel to pass all sender numbers to the SMSC
        unchanged, then just set <TT
CLASS="literal"
>sender-prefix</TT
> to the
        empty string <TT
CLASS="literal"
>""</TT
>.
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional port number in which to bind the connection in our
       end.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1737"
>CMG UCP/EMI 4.0 and 3.5</A
></H3
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>See <A
HREF="#upgrading-notes"
>Appendix A</A
> for changes.</P
></TD
></TR
></TABLE
></DIV
><P
>Kannel supports two types of connections with CMG SMS centers:
  direct TCP/IP connections ( <TT
CLASS="literal"
>emi</TT
>) and ISDN/modem 
  (X.25) connection (<TT
CLASS="literal"
>emi_x25</TT
>).</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
><TT
CLASS="literal"
>emi_x25</TT
> is an old implementation and supports less 
  features than it's IP counterpart. If you still need this module, please tell
  us to <TT
CLASS="literal"
>devel@kannel.org</TT
> so we can fix it.</P
></BLOCKQUOTE
></DIV
><P
>Sample configurations for these are:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = emi
host = 103.102.101.100
port = 6000
smsc-username = foo
smsc-password = bar
keepalive = 55
our-port = 600 (optional bind in our end)
receive-port = 700 (the port in which the SMSC will contact)
idle-timeout = 30

group = smsc
smsc = emi_x25
phone = ...
device = /dev/tty0
smsc-username = foo
smsc-password = bar
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN1751"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (c)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Machine that runs SMSC. As IP (100.100.100.100) 
        or hostname (their.machine.here)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (c)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Port number in the SMSC host machine
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-host</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional alternate Machine that runs SMSC. 
	As IP (100.100.100.100) or hostname (their.machine.here)
	(If undef but exists alt-port, emi2 would try host:alt-port)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional alternate Port number in the SMSC host machine
	(If undef but exists alt-host, emi2 would try alt-host:port)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Username in the SMSC machine/connection account
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Password in the SMSC machine needed to contact SMSC
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>device (c)</TT
></TD
><TD
><TT
CLASS="literal"
>device-name</TT
></TD
><TD
VALIGN="bottom"
>&#13;          The device the modem is connected to, like <TT
CLASS="literal"
>/dev/ttyS0</TT
>.
          ISDN connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>phone (c)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Phone number to dial to, when connecting over a modem to an
       SMS center.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional port number in which to bind the connection in our
     end. TCP/IP connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>our-receiver-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional port number allowing to specify our port when connecting
       an SMSC. TCP/IP connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>receive-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional port number we listen to and to which the SMS center
        connects when it has messages to send. Required if SMS center
	needs one connection to send and other to receive.
	TCP/IP connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>appname</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	    Name of a "Send only" service. Defaults to <TT
CLASS="literal"
>send</TT
>.
		 All outgoing messages are routed through this service.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connect-allow-ip</TT
></TD
><TD
><TT
CLASS="literal"
>IP-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;       If set, only connections from these IP addresses are accepted
       to receive-port. TCP/IP connection only.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>idle-timeout</TT
></TD
><TD
><TT
CLASS="literal"
>number (seconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;      If this option is set to a value larger than 0, then the connection will
      be closed after the configured amount of seconds without activity. This 
      option interacts with the <TT
CLASS="literal"
>keepalive</TT
> configuration option.
      If <TT
CLASS="literal"
>keepalive</TT
> is smaller than <TT
CLASS="literal"
>idle-timeout</TT
>,
      then the connection will never be idle and those this option has no effect.
      If <TT
CLASS="literal"
>keepalive</TT
> is larger than <TT
CLASS="literal"
>idle-timeout</TT
>,
      than <TT
CLASS="literal"
>keepalive</TT
> reopens the connection. This allows one to poll
      for pending mobile originated Short Messages at the SMSC.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keepalive</TT
></TD
><TD
><TT
CLASS="literal"
>number (seconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A keepalive command will be
        sent to the SMSC connection this many seconds after the last
        message. The right value to use depends on how eager the SMSC is
        to close idle connections.  50 seconds is a good guess. If you
        see many unexplained reconnects, try lowering this value. Set it
        to 0 to disable this feature.
	Requires username or my-number to be set.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wait-ack</TT
></TD
><TD
><TT
CLASS="literal"
>number (seconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A message is resent if the acknowledge from SMSC takes more than 
	this time.  Defaults to 60 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wait-ack-expire</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines what kind of action should be taken if the the ack of 
		  a message expires. The options for this value are:
		  0x00 - disconnect/reconnect, (default) 0x01 - as is now, re-queue, 
		  but this could potentially result in the msg arriving twice
		  0x02 - just carry on waiting (given that the wait-ack should never 
		  expire this is the must accurate)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>flow-control</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	This SMSC can support two types of flow control. The first type 
	of flow control is a <TT
CLASS="literal"
>stop-and-wait</TT
> protocol, 
	when this parameter equals to '1'. During the handling of commands, 
	no other commands shall be sent before the a response is received. 
	Any command that is sent before the reception of the response will 
	be discarded.
	The second type of flow control is <TT
CLASS="literal"
>windowing</TT
>,
	when this parameter is unset or equals '0'. In this case a maximum 
	of n commands can be sent before a response is received. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>window</TT
></TD
><TD
><TT
CLASS="literal"
>number (messages)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        When using <TT
CLASS="literal"
>flow-control=0</TT
>, emi works in windowed
        flow control mode. This variable defines the size of the window used
        to send messages. (optional, defaults to the maximum - 100)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>my-number</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        If the large account number is different from the short number, assign
	it with this variable. For example, if short number is 12345 and large account
	is 0100100100101234 (IP+port), set my-number to 12345 and 
	every message received will have that receiver. In addition, if you are bound
	to the SMSC without an explicit login, use this configuration directive to 
	enable keep-alive (OP/31) operations. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-charset</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines which character conversion kludge may be used for this 
		  specific link. Currently implemented alternative charsets are 
		  defined in "alt_charsets.h" and new ones can be added.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>notification-pid</TT
></TD
><TD
><TT
CLASS="literal"
>4 num char.</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Notification PID value. See below for a complete list and other notes.
	Example: 0539
       <A
NAME="notification-pid-note"
HREF="#FTN.notification-pid-note"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>notification-addr</TT
></TD
><TD
><TT
CLASS="literal"
>string (max 16)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Notification Address. Example: 0100110120131234.
       <A
NAME="notification-addr-note"
HREF="#FTN.notification-addr-note"
><SPAN
CLASS="footnote"
>[b]</SPAN
></A
>
     </TD
></TR
></TBODY
><TR
><TD
COLSPAN="3"
>Notes:<BR><A
NAME="FTN.notification-pid-note"
>a. </A
>If you set 
       <TT
CLASS="literal"
>notification-pid</TT
>, you should also set 
       <TT
CLASS="literal"
>notification-addr</TT
>.<BR><A
NAME="FTN.notification-addr-note"
>b. </A
>If you set 
       <TT
CLASS="literal"
>notification-addr</TT
>, you should also set 
       <TT
CLASS="literal"
>notification-pid</TT
>.<BR></TD
></TR
></TABLE
><P
></P
></DIV
><P
>&#13;   You should use <TT
CLASS="literal"
>notification-pid</TT
> and 
   <TT
CLASS="literal"
>notification-addr</TT
> if you need to inform
   your exact "address" to your smsc. For example, if you have a
   <TT
CLASS="literal"
>Multiple-Address (MA)</TT
> account with several
   connections to the same <TT
CLASS="literal"
>short number</TT
>, you may 
   need to tell your smsc to send delivery reports to the exact instance
   that sent the message. This is required because if you send a message
   with instance 1, your instance 2 wouldn't know about it, unless you
   use a shared DB store for delivery reports.
 </P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN1921"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Notification PID Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>0100</TD
><TD
>Mobile Station</TD
></TR
><TR
><TD
>0122</TD
><TD
>Fax Group 3</TD
></TR
><TR
><TD
>0131</TD
><TD
>X.400</TD
></TR
><TR
><TD
>0138</TD
><TD
>Menu over PSTN</TD
></TR
><TR
><TD
>0139</TD
><TD
>PC appl. over PSTN (E.164)</TD
></TR
><TR
><TD
>0339</TD
><TD
>PC appl. over X.25 (X.121)</TD
></TR
><TR
><TD
>0439</TD
><TD
>PC appl. over ISDN (E.164)</TD
></TR
><TR
><TD
>0539</TD
><TD
>PC appl. over TCP/IP</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN1952"
>SMPP 3.3, 3.4 and 5.0</A
></H3
><P
>This implements Short Message Peer to Peer (SMPP) Protocol
   5.0, with most used support for 3.4 and full support for 3.3. Sample
   configuration:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = smpp
host = 123.123.123.123
port = 600
smsc-username = "STT"
smsc-password = foo
system-type = "VMA"
address-range = ""
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN1956"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Machine that runs SMSC. As IP (100.100.100.100) 
        or hostname (their.machine.here)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The port number for the TRANSMITTER connection to the SMSC. 
       If set, receive-port must be ommited or set to 0.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>use-ssl</TT
></TD
><TD
><TT
CLASS="literal"
>bool</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines whether we should try to bind with SSL enabled connection
        to create a SSMPP (secure SMPP) session.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-client-certkey-file (c)</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;      A PEM encoded SSL certificate and private key file to be used
      for SSL connections. This option is used together with use-ssl
      for client certificate validation with SMPP SMSCs requiring it.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>transceiver-mode</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;       Use a TRANSCEIVER mode connection to the SMSC. 
       It uses the standard transmit 'port' to define the port
       to connect to.
       This is a SMPP 3.4 and 5.0 feature and will not work
       on an earlier SMSC using SMPP 3.3.
       This will do a bind_transceiver only and will not attempt
       to fall back to doing transmit and receive on the same connection.
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>receive-port</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The port number for the RECEIVER connection to the SMSC. 
       If set, port must be ommited or set to 0.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The 'username' of the Messaging Entity connecting to the
       SMSC. If the SMSC operator reports that the "TELEPATH
       SYSTEM MANAGER TERMINAL" view "Control.Apps.View" value 
       "Name:" is "SMPP_ZAPVMA_T" for the transmitter and 
       "SMPP_ZAPVMA_R" for the receiver the smsc-username value 
       is accordingly "SMPP_ZAP". Note that this used to be called
       system-id (the name in SMPP documentation) and has been
       changed to smsc-username to make all Kannel SMS center
       drivers use the same name.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The password matching the "smsc-username" your teleoperator
       provided you with.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>system-type (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional; used to categorize the type of ESME that is binding 
       to the SMSC. Examples include "VMS" (voice mail system) and "OTA" 
       (over-the-air activation system). If not set, defaults to 
       "VMA" (voice mail alerting).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>service-type</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional; if specified, sets the service type for the SMSC. If
       unset, the default service type is used. This may be used to
       influence SMS routing (for example). The SMSC operator may
       also refer to this as the "profile ID". The maximum length of the
       service type is 6, according to the SMPP specification v3.4.
       Defined values are: "CMT" (cellular messaging), "CPT" (cellular
       paging), "VMN" (voice mail notification), "VMA" (voice mail
       alerting), "WAP" (wireless application protocol), "USSD"
       (unstructured supplementary services data), "CBS" (cell broadcast
       service) and "GUTS" (generic UDP transport service). Other values
       may be defined mutually between the SMSC and the ESME application.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>interface-version</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Change the "interface version" parameter sent from Kannel to
       a value other then 0x34 (for SMPP v3.4). The value entered here
       should be the hexadecimal representation of the interface version
       parameter. For example, the default (if not set) is "34" which stands
       for 0x34. For SMPP v3.3 set to "33". For SMPP v5.0 set to "50".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>address-range (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       According to the SMPP 3.4 spec this is supposed to
       affect which MS's can send messages to this account.
       Doesn't seem to work, though.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>my-number</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      	Optional smsc short number. Should be set if smsc sends
	a different one.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>enquire-link-interval</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional the time lapse allowed between operations after which 
      an SMPP entity should interrogate whether it's peer still has an 
      active session. The default is 30 seconds.  
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-pending-submits</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      	Optional the maximum number of outstanding (i.e. acknowledged)
        SMPP operations between an ESME and SMSC. This number
        is not specified explicitly in the SMPP Protocol Specification
        and will be governed by the SMPP implementation on the SMSC.
        As a guideline it is recommended that no more than 10 (default)
        SMPP messages are outstanding at any time.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reconnect-delay</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional the time between attempts to connect an ESME to an SMSC 
      having failed to connect initiating or during an SMPP session. 
		The default is 10 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>source-addr-ton</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, source address TON setting for the link.
		(Defaults to 2).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>source-addr-npi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, source address NPI setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>source-addr-autodetect</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, if defined tries to scan the source address and 
		set TON and NPI settings accordingly. If you don't want to autodetect
		the source address, turn this off, by setting it to no.
		(Defaults to yes).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dest-addr-ton</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, destination address TON setting for the link.
		(Defaults to 2).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dest-addr-npi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, destination address NPI setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bind-addr-ton</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, bind address TON setting for the link.
		(Defaults to 0).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bind-addr-npi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, bind address NPI setting for the link.
		(Defaults to 0).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>msg-id-type</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional, specifies which number base the SMSC is using for the
		 message ID numbers in the corresponding <TT
CLASS="literal"
>submit_sm_resp</TT
> 
		 and <TT
CLASS="literal"
>deliver_sm</TT
> PDUs. This is required to make
		 delivery reports (DLR) work on SMSC that behave differently. The number
		 is a combined set of bit 1 and bit 2 that indicate as follows:
		 bit 1: type for <TT
CLASS="literal"
>submit_sm_resp</TT
>, bit 2: type for 
		 <TT
CLASS="literal"
>deliver_sm</TT
>. If the bit is set then the  value is 
		 in hex otherwise in decimal number base. Which means the following
		 combinations are possible and valid: 
		 0x00 <TT
CLASS="literal"
>deliver_sm</TT
> decimal, 
		 <TT
CLASS="literal"
>submit_sm_resp</TT
> decimal;
		 0x01 <TT
CLASS="literal"
>deliver_sm</TT
> decimal, 
		 <TT
CLASS="literal"
>submit_sm_resp</TT
> hex;
		 0x02 <TT
CLASS="literal"
>deliver_sm</TT
> hex, 
		 <TT
CLASS="literal"
>submit_sm_resp</TT
> decimal;
		 0x03 <TT
CLASS="literal"
>deliver_sm</TT
> hex, 
		 <TT
CLASS="literal"
>submit_sm_resp</TT
> hex. 
		 In accordance to the SMPP v3.4 specs the default will be a C string 
		 literal if no of the above values is explicitly indicated using the 
		 config directive.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-charset</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines which character encoding is used for this specific smsc link. 
		  Uses <TT
CLASS="literal"
>iconv()</TT
> routines to convert from and to that
		  specific character set encoding. See your local iconv_open(3) manual 
		  page for the supported character encodings and the type strings that
		  should be presented for this directive.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-addr-charset</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;            Defines which character encoding is used for alphanumeric addresses.
            When set to <TT
CLASS="literal"
>GSM</TT
>, addresses are converted into the
            GSM 03.38 charset (Since @ is translated into 0x00 which will break
			the SMPP PDU, @ replaced with ?). If set to another value,
            <TT
CLASS="literal"
>iconv()</TT
> is used.
            (Defaults to windows-1252)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>retry</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;            Defines if SMSC should retry to connect even if SMSC sent error that
            username or password is incorrect.
            (Defaults to false)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connection-timeout</TT
></TD
><TD
><TT
CLASS="literal"
>number (seconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        This timer specifies the maximum time lapse allowed 
        between transactions , after which period of inactivity, an SMPP driver may 
        assume that the session is no longer active and does reconnect.
	Defaults to 300 seconds, to disable set it to 0.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wait-ack</TT
></TD
><TD
><TT
CLASS="literal"
>number (seconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A message is resent if the acknowledge from SMSC takes more than 
	this time.  Defaults to 60 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wait-ack-expire</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines what kind of action should be taken if the ack of 
		  a message expires. The options for this value are:
		  0x00 - disconnect/reconnect, (default) 0x01 - as is now, re-queue, 
		  but this could potentially result in the msg arriving twice
		  0x02 - just carry on waiting (given that the wait-ack should never 
		  expire this is the must accurate)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>validityperiod</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	 How long the message will be valid, i.e., how long the SMSC will try
     	 try to send the message to the recipient. Defined in minutes.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>esm-class</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Change the "esm_class" parameter sent from Kannel. 
       Accepted values are 0 (Default SMSC Mode) and 3 (Store and Forward). 
       Defaults to 3.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-format</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Selects which SMPP PDU dump format to use:
       	1 - for multiline (default)
       	2 - for one line
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2175"
>Sema Group SMS2000 OIS 4.0, 5.0 and 5.8</A
></H3
><P
>The 4.0 implementation is over Radio PAD (X.28). Following
   configuration variables are needed, and if you find out the more
   exact meaning, please send a report.</P
><P
>The 5.0 implementation uses X.25 access gateway.</P
><P
>The 5.8 implementation uses direct TCP/IP access interface.</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = sema
device = /dev/tty0
smsc_nua = (X121 smsc address)
home_nua = (x121 radio pad address)
wait_report = 0/1 (0 means false, 1 means true)
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2181"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>device (m)</TT
></TD
><TD
><TT
CLASS="literal"
>device</TT
></TD
><TD
VALIGN="bottom"
>&#13;        ex: /dev/tty0
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc_nua (m)</TT
></TD
><TD
><TT
CLASS="literal"
>X121 smsc address</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The address of an SMSC for SEMA SMS2000 protocols using an
       X.28 connection.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>home_nua (m)</TT
></TD
><TD
><TT
CLASS="literal"
>X121 radio pad address</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The address of a radio PAD implementing Sema SMS2000 using
       X.28 connection.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wait_report</TT
></TD
><TD
><TT
CLASS="literal"
>0 (false)/1 (true)</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Report indicator used by the Sema SMS2000 protocol. Optional.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = ois
host = 103.102.101.100
port = 10000
receive-port = 10000
ois-debug-level = 0
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2214"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>ip</TT
></TD
><TD
VALIGN="bottom"
>&#13;        SMSC Host name or IP
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       SMSC Port number
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>receive-port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The port in which the SMSC will contact
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ois-debug-level</TT
></TD
><TD
><TT
CLASS="literal"
>number 0 to 8</TT
></TD
><TD
VALIGN="bottom"
>&#13;       extra debug, optional, see smsc_ois.c
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = oisd
host = 103.102.101.100
port = 10000
keepalive = 25
my-number = 12345
validityperiod = 30
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2247"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>ip</TT
></TD
><TD
VALIGN="bottom"
>&#13;        SMSC Host name or IP
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       SMSC Port number
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keepalive</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       SMSC connection will not be left idle for longer than this many
       seconds.  The right value to use depends on how eager the SMSC
       is to close idle connections. If you see many unexplained 
       reconnects, try lowering this value.
       Set it to 0 to disable this feature.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>my-number</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Any valid SME number acceptable by SMSC. This number is used only in keepalive request. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>validityperiod</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	 How long the message will be valid, i.e., how long the SMS
	 center (the real one, not the phone acting as one for Kannel)
	 will try to send the message to the recipient. Defined in minutes.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2285"
>SM/ASI (for CriticalPath InVoke SMS Center 4.x)</A
></H3
><P
>This implements Short Message/Advanced Service Interface 
	(SM/ASI) Protocol for the use of connecting to a CriticalPath
	InVoke SMS Center. Sample
   configuration:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = smasi
host = 10.11.12.13
port = 23456
smsc-username = foo
smsc-password = foo
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2289"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Machine that runs SMSC. As IP (10.11.12.13) 
        or hostname (host.foobar.com)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The port number for the connection to the SMSC. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The 'username' of the Messaging Entity connecting to the
       SMSC. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The password matching the "smsc-username" your teleoperator
       provided you with.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reconnect-delay</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, the time between attempts to connect to an SMSC 
      having failed to connect initiating or during an session. 
		The default is 10 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>source-addr-ton</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, source address TON setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>source-addr-npi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, source address NPI setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dest-addr-ton</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, destination address TON setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dest-addr-npi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, destination address NPI setting for the link.
		(Defaults to 1).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>priority</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Optional, sets the default priority of messages transmitted
      over this smsc link.
      (Defaults to 0, which is the lowest priority).
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2357"
>GSM modem</A
></H3
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>See <A
HREF="#upgrading-notes"
>Appendix A</A
> for changes.</P
></TD
></TR
></TABLE
></DIV
><P
>This driver allows a GSM Modem or Phone to be connected to Kannel 
  and work as a virtual SMSC</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = at
modemtype = auto
device = /dev/ttyS0
speed = 9600
pin = 2345
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2364"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>modemtype</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Modems from different manufacturers have slightly different
        behavior. We need to know what type of modem is used. Use "auto"
        or omit parameter to have Kannel detect the modem type automatically.
        (some types should not be auto-detected like the Nokia Premicell).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>device (m)</TT
></TD
><TD
><TT
CLASS="literal"
>device-name</TT
></TD
><TD
VALIGN="bottom"
>&#13;          The device the modem is connected to, like <TT
CLASS="literal"
>/dev/ttyS0</TT
>.
          When the device name is set to <TT
CLASS="literal"
>rawtcp</TT
> or 
          <TT
CLASS="literal"
>telnet</TT
> two other
          variables are required in the configuration: <TT
CLASS="literal"
>host</TT
>
          and <TT
CLASS="literal"
>port</TT
>. See the note below.
      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>speed</TT
></TD
><TD
><TT
CLASS="literal"
>serial speed in bps</TT
></TD
><TD
VALIGN="bottom"
>&#13;          The speed in bits per second. Default value 0 means to try to use
	  speed from modem definition, or if it fails, try to autodetect.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pin</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;         This is the PIN number of the SIM card in the GSM modem. You can specify
         this option if your SIM has never been used before and needs to have
         the PIN number entered. The PIN is usually a four digit number.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>validityperiod</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	 How long the message will be valid, i.e., how long the SMS
	 center (the real one, not the phone acting as one for Kannel)
	 will try to send the message to the recipient. Encoded as per
	 the GSM 03.40 standard, section 9.2.3.12. Default is
	 167, meaning 24 hours.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keepalive</TT
></TD
><TD
><TT
CLASS="literal"
>seconds</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Kannel would "ping" the modem for this many seconds. If the probe fails, 
	try to reconnect to it.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>my-number</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      	Optional phone number.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-center</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;      	SMS Center to send messages.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sim-buffering</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Whether to enable the so-called "SIM buffering behavior" of the GSM module.
                if assigned a true value, the module will query the message storage memory
                of the modem and will process and delete any messages found there. this does
                not alter normal behavior, but only add the capability of reading messages that
                were stored in the memory for some reason. The type of memory to use can be
                selected using the 'message-storage' parameter of the modem configuration.
                Polling the memory is done at the same interval as keepalive (if set) or 60 seconds
                (if not set).
                NOTE: This behavior is known to cause minor or major hiccups for a few buggy modems.
                Modems known to work with this setting are Wavecom WM02/M1200 and the Siemens M20.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-error-count</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;          Maximal error count for opening modem device or initializing of the modem before
          <TT
CLASS="literal"
>reset-string</TT
> will be executed. This is useful when modem crashed and needs
          hard reset. Default disabled.
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>host</TT
></TD
><TD
><TT
CLASS="literal"
>IP address</TT
></TD
><TD
VALIGN="bottom"
>&#13;          Hostname or IP address to connect in <TT
CLASS="literal"
>rawtcp</TT
> mode. 
          Required if <TT
CLASS="literal"
>device</TT
> is set to <TT
CLASS="literal"
>rawtcp</TT
>.
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;          TCP port to connect to on <TT
CLASS="literal"
>rawtcp-host</TT
>.
          Required if <TT
CLASS="literal"
>device</TT
> is set to <TT
CLASS="literal"
>rawtcp</TT
>.
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;          Username to use on a Login: or User: prompt prior to be connected
          to the modem. Useful if modem is connected to a terminal server
          and <TT
CLASS="literal"
>rawtcp</TT
> mode or <TT
CLASS="literal"
>telnet</TT
> mode
          are used.
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;          Username to use on a Password prompt prior to be connected
          to the modem. Useful if modem is connected to a terminal server
          and <TT
CLASS="literal"
>rawtcp</TT
> mode or <TT
CLASS="literal"
>telnet</TT
> mode
          are used. <TT
CLASS="literal"
>smsc-password</TT
> can be used alone
          without <TT
CLASS="literal"
>smsc-username</TT
> for devices only asking for
          a password.
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>login-prompt</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;          An alternative string to be used instead of Login: or Username:
       </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password-prompt</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;           An alternative string to be used instead of Password:
       </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>Modem definitions are now multiple groups present in kannel.conf,
   either directly or, for example, by including the example
   modems.conf. (See <A
HREF="#includes"
><I
>Inclusion of configuration files</I
></A
>)
   </P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2488"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>modems</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	This is the the id that should be used in
	<TT
CLASS="literal"
>modemtype</TT
> variable from AT2
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>name</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	The name of this modem configuration. Used in
	logs
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>detect-string</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	String to use when trying to detect the modem.
	See <TT
CLASS="literal"
>detect-string2</TT
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>detect-string2</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Second string to use to detect the modem. For example,
	if the modem replies with "SIEMENS MODEM M20", 
	<TT
CLASS="literal"
>detect-string</TT
> could be "SIEMENS" 
	and <TT
CLASS="literal"
>detect-string2</TT
> "M20"
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>init-string</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional initialization string. Defaults to
	"AT+CNMI=1,2,0,1,0"
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>speed</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Serial port hint speed to use. Optional. 
	Defaults to smsc group speed or autodetect
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>enable-hwhs</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional AT command to enable hardware handshake.
	Defaults to "AT+IFC=2,2"
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>hardware-flow-control</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optionally disable hardware handshake on the computer side by setting it to false.
	Defaults to true.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>need-sleep</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional. Defaults to false. Some modems needs
	to sleep after opening the serial port and before
	first command
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-pin</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional. Defaults to false. If the modem doesn't
	support the PIN command, enable this
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-smsc</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional. Defaults to false. If the modem doesn't
	support setting the SMSC directly on the PDU, enable
	this. (Default is to include a "00" at the beginning
	of the PDU to say it's the default smsc, and remove
	the "00" when receiving)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendline-sleep</TT
></TD
><TD
><TT
CLASS="literal"
>number (milliseconds)</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional, defaults to 100 milliseconds. The sleep time
	after sending a AT command.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keepalive-cmd</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional, defaults to "AT". If keepalive is activated
	in AT2 group, this is the command to be sent. If your
	modem supports it, for example, use "AT+CBC;+CSQ", and
	see in logs the reply "+CBC: 0,64" (0=On battery, 64% 
	full) and "+CSQ: 14,99" (0-31, 0-7: signal strength and
	channel bit error rate; 99 for unknown). See 3GPP 27007.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>message-storage</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Message storage memory type to enable for "SIM buffering".
                Possible values are: "SM" - SIM card memory or "ME" -
                Mobile equipment memory (may not be supported by your
                modem). check your modem's manual for more types.
                By default, if the option is not set, no message storage command
                will be sent to the modem and the modem's default message
                storage will be used (usually "SM").
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>message-start</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional integer, defaults to 1. Specifies starting index in
                SIM buffer for new SMS. Most modems start numbering from 1,
                however a few like the UMG181 start numbering from 0. This
                parameter ensures that all SMS are fetched when using
                "SIM buffering".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>enable-mms</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;     	Optional, defaults to false. If enabled, Kannel
	would send an AT+CMMS=2 if it have more than one
	message on queue and hopefully will be quicker
	sending the messages.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reset-string</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Which reset string to execute when <TT
CLASS="literal"
>max-error-count</TT
> reached.
        Example for Falcom: AT+CFUN=1
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>A note about delivery reports and GSM modems:</I
></SPAN
>
   while it is possible (and supported) to receive delivery reports on GSM 
   modems, it may not work for you. if you encounter problems, check that your 
   modem's init string (if not the default) is set to correctly allow the modem 
   to send delivery reports using unsolicited notification (check your modem's 
   manual). If the init-string is not set as si, some modems will store delivery 
   reports to SIM memory, to get at which you will need to enable sim-buffering. 
   finally your GSM network provider may not support delivery reports to mobile 
   units.</P
><P
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>About <TT
CLASS="literal"
>rawtcp</TT
> mode:</I
></SPAN
>
   This mode allows you to use a GSM modem connected to a remote terminal server,
   such as Perle IOLAN DS1 or a Cisco router with reverse telnet. The teminal
   server should support raw TCP mode. The driver is not tested in telnet mode.
   It is recommended to use <TT
CLASS="literal"
>keepalive</TT
> variable, in order to 
   automatically reconnect in case of network connectivity problems.</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN2615"
>Modem initialization</A
></H4
><P
>This question has been asked frequently in the users mailing list. 
     It usually comes in two forms:

     <P
></P
><OL
TYPE="1"
><LI
><P
>Modem doesn't receive or transmit SMS.</P
><P
>In its current implementation, the at driver will panic if it
                 cannot find the modem device and bearerbox won't start. This
                 can happen either because the wrong modem device is configured
                 or the device has no write access for kannel's user.</P
><P
> In the first case use system logs to discover where is your
                  modem assigned to:</P
><P
>grep tty /var/log/messages</P
><P
>Then verify that this is indeed your GSM modem device by
                 connecting to it with minicom or wvdial and issuing a few AT
                 commands. Wvdial is preferrable, since it can also give you a
                 working <TT
CLASS="literal"
>init-string</TT
></P
><P
>In the second case you need to give write access to kannel
                 user. This is no problem if you run kannel as root, but it is
                 not recommended to do so. In Ubuntu linux you just need to
                 assign kannel user to group "dial". In other systems you can
                 either:</P
><PRE
CLASS="programlisting"
>chmod 666 /dev/modem</PRE
><P
>or preferably:</P
><PRE
CLASS="programlisting"
>&#13;chmod 664 /dev/modem
chgrp <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>group</I
></SPAN
> /dev/modem
usermod -G <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>group</I
></SPAN
> <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>kannel-user</I
></SPAN
>
           </PRE
></LI
><LI
><P
>Modem doesn't receive DLRs or SMS.</P
><P
>By default the modem doesn't know how to treat incoming
                 messages. To tell it to send it to kannel you have to
                 configure <TT
CLASS="literal"
>init-string</TT
> with the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>&#13;                 +CNMI=x,x,x,x,x</I
></SPAN
> command. X's are decimal numbers
                 and CNMI stands for Command New Message Indication. There is
                 no hard rule about its values. They are model and manufacturer
                 specific. Best to consult modem manual or manufacturer's web
                 site. Failing that, wvdialconf might give a working CNMI.
                 Finally see modems.conf for examples and try out different
                 values. Some Nokia phones do not support this command, but
                 are ready to transmit incoming messages from the start.</P
><P
>Since this setting is modem specific, kannel cannot understand
                 what it means from its value, and if using unconventional
                 values you should tell kannel through <TT
CLASS="literal"
>sim-buffering
                 </TT
> and <TT
CLASS="literal"
> message-storage</TT
>. In any
                 case it is useful to add +CMEE = 1 or 2 in the <TT
CLASS="literal"
>&#13;                 init-string</TT
> in order to make the modem more verbose
                 in its responses.</P
><PRE
CLASS="programlisting"
>&#13;group = modems
init-string = "AT+CNMI=2,3,0,1,0;+CMEE=1"
message-storage = ME or SM    Depending on your modem, you may need to adjust it
...

group = smsc
smsc = at
sim-buffering = true          This will tell kannel to search for messages in
...                           the modem (either memory or its SIM)
           </PRE
></LI
></OL
>
     </P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2643"
>GSMA OneAPI v1.0 ParlayX SMS SOAP</A
></H3
><P
>This implements the GSMA OneAPI v1.0 ParlayX SMS SOAP/XML interface
   in two flavors, the Ericsson SDP (service delivery platform) ParlayX and
   the GSMA OneAPI v1.0 SOAP interfaces.</P
><P
>Example configuration for the Ericsson SDP variant:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = parlayx
system-type = ericsson-sdp
port = 10000
connect-allow-ip = 10.11.12.13
send-url = http://host/location
dlr-url = http://our-host:10000/dlr-location
smsc-username = tester
smsc-password = foobar
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2648"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>system-type (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Type of ParlayX connection. Currently supported are: 
        'oneapi-v1', 'ericsson-sdp'. 
        The variants have the same ParlayX SOAP XML PDUs, but differ in the
        authentication scheme they use, where 'ericsson-sdp' uses WS-Security 
        via wsse and 'oneapi-v1' uses plain HTTP basic authentication.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Port number in which Kannel listens to (MO and DLR) messages 
       from other SOAP service side.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>send-url (m)</TT
></TD
><TD
><TT
CLASS="literal"
>url</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Location of the SOAP service to send MT messages.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url (m)</TT
></TD
><TD
><TT
CLASS="literal"
>url</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Location of our side SOAP service for DLR notifications.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Username associated for the SOAP service connection.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Password associated for the SOAP service username.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>use-ssl</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Defines whether listen port should use SSL.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connect-allow-ip</TT
></TD
><TD
><TT
CLASS="literal"
>IP-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;       IPs allowed to use this SOAP service interface. If not set, 
       "127.0.0.1" (localhost) is the only host allowed to connect.
       Typically you will allow the IP of the other side SOAP service
       here.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>window</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Number of concurrent sending threads. If not set,
      one thread is used.
   </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2710"
>Fake SMSC</A
></H3
><P
>Fake SMSC is a simple protocol to test out Kannel. It is not
  a real SMS center, and cannot be used to send or receive SMS
  messages from real phones. So, it is ONLY used for testing purposes.
  </P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = fake
port = 10000
connect-allow-ip = 127.0.0.1
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2714"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Machine that runs the SMSC. As IP (100.100.100.100) 
        or hostname (their.machine.here)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Port number in smsc host machine
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connect-allow-ip</TT
></TD
><TD
><TT
CLASS="literal"
>IP-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;       If set, only connections from these IP addresses are accepted.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN2740"
>HTTP-based relay and content gateways</A
></H3
><P
>This special "SMSC" is used for HTTP based connections with
   other gateways and various other relay services, when direct SMSC
   is not available.</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = http
system-type = kannel
smsc-username = nork
smsc-password = z0rK
port = 13015
send-url = "http://localhost:20022"
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2744"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>system-type (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Type of HTTP connection. Currently supported are: 'kannel', 
		  'brunet', 'xidris', 'clickatell' and 'generic'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>send-url (m)</TT
></TD
><TD
><TT
CLASS="literal"
>url</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Location to send MT messages. This URL is expanded by used
       system, if need to.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-sender</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Do not add variable sender to the send-url.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-coding</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Do not add variable coding to the send-url.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>no-sep</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Represent udh and text as a numeric string containing the hex-dump. For
      instance, text=%2b123 is represented as text=2b313233. 
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>port (m)</TT
></TD
><TD
><TT
CLASS="literal"
>port-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Port number in which Kannel listens to (MO) messages from other
       gateway
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>use-ssl</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Defines whether listen port should use SSL.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connect-allow-ip</TT
></TD
><TD
><TT
CLASS="literal"
>IP-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;       IPs allowed to use this interface. If not set, "127.0.0.1"
     (localhost) is the only host allowed to connect.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-username</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Username associated to connection, if needed. Kannel requires
       this, and it is the same as send-sms username at other end.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-password</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Password for username, if needed.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-pending-submits</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Optional the maximum number of outstanding (i.e. acknowledged)
       requests. As a guideline it is recommended that no more than
       10 (default) requests are outstanding at any time.
    </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>system-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Clickatell only: API id.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mobile-originated</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;      Clickatell only: 'mo' parameter used for a two-way service (0 or 1).
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>use-post</TT
></TD
><TD
><TT
CLASS="literal"
>boolean</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Generic only: Defines if a HTTP POST method with a content-type
       <TT
CLASS="literal"
>application/x-www-form-urlencoded</TT
> should
       be used rather then the HTTP GET method. If set, both 
       directions will use the HTTP POST method. (Default: no)
   </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN2837"
>The "generic" system-type</A
></H4
><P
>For a generic HTTP-based relay, the system-type 'generic' can be used.
   It can use the escape codes known from sms-service's get-url config
   directives in the send-url string to indicate the HTTP API calling style of
   the remote HTTP server, and the 3 HTTP body response parsing regular
   expressions 'status-success-regex' for successfull acknowledge,
   'status-permfail-regex' for permanent failure and 'status-tempfail-regex'
   for temporary failure. It can also accomodate the incoming parameters and response
   codes and text. This system-type has a lot of extra parameters that gives it a lot
   of flexibility:
   </P
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN2840"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>status-success-regex (o)</TT
></TD
><TD
><TT
CLASS="literal"
>POSIX regular expression</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Regular expression to match against HTTP
       response body content, indicating a successful submission.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status-permfail-regex (o)</TT
></TD
><TD
><TT
CLASS="literal"
>POSIX regular expression</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Regular expression to match against HTTP
       response body content, indicating a permanent failure.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>status-tempfail-regex (o)</TT
></TD
><TD
><TT
CLASS="literal"
>POSIX regular expression</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Regular expression to match against HTTP
       response body content, indicating a temporary failure.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-foreign-id-regex (o)</TT
></TD
><TD
><TT
CLASS="literal"
>POSIX regular expression</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Regular expression to match against HTTP
       response body content to get the foreign message id
       in case of successful submission.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-username (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'username'
       field used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-password (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'password'
       field used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-from (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'from' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-to (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'to' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-text (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'text' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-udh (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'udh' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-service (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'service' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-account (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'account' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-binfo (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'binfo' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-dlr-mask (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'dlr-mask' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-dlr-err (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'dlr-err' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-dlr-url (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'dlr-url' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-dlr-mid (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'dlr-mid' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-flash (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'flash' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-mclass (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'mclass' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-mwi (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'mwi' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-coding (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'coding' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-validity (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'validity' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-deferred (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'deferred' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-foreign-id (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'foreign-id' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-param-meta-data (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the default parameter for the 'meta-data' field
       used on incoming requests.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-message-sent (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       It allows you to set the text returned when a succesful request is made.
       If not set, defaults to 'Sent.'. Note that you can use all sms service escapes
       here, see <A
HREF="#escapecodes"
><I
>Parameters (Escape Codes)</I
></A
> for details.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-status-sent (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the HTTP status code returned when a successful
       request is made. If not set, defaults to 202 (HTTP_ACCEPTED).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>generic-status-error (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Overrides the HTTP status code returned when a request is
       rejected for any reason. If not set, defaults to 202 (HTTP_ACCEPTED).
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>An example for a 'generic' group looks like this:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = http
system-type = generic
port = 13015
send-url = "http://www.foobar.com/mt.php?from=%P&#38;to=%p&#38;text=%b"
status-success-regex = "ok"
status-permfail-regex = "failure"
status-tempfail-regex = "retry later"
generic-foreign-id-regex = "&#60;id&#62;(.+)&#60;/id&#62;"
generic-param-from = "phoneNumber"
generic-param-to = "shortCode"
generic-message-sent = "Message sent with ID: %I"
generic-status-sent = 200
generic-status-error = 404
</PRE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3019"
>Loopback SMSC (MT to MO direction switching)</A
></H3
><P
>This special "SMSC" type can be used to route MT messages in
   bearerbox internally as MO input messages again. Therefore this
   tyoe is the MT wise counterpart of the 'reroute' functionality
   of the smsc group when MOs are re-routed as MTs.</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = loopback
smsc-id = loop1
reroute-smsc-id = my_id
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN3023"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>reroute-smsc-id (o)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Tag the rerouted MO with the given value for smsc-id 
        instead of the canonical smsc-id value of the smsc group 
        itself.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3037"
>Using multiple SMS centers</A
></H3
><P
>If you have several SMS center connections (multiple
    operators or a number of GSM modems) you need to configure one smsc
    group per SMS center (or GSM modem). When doing this, you might
    want to use routing systems to rout messages to specific centers -
    for example, you have 2 operator SMS centers, and the other is
    much faster and cheaper to use.</P
><P
>To set up routing systems, first give an unique ID for each
    SMS center - or if you want to treat multiple ones completely
    identical, give them identical ID. Then use 
    <TT
CLASS="literal"
>preferred-smsc-id</TT
> and
    <TT
CLASS="literal"
>denied-smsc-id</TT
> to set up the routing to your
    taste. See also SMS PUSH settings ('sendsms-user' groups), below.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3043"
>Feature checklist</A
></H3
><P
>Not all of Kannel's SMSC drivers support the same set of features.
This is because they were written at different times, and new features
are often only added to drivers that the feature author can test.</P
><P
>The table in this section is an attempt to show exactly what
features to expect from a driver, and to help identify areas where
drivers need to be updated.  Currently most of the entries are
marked as "not tested" because the table is still new.</P
><DIV
CLASS="table"
><A
NAME="AEN3047"
></A
><P
><B
>Table 7-2. SMSC driver features</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1*"
ALIGN="center"
TITLE="first"><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL
WIDTH="1*"
TITLE="last"><THEAD
><TR
><TH
>Feature</TH
><TH
>cimd</TH
><TH
>cimd2</TH
><TH
>emi</TH
><TH
>emi_x25</TH
><TH
>smpp</TH
><TH
>sema</TH
><TH
>ois</TH
><TH
>oisd</TH
><TH
>at</TH
><TH
>http</TH
><TH
>fake</TH
><TH
>smasi</TH
></TR
></THEAD
><TBODY
><TR
><TD
COLSPAN="13"
>Can use DLR</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set DCS<A
NAME="fields-to-dcs"
HREF="#FTN.fields-to-dcs"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
></TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set Alt-DCS</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set Validity</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set Deferred</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set PID</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set RPI</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can send Unicode</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can send 8 bits</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
></TR
><TR
><TD
COLSPAN="13"
>Correctly send GSM alphabet</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can set binfo / tariff class</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>n</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can use throttling</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y</TD
></TR
></TBODY
><TR
><TD
COLSPAN="13"
>Notes:<BR><A
NAME="FTN.fields-to-dcs"
>a. </A
>To use 
      <TT
CLASS="literal"
>mclass</TT
>, <TT
CLASS="literal"
>mwi</TT
>, <TT
CLASS="literal"
>coding</TT
>
      and <TT
CLASS="literal"
>compress</TT
> fields.<BR></TD
></TR
></TABLE
></DIV
><DIV
CLASS="table"
><A
NAME="AEN3267"
></A
><P
><B
>Table 7-3. SMSC driver internal features</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL
WIDTH="1*"
ALIGN="center"
TITLE="first"><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL><COL
WIDTH="1*"
TITLE="last"><THEAD
><TR
><TH
>Feature</TH
><TH
>cimd</TH
><TH
>cimd2</TH
><TH
>emi2</TH
><TH
>emi_x25</TH
><TH
>smpp</TH
><TH
>sema</TH
><TH
>ois</TH
><TH
>oisd</TH
><TH
>at</TH
><TH
>http</TH
><TH
>fake</TH
><TH
>smasi</TH
></TR
></THEAD
><TBODY
><TR
><TD
COLSPAN="13"
>Can keep idle connections alive</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>?</TD
><TD
>?</TD
><TD
>y</TD
></TR
><TR
><TD
COLSPAN="13"
>Can send octet data without UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y?<A
NAME="nomarkod"
HREF="#FTN.nomarkod"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
></TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can send octet data with UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>N</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>n</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?<A
HREF="#FTN.nomarkod"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
></TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can send text messages with UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive octet data without UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y?<A
NAME="AEN3366"
HREF="#FTN.AEN3366"
><SPAN
CLASS="footnote"
>[b]</SPAN
></A
></TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive Unicode messages</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive octet data with UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>N</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive text messages with UDH</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>n</TD
><TD
>N</TD
><TD
>y</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Correctly encodes <TT
CLASS="literal"
>@</TT
> when sending</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Correctly encodes <TT
CLASS="literal"
>ä</TT
> when sending</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Correctly encodes <TT
CLASS="literal"
>{</TT
> when sending</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>n</TD
><TD
>y</TD
><TD
>N<A
NAME="AEN3472"
HREF="#FTN.AEN3472"
><SPAN
CLASS="footnote"
>[c]</SPAN
></A
></TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive <TT
CLASS="literal"
>@</TT
> in text messages</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive <TT
CLASS="literal"
>ä</TT
> in text messages</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can receive <TT
CLASS="literal"
>{</TT
> in text messages</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>y?</TD
><TD
>y</TD
><TD
>?</TD
><TD
>y?</TD
><TD
>?</TD
><TD
>n</TD
><TD
>y</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>y?</TD
><TD
>?</TD
></TR
><TR
><TD
COLSPAN="13"
>Can shut down idle connections</TD
></TR
><TR
><TD
>&nbsp;</TD
><TD
>n</TD
><TD
>n</TD
><TD
>y</TD
><TD
>n</TD
><TD
>n</TD
><TD
>?</TD
><TD
>?</TD
><TD
>n</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
><TD
>?</TD
></TR
></TBODY
><TR
><TD
COLSPAN="13"
>Notes:<BR><A
NAME="FTN.nomarkod"
>a. </A
>Does not mark it as octet data<BR><A
NAME="FTN.AEN3366"
>b. </A
>However, it looks like the <TT
CLASS="literal"
>sema</TT
> driver can't receive <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>text</I
></SPAN
> data.<BR><A
NAME="FTN.AEN3472"
>c. </A
>Miscalculates message length<BR></TD
></TR
></TABLE
></DIV
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN3544"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL
WIDTH="1*"
ALIGN="left"><COL><THEAD
><TR
><TH
>Symbol</TH
><TH
>Meaning</TH
></TR
></THEAD
><TBODY
><TR
><TD
>?</TD
><TD
>not yet investigated</TD
></TR
><TR
><TD
>y</TD
><TD
>driver has this feature, and it has been tested</TD
></TR
><TR
><TD
>y?</TD
><TD
>driver probably has this feature, has not been tested</TD
></TR
><TR
><TD
>n</TD
><TD
>driver does not have this feature</TD
></TR
><TR
><TD
>N</TD
><TD
>driver claims to have this feature but it doesn't work</TD
></TR
><TR
><TD
>-</TD
><TD
>feature is not applicable for this driver</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN3570"
>External delivery report (DLR) storage</A
></H2
><P
>Delivery reports are supported by default internally, which
	means all DLRs are stored in the memory of the bearerbox process.
	This is problematic if bearerbox crashes or you take the process
	down in a controlled way, but there are still DLRs open. Therefore
	you may use external DLR storage places, i.e. a MySQL database.
	</P
><P
>Following are the supported DLR storage types and how to use
	them:</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3574"
>Internal DLR storage</A
></H3
><P
>This is the default way in handling DLRs and does not
	require any special configuration. In order to configure bearerbox
	to use internal DLR storage use <TT
CLASS="literal"
>dlr-storage = internal</TT
>
	in the <TT
CLASS="literal"
>core</TT
> group.
	</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3579"
>MySQL DLR storage</A
></H3
><P
>To store DLR information into a MySQL database you may use the
	<TT
CLASS="literal"
>dlr-storage = mysql</TT
> configuration directive in the
	<TT
CLASS="literal"
>core</TT
> group.
	</P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
	group defined that specifies the table field names that are used to the
	DLR attributes and a <TT
CLASS="literal"
>mysql-connection</TT
> group that
	defines the connection to the MySQL server itself.
	</P
><P
>Here is the example configuration from
	<TT
CLASS="literal"
>doc/examples/dlr-mysql.conf</TT
>:

<PRE
CLASS="programlisting"
>&#13;group = mysql-connection
id = mydlr
host = localhost
username = foo
password = bar
database = dlr
max-connections = 1

group = dlr-db
id = mydlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

	</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN3590"
>MySQL connection configuration</A
></H4
><P
>For several reasons external storage may be required to 
	handle dynamical issues, i.e. DLRs, sms-service, sendsms-user, 
	ota-setting, ota-bookmark definitions and so on. To define a 
	MySQL database connection you simple need to specify a
	<TT
CLASS="literal"
>mysql-connection</TT
> group as follows:
	</P
><DIV
CLASS="table"
><A
NAME="AEN3594"
></A
><P
><B
>Table 7-4. MySQL Connection Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>mysql-connection</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>id (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	     An optional name or id to identify this MySQL connection
		  for internal reference with other MySQL related configuration
		  groups. Any string is acceptable, but semicolon ';' may cause
		  problems, so avoid it and any other special non-alphabet characters.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
>hostname or IP</TD
><TD
VALIGN="bottom"
>&#13;        Hostname or IP of a server running a MySQL database to connect to.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>username (m)</TT
></TD
><TD
>username</TD
><TD
VALIGN="bottom"
>&#13;        User name for connecting to MySQL database.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password (m)</TT
></TD
><TD
>password</TD
><TD
VALIGN="bottom"
>&#13;        Password for connecting to MySQL database.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>database (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Name of database in MySQL database server to connect to.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-connections</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;        How many connections should be opened to the given database.
        This is used for database pool.
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample 'mysql-connection' group:

<PRE
CLASS="programlisting"
>&#13;group = mysql-connection
id = dlr-db
host = localhost
username = foo
password = bar
database = dlr
max-connections = 1
</PRE
>

  </P
><P
>In case you use different MySQL connections for several storage
  issues, i.e. one for DLR and another different one for sms-service you
  may use the <TT
CLASS="literal"
>include</TT
> configuration statement to extract
  the MySQL related configuration groups to a separate <TT
CLASS="literal"
>mysql.conf
  </TT
> file.
  </P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3645"
>LibSDB DLR storage</A
></H3
><P
>To store DLR information into a LibSDB resource (which is an
	abstraction	of a real database) you may use the
	<TT
CLASS="literal"
>dlr-storage = sdb</TT
> configuration directive in the
	<TT
CLASS="literal"
>core</TT
> group.
	</P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
	group defined that specifies the table field names that are used to the
	DLR attributes and a <TT
CLASS="literal"
>sdb-connection</TT
> group that
	defines the LibSDB resource itself.
	</P
><P
>Here is the example configuration from
	<TT
CLASS="literal"
>doc/examples/dlr-sdb.conf</TT
> using a PostgreSQL resource:

<PRE
CLASS="programlisting"
>&#13;group = sdb-connection
id = pgdlr
url = "postgres:host=localhost:db=myapp:port=1234"
max-connections = 1

group = dlr-db
id = pgdlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

	</P
><P
>Beware that you have the DB support build in your LibSDB
  installation when trying to use a specific DB type within the URL.
  </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3657"
>Oracle 8i/9i DLR storage</A
></H3
><P
>To store DLR information into a Oracle database you may use the
	<TT
CLASS="literal"
>dlr-storage = oracle</TT
> configuration directive in the
	<TT
CLASS="literal"
>core</TT
> group.
	</P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
	group defined that specifies the table field names that are used to the
	DLR attributes and a <TT
CLASS="literal"
>oracle-connection</TT
> group that
	defines the connection to the Oracle server itself.
	</P
><P
>Here is the example configuration from
	<TT
CLASS="literal"
>doc/examples/dlr-oracle.conf</TT
>:

<PRE
CLASS="programlisting"
>&#13;group = oracle-connection
id = mydlr
username = foo
password = bar
tnsname = dlr
max-connections = 1

group = dlr-db
id = mydlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

	</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3668"
>PostgreSQL DLR storage</A
></H3
><P
>To store DLR information into a PostgreSQL database you may use the
	<TT
CLASS="literal"
>dlr-storage = pgsql</TT
> configuration directive in the
	<TT
CLASS="literal"
>core</TT
> group.
	</P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
	group defined that specifies the table field names that are used to the
	DLR attributes and a <TT
CLASS="literal"
>pgsql-connection</TT
> group that
	defines the connection to the PostgreSQL server itself.
	</P
><P
>Here is the example configuration:

<PRE
CLASS="programlisting"
>&#13;group = pgsql-connection
id = mydlr
host = myhost.com
username = foo
password = bar
database = dlr
max-connections = 1

group = dlr-db
id = mydlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

	</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3678"
>MS-SQL/Sybase DLR storage</A
></H3
><P
>To store DLR information into a MS-SQL or Sybase (via FreeTDS)
    database you may use the <TT
CLASS="literal"
>dlr-storage = mssql</TT
>
    configuration directive in the <TT
CLASS="literal"
>core</TT
> group.
    </P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
    group defined that specifies the table field names that are used to the
    DLR attributes and a <TT
CLASS="literal"
>mssql-connection</TT
> group that
    defines the connection to the MS-SQL or Sybase server itself.
    </P
><P
>Please note that the <TT
CLASS="literal"
>server</TT
> configuration directive
    must match the corresponding <TT
CLASS="literal"
>[section]</TT
> on
    <TT
CLASS="literal"
>freetds.conf</TT
></P
><P
>Here is the example configuration:

<PRE
CLASS="programlisting"
>&#13;group = mssql-connection
id = msdlr
server = myservername
username = foo
password = bar
database = dlr
max-connections = 1

group = dlr-db
id = msdlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

    </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3692"
>SQLite3 DLR storage</A
></H3
><P
>To store DLR information into a SQLite3 database you may use the
	<TT
CLASS="literal"
>dlr-storage = sqlite3</TT
> configuration directive in the
	<TT
CLASS="literal"
>core</TT
> group.
	</P
><P
>In addition to that you must have a <TT
CLASS="literal"
>dlr-db</TT
>
	group defined that specifies the table field names that are used to the
	DLR attributes and a <TT
CLASS="literal"
>sqlite3-connection</TT
> group that
	defines the connection to the SQLite3 database itself.
	</P
><P
>Here is the example configuration:

<PRE
CLASS="programlisting"
>&#13;group = sqlite3-connection
id = mydlr
database = /path/to/file
max-connections = 1

group = dlr-db
id = mydlr
table = dlr
field-smsc = smsc
field-timestamp = ts
field-destination = destination
field-source = source
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

	</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3702"
>Redis DLR storage</A
></H3
><P
>To store DLR information using the Redis (http://www.redis.io) keystore, you should set the
            <TT
CLASS="literal"
>dlr-storage = redis</TT
> configuration directive in the
            <TT
CLASS="literal"
>core</TT
> group.
        </P
><P
>In addition, you must have a <TT
CLASS="literal"
>dlr-db</TT
> group defined that specifies 
            the key and hash field names that are used to store the DLR attributes and a 
            <TT
CLASS="literal"
>redis-connection</TT
> group that defines the connection to the Redis server.
        </P
><P
>&#13;            Since Redis is a keystore and not a SQL database, keys and not tables are used to store 
            DLR attributes. For ease of configuration, the same configuration parameters in the <TT
CLASS="literal"
>dlr-db</TT
> 
            group that are used to define SQL tables in other DLR storage engines are used to configure
            key names in Redis. DLRs are stored as Redis hash keys with a separate key 
            for each DLR. Key names are in the format 
            <TT
CLASS="literal"
>&#60;table&#62;:&#60;smsc&#62;:&#60;timestamp&#62;</TT
>. Some SMSCs also append the 
            destination to the DLR keyname resulting DLR keynames in the format 
            <TT
CLASS="literal"
>&#60;table&#62;:&#60;smsc&#62;:&#60;timestamp&#62;:&#60;destination&#62;</TT
>. You can
            specify the <TT
CLASS="literal"
>&#60;table&#62;</TT
> portion of the keyname by specifying the
            <TT
CLASS="literal"
>table</TT
> value in the <TT
CLASS="literal"
>dlr-db</TT
> group.</P
><P
>&#13;            In addition to one key per DLR, an additional key with a name in the format
            <TT
CLASS="literal"
>&#60;table&#62;:Count</TT
> is created to maintain a count of the total
            number of outstanding DLRs.
        </P
><P
>Here is the example configuration from
            <TT
CLASS="literal"
>doc/examples/dlr-redis.conf</TT
>:
            
            <PRE
CLASS="programlisting"
>&#13;                group = redis-connection
                id = mydlr
                host = localhost
                port = 6379
                #password = foo
                database = 2
                idle-timeout = 3600
                max-connections = 1
                
                group = dlr-db
                id = mydlr
                ttl = 604800
                table = dlr
                field-smsc = smsc
                field-timestamp = ts
                field-destination = destination
                field-source = source
                field-service = service
                field-url = url
                field-mask = mask
                field-status = status
                field-boxc-id = boxc
            </PRE
>
            
        </P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN3722"
>Redis connection configuration</A
></H4
><P
>To define a Redis connection you need to specify a
                <TT
CLASS="literal"
>redis-connection</TT
> group as follows:
            </P
><DIV
CLASS="table"
><A
NAME="AEN3726"
></A
><P
><B
>Table 7-5. Redis Connection Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>redis-connection</TT
></TD
><TD
VALIGN="bottom"
>&#13;                                This is a mandatory variable
                            </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>id (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;                                An optional name or id to identify this Redis connection
                                for internal reference with other Redis related configuration
                                groups. Any string is acceptable, but semicolon ';' may cause
                                problems, so avoid it and any other special non-alphabet characters.
                            </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>host (m)</TT
></TD
><TD
>hostname or IP</TD
><TD
VALIGN="bottom"
>&#13;                                Hostname or IP of a server running Redis to connect to.
                            </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password</TT
></TD
><TD
>password</TD
><TD
VALIGN="bottom"
>&#13;                                If the Redis server is secured with a password in redis.conf, it must be 
                                specified here. By default, Redis servers are unsecured and in that case,
                                this parameter may be ommitted.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>database</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;                                The numeric ID (0-15) of the Redis database to use. Ideally this database
                                should be dedicated to storing Redis DLRs since a separate key wil be created
                                for each DLR. If this variable is ommitted, the default database (0) will be used.
                            </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>idle-timeout</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;                                The number of seconds that Redis should hold the connection open without any
                                traffic. Some Redis servers are configured to disconnect idle clients very
                                quickly, and if this is the case you should set this value to something more
                                reasonable. If ommitted, the Redis server-wide timeout from redis.conf will 
                                apply.
                            </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-connections</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;                                How many connections should be opened to the Redis server.
                            </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3772"
>Cassandra DLR storage</A
></H3
><P
>To store DLR information using Cassandra (http://cassandra.apache.org/) database, you should set the
            <TT
CLASS="literal"
>dlr-storage = cassandra</TT
> configuration directive in the
            <TT
CLASS="literal"
>core</TT
> group.
        </P
><P
>In addition, you must have a <TT
CLASS="literal"
>dlr-db</TT
> group defined that specifies 
            the field names that are used to store the DLR attributes and a 
            <TT
CLASS="literal"
>cassandra-connection</TT
> group that defines the connection to Cassandra.
        </P
><P
>Here is the example configuration from
            <TT
CLASS="literal"
>doc/examples/dlr-cassandra.conf</TT
>:
            
            <PRE
CLASS="programlisting"
>&#13;                group = cassandra-connection
                id = mydlr
                host = localhost
                #username = foo
                #password = bar
                #database = dlr
                max-connections = 1
                
                group = dlr-db
                id = mydlr
                ttl = 604800
                table = dlr
                field-smsc = smsc
                field-timestamp = ts
                field-destination = destination
                field-source = source
                field-service = service
                field-url = url
                field-mask = mask
                field-status = status
                field-boxc-id = boxc
            </PRE
>
            
        </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN3783"
>DLR database field configuration</A
></H3
><P
>For external database storage of DLR information in relational
	database management systems (RDBMS) you will have to specify which table
	field are used to represent the stored data. This is done via the
	<TT
CLASS="literal"
>dlr-db</TT
> group as follows:
	</P
><DIV
CLASS="table"
><A
NAME="AEN3787"
></A
><P
><B
>Table 7-6. DLR Database Field Configuration Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>dlr-db</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>id (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	     An id to identify which external connection should be used for
 		  DLR storage. Any string is acceptable, but semicolon ';' may cause
		  problems, so avoid it and any other special non-alphabet characters.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>table (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The name of the table that is used to store the DLR information.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-smsc (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the smsc data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-timestamp (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the timestamp data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-destination (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the destination number data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-source (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the source number data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-service (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the service username data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-url (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the DLR URL which is triggered
		  when the DLR for this message arrives from the SMSC.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-mask (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used for the DLR mask that has been set
		  for a message.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-status (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used to reflect the status of the DLR
		  for a specific message.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>field-boxc-id (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        The table field that is used to store the smsbox connection id
		  that has passed the message for delivery. This is required in 
		  cases you want to guarantee that DLR messages are routed back to
		  the same smsbox conn instance. This is done via the smsbox routing.
		  If you don't use smsbox routing simply add this field to your
		  database table and keep it empty.
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample 'dlr-db' group:

<PRE
CLASS="programlisting"
>&#13;group = dlr-db
id = dlr-db
table = dlr
field-smsc = smsc
field-timestamp = ts
field-source = source
field-destination = destination
field-service = service
field-url = url
field-mask = mask
field-status = status
field-boxc-id = boxc
</PRE
>

  </P
><P
>Beware that all variables in this group are mandatory, so you
  have to specify all fields to enable bearerbox to know how to store
  and retrieve the DLR information from the external storage spaces.
  </P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN3861"
>SMSBox configuration</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
NAME="AEN3863"
>Smsbox group</A
></H3
><P
>You must define an 'smsbox' group into the configuration file to be
  able to use SMS Kannel. The simplest working 'smsbox' group looks 
   like this:

<PRE
CLASS="programlisting"
>&#13;group = smsbox
bearerbox-host = localhost
</PRE
>

   ...but you would most probably want to define 'sendsms-port' to be
   able to use SMS push.</P
><P
>SMSBox inherits from core the following fields:
<PRE
CLASS="programlisting"
>&#13;smsbox-port
http-proxy-port
http-proxy-host
http-proxy-username
http-proxy-password
http-proxy-exceptions
http-proxy-exceptions-regex
ssl-certkey-file
</PRE
>
   </P
><DIV
CLASS="table"
><A
NAME="AEN3869"
></A
><P
><B
>Table 7-7. Smsbox Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>smsbox</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bearerbox-host (m)</TT
></TD
><TD
><TT
CLASS="literal"
>hostname</TT
></TD
><TD
VALIGN="bottom"
>&#13;        The machine in which the bearerbox is. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bearerbox-port (o)</TT
></TD
><TD
>port-number</TD
><TD
VALIGN="bottom"
>&#13;        This is the port number to which smsbox will connect bearerbox.
        If not given <TT
CLASS="literal"
>smsbox-port</TT
> from core group used.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bearerbox-port-ssl (o)</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;         If set to true, the smsbox connection will be SSL-enabled.
	 Your smsbox will connect using SSL to the bearerbox
	 then. This is used to secure communication between bearerbox
	 and smsboxes in case they are in separate networks operated and
	 the TCP communication is not secured on a lower network layer.
         If not given <TT
CLASS="literal"
>smsbox-port-ssl</TT
> from core group used.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-id (o)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Optional smsbox instance identifier. This is used to 
 		  identify an smsbox connected to an bearerbox for the purpose
		  of having smsbox specific routing inside bearerbox. So if you
		  you own boxes that do pass messages into bearerbox for delivery
		  you may want that answers to those are routed back to your 
		  specific smsbox instance, i.e. SMPP or EMI proxying boxes.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendsms-interface (o)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If this is set, the sendsms HTTP interface will only bind
        to a specified address. For example: "127.0.0.1".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendsms-port (c)</TT
></TD
><TD
>port-number</TD
><TD
VALIGN="bottom"
>&#13;        The port in which any sendsms HTTP requests are done. As with
        other ports in Kannel, can be set as anything desired.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendsms-port-ssl (o)</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        If set to true, the sendsms HTTP interface will use a
		  SSL-enabled HTTP server with the specified 
		  ssl-server-cert-file and ssl-server-key-file from the 
		  core group. Defaults to "no".
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendsms-url (o)</TT
></TD
><TD
>url</TD
><TD
VALIGN="bottom"
>&#13;	     URL locating the sendsms service. Defaults to <TT
CLASS="literal"
>&#13;        /cgi-bin/sendsms</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendota-url (o)</TT
></TD
><TD
>url</TD
><TD
VALIGN="bottom"
>&#13;	     URL locating the sendota service. Defaults to <TT
CLASS="literal"
>&#13;        /cgi-bin/sendota</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>immediate-sendsms-reply (o)</TT
></TD
><TD
>boolean</TD
><TD
VALIGN="bottom"
>&#13;        This is a backward compatibility flag: when set, Kannel will 
        immediately answer to any sendsms requests, without knowing if
        the bearerbox will ever accept the message. If set to false
       (default), smsbox will not reply to HTTP request until the bearerbox
        has received the message.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sendsms-chars</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Only these characters are allowed in 'to' field when send-SMS
        service is requested via HTTP. Naturally, you should allow 
        at least <TT
CLASS="literal"
>0123456789</TT
>. The
        <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>space</I
></SPAN
> character (' ') has special
        meaning: it is used to separate multiple phone numbers from
        each other in multi-send. To disable this feature, do not have
        it as an accepted character. If this variable is
        not set, the default set <TT
CLASS="literal"
>"0123456789 +-"</TT
> is used.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>global-sender</TT
></TD
><TD
>phone-number</TD
><TD
VALIGN="bottom"
>&#13;        If set, all sendsms originators are set as these before
        proceeding. Note that in a case of most SMS centers you
        cannot set the sender number, but it is automatically set
        as the number of SMSC
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-file</TT
></TD
><TD
>filename</TD
><TD
ROWSPAN="3"
VALIGN="bottom"
>&#13;       As with the bearerbox 'core' group. Access-log is used to store
       information about MO and send-sms requests. Can be named same as the 
       'main' access-log (in 'core' group).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>log-level</TT
></TD
><TD
>number 0..5</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>access-log</TT
></TD
><TD
>filename</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-level</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;	 Messages of this log level or higher will also be
	 sent to syslog, the UNIX system log daemon. If not explicitly
         set with <TT
CLASS="literal"
>syslog-facility</TT
>, it logs under the
         'daemon' category. The default is not to use syslog, and you can
         set that explicitly by setting <TT
CLASS="literal"
>syslog-level</TT
>
	 to 'none'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>syslog-facility</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         The syslog facility to send the syslog entries to. The
         default is 'daemon'.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Load a list of accepted destinations of SMS messages. If a 
	destination of an SMS message is not in this list, any message 
	received from the HTTP interface is rejected. See notes of phone 
	number format from numhash.h header file. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        As white-list, but SMS messages to these numbers are
        automatically discarded
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reply-couldnotfetch</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If set, replaces the SMS message sent back to user when Kannel
	could not fetch content. 
	Defaults to <TT
CLASS="literal"
>Could not fetch content, sorry.</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reply-couldnotrepresent</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If set, replaces the SMS message sent back when Kannel could not 
	represent the result as a SMS message. 
	Defaults to <TT
CLASS="literal"
>Result could not be represented as an 
	SMS message.</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reply-requestfailed</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If set, replaces the SMS message sent back when Kannel could not 
	contact http service.
	Defaults to <TT
CLASS="literal"
>Request Failed</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>reply-emptymessage</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If set, replaces the SMS message sent back when message is
	empty. Set to "" to enable empty messages.
	Defaults to <TT
CLASS="literal"
>&#60;Empty reply from service provider&#62;</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mo-recode</TT
></TD
><TD
>boolean</TD
><TD
VALIGN="bottom"
>&#13;        If enabled, Kannel will try to convert received messages with UCS-2 charset
	to WINDOWS-1252 or to UTF-8, simplifying external servers jobs. If Kannel is 
	able to recode message, it will also change <TT
CLASS="literal"
>coding</TT
> to 
	<TT
CLASS="literal"
>7 bits</TT
> and <TT
CLASS="literal"
>charset</TT
> to 
	<TT
CLASS="literal"
>windows-1252</TT
> or to <TT
CLASS="literal"
>utf-8</TT
>. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-request-retry</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;        If set, specifies how many retries should be performed for failing
        HTTP requests of sms-services. Defaults to 0, which means no retries
        should be performed and hence no HTTP request queuing is done.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-queue-delay</TT
></TD
><TD
>integer</TD
><TD
VALIGN="bottom"
>&#13;        If set, specifies how many seconds should pass within the HTTP queuing
        thread for retrying a failed HTTP request. Defaults to 10 sec. and is
        only obeyed if <TT
CLASS="literal"
>http-request-retry</TT
> is set to a 
        non-zero value.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        Defines the set of accepted destinations of SMS messages. If a 
	destination of an SMS message is not in this set, any message 
	received from the HTTP interface is rejected. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        As white-list-regex, but SMS messages to numbers within in this set are
        automatically discarded.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-pending-requests</TT
></TD
><TD
>number of messages</TD
><TD
VALIGN="bottom"
>&#13;        Maximum number of pending MO or DLR messages that are handled in parallel.
        (Default: 512)
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>http-timeout</TT
></TD
><TD
>seconds</TD
><TD
VALIGN="bottom"
>&#13;        Sets socket timeout in seconds for outgoing client http
        connections. Optional. Defaults to 240 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sms-length</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        Maximum allowed number of characters for a single SMS in smsbox.
        If this maximum exceeds Kannel will split SMS into multiparts.
        Default: 140
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A typical 'smsbox' group could be something like this:

<PRE
CLASS="programlisting"
>&#13;group = smsbox
bearerbox-host = localhost
sendsms-port = 13131
sendsms-chars = "0123456789 "
global-sender = 123456
access-log = "kannel.access"
log-file = "smsbox.log"
log-level = 0
</PRE
>
 </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN4061"
>Smsbox routing inside bearerbox</A
></H3
><P
>The communication link between bearerbox and smsbox has been
  designed for the purpose of load-balancing via random assignment. 
  Which means, bearerbox holds all smsc connections and passes inbound
  message to one of the connected smsboxes. So you have a determined route
  for outbound messages, but no determined route for inbound messages.
  </P
><P
>The smsbox routing solves this for the inbound direction. In
  certain scenarios you want that bearerbox to know to which smsbox
  instance it should pass messages. I.e. if you implement own boxes
  that pass messages to bearerbox and expect to receive messages defined
  on certain rules, like receiver number or smsc-id. This is the case
  for EMI/UCP and SMPP proxies that can be written easily using smsbox
  routing facility.
  </P
><P
>If you box handles the SMPP server specific communication to your
  EMSEs, and if an client send a submit_sm PDU, the box would transform
  the message into Kannel message representation and inject the message to
  bearerbox as if it would be an smsbox. As you want to assign your clients
  shortcodes for certain networks or route any inbound traffic from a certain
  smsc link connected to bearerbox, you need to separate in the scope of 
  bearerbox where the inbound message will be going to. An example may
  look like this:

<PRE
CLASS="programlisting"
>&#13;group = smsbox
...
smsbox-id = mysmsc
...

group = smsbox-route
smsbox-id = mysmsc
shortcode = "1111;2222;3333"
</PRE
>

	Which means any inbound message with receiver number 1111, 2222 or 3333
	will be delivered to the smsbox instance that has identified itself
	via the id "mysmsc" to bearerbox. Using this routing the smsbox instance
	(which may be an EMI/UCP or SMPP proxy) is able to send a deliver_sm PDU. 
	Another example showing the combination use of criteria smsc-id and 
	shortcode looks like this:

<PRE
CLASS="programlisting"
>&#13;group = smsbox
...
smsbox-id = mysmsc
...

group = smsbox-route
smsbox-id = mysmsc
smsc-id = "A;B;C"
shortcode = "1111;2222"
</PRE
>

	Which means any inbound message with receiver number 1111 or 2222 that have
	been originating from the smsc-id connections A, B or C will be delivered
	to the via the id "mysmsc" to bearerbox.
	</P
><P
>To define a default smsbox-route when no other conditions match, you may
  defined a group without smsc-id and shortcode vaues, like this:

<PRE
CLASS="programlisting"
>&#13;group = smsbox
...
smsbox-id = mysmsc
...

group = smsbox-route
smsbox-id = mysmsc
</PRE
>

  If no such default smsbox-route is defined, then bearerbox will deliver to any
  un-identified smsbox connection.  
  </P
><P
>smsbox-route inherits from core the following fields:
   </P
><DIV
CLASS="table"
><A
NAME="AEN4071"
></A
><P
><B
>Table 7-8. Smsbox-route Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>smsbox-route</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-id (m)</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Defines for which smsbox instance the routing rules do apply.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-id</TT
></TD
><TD
>word-list</TD
><TD
VALIGN="bottom"
>&#13;        If set, specifies from which smsc-ids all inbound messages should
		  be routed to this smsbox instance. List contains smsc-ids separated
		  by semicolon (";"). This rule may be used to pull any smsc specific
		  message stream to an smsbox instance. If used in combination with 
		  config directive shortcode, then this is another matching criteria
		  for the routing decission.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>shortcode</TT
></TD
><TD
>number-list</TD
><TD
VALIGN="bottom"
>&#13;        If set, specifies which receiver numbers for inbound messages should
		  be routed to this smsbox instance. List contains numbers separated
		  by semicolon (";"). This rule may be used to pull receiver number
		  specific message streams to an smsbox instance. If used in combination
		  with config directive smsc-id, then only messages originating from
		  the connections in the smsc-id are matched against the shortcode list.
     </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN4102"
>SMS-service configurations</A
></H3
><P
>Now that you have an SMS center connection to send and
    receive SMS messages you need to define services for incoming
    messages. This is done via 'sms-service' configuration
    groups.</P
><P
>These groups define SMS services in the smsbox, so they are only
    used by the smsbox. Each service is recognized from the first word
    in an SMS message and by the number of arguments accepted by the
    service configuration (unless <TT
CLASS="literal"
>catch-all</TT
>
    configuration variable is used).  By adding a username and password in the URL
    in the following manner
    "http://luser:password@host.domain:port/path?query" we can perform
    HTTP Basic authentication.</P
><P
>The simplest service group looks like this:

<PRE
CLASS="programlisting"
>&#13;group = sms-service
keyword = www
get-url = "http://%S"
</PRE
>
     
     This service grabs any SMS with two words and 'www' as the first
     word, and then does an HTTP request to an URL which is taken from
     the rest of the message. Any result is sent back to the phone
     (or requester), but is truncated to the 160 characters that will
     fit into an SMS message, naturally.</P
><P
>Service group <TT
CLASS="literal"
>default</TT
> has a special
     meaning: if the incoming message is not routed to any other
     service, <TT
CLASS="literal"
>default</TT
> 'sms-service' group is used.
     You should always define <TT
CLASS="literal"
>default</TT
> service.</P
><P
>Service group <TT
CLASS="literal"
>black-list</TT
> has a special
     meaning: if the incoming message is in service's black-list, this
     service is used to reply to user. If unset, message will be 
     discarded.</P
><DIV
CLASS="table"
><A
NAME="AEN4115"
></A
><P
><B
>Table 7-9. SMS-Service Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>sms-service</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keyword (m)</TT
></TD
><TD
>word</TD
><TD
VALIGN="bottom"
>&#13;        Services are identified by the first word in the SMS. Each
        `%s' in the URL corresponds to one word in the SMS message.
         Words are separated with spaces. A keyword is matched only if
         the number of words in the SMS message is the same as the
         number of `%s' fields in the URL. This allows you to
        configure the gateway to use different URLs for the same
        keyword depending on the number of words the SMS message
        contains. The keyword is case insensitive, which means you don't
        have to use aliases to handle different cased versions of your keyword.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>keyword-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;     This field may be used to enable service-selection based on a regular expression.
     You can define either keyword or keyword-regex in configuration, but not both in
     the same sms-service. keyword-regex is case sensitive.
     See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>aliases</TT
></TD
><TD
>word-list</TD
><TD
VALIGN="bottom"
>&#13;        If the service has aliases, they are listed as a list with 
        each entry separated with a semicolon (';'). Aliases are case
        insensitive just like keyword.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>name</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Optional name to identify the service in logs. If unset,
	<TT
CLASS="literal"
>keyword</TT
> is used.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>get-url (c)</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Requested URL. The url can include a list of parameters, which are
        parsed before the url is fetched. See below for these
        parameters. Also works with plain 'url'

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>post-url (c)</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Requested URL. As above, but request is done as POST, not GET.
	Always matches the keyword, regardless of pattern matching.
	See notes on POST other where.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>post-xml (c)</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Requested URL. As above, but request is done as XML POST.
	Always matches the keyword, regardless of pattern matching.
	See notes on POST other where and <A
HREF="#postxml"
><I
>XML Post</I
></A
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>file (c)</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;        File read from a local disc. Use this variable only if no
        <TT
CLASS="literal"
>url</TT
> is set. All escape codes (parameters)
        in <TT
CLASS="literal"
>url</TT
> are supported in filename. 
        The last character of the file (usually linefeed) is removed.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text (c)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Predefined text answer. Only if there is neither <TT
CLASS="literal"
>url</TT
> nor 
        <TT
CLASS="literal"
>file</TT
> set. Escape codes (parameters) are
        usable here, too.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>exec (c)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Executes the given shell command as the current UID of the
		  running smsbox user and returns the output to 
		  <TT
CLASS="literal"
>stdout</TT
> as reply.
		  Escape codes (parameters) are
        usable here, too. BEWARE: You may harm your system if you use
		  this sms-service type without serious caution! Make sure anyone
		  who is allowed to use these kind of services is checked using 
		  white/black-list mechanisms for security reasons.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>accepted-smsc</TT
></TD
><TD
>id-list</TD
><TD
VALIGN="bottom"
>&#13;        Accept ONLY SMS messages arriving from SMSC with matching ID.
        <A
NAME="AEN4193"
HREF="#FTN.AEN4193"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
>
        Separate multiple entries with ';'. For example, if 
         <TT
CLASS="literal"
>accepted-smsc</TT
>
        is "RL;SON", accept messages which originate from SMSC with
        ID set as 'RL' or 'SON'
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>accepted-account</TT
></TD
><TD
>id-list</TD
><TD
VALIGN="bottom"
>&#13;        Accept ONLY SMS messages arriving with a matching ACCOUNT field.
        <A
NAME="AEN4201"
HREF="#FTN.AEN4201"
><SPAN
CLASS="footnote"
>[b]</SPAN
></A
>
        Separate multiple entries with ';'. For example, if 
         <TT
CLASS="literal"
>accepted-account</TT
>
        is "FOO;BAR", accept messages which originate with the ACCOUNT
        field set as 'FOO' or 'BAR'
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes of the sender number which are 
		  accepted to be received by this service. 
        <A
NAME="AEN4210"
HREF="#FTN.AEN4210"
><SPAN
CLASS="footnote"
>[c]</SPAN
></A
>
	Multiple entries are separated with 
        semicolon (';'). For example, "91;93" selects this service for
	these prefixes. 
	If denied-prefix is unset, only this numbers are allowed. If 
	denied is set, number are allowed if present in allowed or not 
	in denied list.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes of the sender number which are 
		  NOT accepted to be sent through this SMSC.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-receiver-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes of the receiver number which are 
		  accepted to be received by this service. This may be used to
 		  allow only inbound SMS to certain shortcut numbers to be allowed
		  to this service.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-receiver-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes of the receiver number which are 
		  NOT accepted to be sent through this SMSC.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>catch-all</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        Catch keyword regardless of '%s' parameters in pattern.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>send-sender</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        Used only with POST. If set to true, number of the handset is
        set, otherwise not.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>strip-keyword</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;     Used only with POST. Remove matched keyword from message text
        before sending it onward.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>faked-sender</TT
></TD
><TD
>phone-number</TD
><TD
VALIGN="bottom"
>&#13;        This number is set as sender. Most SMS centers ignore this,
        and use their fixed number instead. This option
        overrides all other sender setting methods.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-messages</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;        If the message to be sent is longer than maximum length of an SMS
        it will be split into several parts. <TT
CLASS="literal"
>max-messages</TT
>
        lets you specify a maximum number of individual SMS messages that
        can be used. If
        <TT
CLASS="literal"
>max-messages</TT
> is set to 0, no reply is sent, 
        except for error messages. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>accept-x-kannel-headers</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        Request reply can include special X-Kannel headers but these
        are only accepted if this variable is set to true. See
	<A
HREF="#xkannel"
><I
>Extended headers</I
></A
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>assume-plain-text</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        If client does not set Content-Type for reply, it is normally
        application/octet-stream which is then handled as data in
        Kannel. This can be forced to be plain/text to allow backward
        compatibility, when data was not expected.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>concatenation</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;        Long messages can be sent as independent SMS messages with
        <TT
CLASS="literal"
>concatenation = false</TT
> or as concatenated messages
        with <TT
CLASS="literal"
>concatenation = true</TT
>. Concatenated messages
        are reassembled into one long message by the receiving device.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>split-chars</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Allowed characters to split the message into several messages.
        So, with "#!" the message is split from last '#' or '!', which is 
        included in the previous part.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>split-suffix</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If the message is split into several ones, this string is appended to 
        each message except the last one.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>omit-empty</TT
></TD
><TD
>bool</TD
><TD
VALIGN="bottom"
>&#13;	Normally, Kannel sends a warning to the user if there was an
	empty reply from the service provider.  If
	<TT
CLASS="literal"
>omit-empty</TT
> is set to 'true', Kannel will send
	nothing at all in such a case.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>header</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If specified, this string is automatically added to each SMS sent with
        this service. If the message is split, it is added to each part.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>footer</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        As header, but not inserted into head but appended to end.

     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>prefix</TT
></TD
><TD
>string</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        Stuff in answer that is cut away, only things between prefix
        and suffix is left. Not case sensitive. Matches the first prefix
        and then the first suffix. These are only used for 
        <TT
CLASS="literal"
>url</TT
> type services, and only if both are
	specified.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>suffix</TT
></TD
><TD
>string</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Load a list of accepted senders of SMS messages. If a 
	sender of an SMS message is not in this list, any message 
	received from the SMSC is rejected, unless a <TT
CLASS="literal"
>&#13;	black-list</TT
> service is defined. See notes of phone 
	number format from numhash.h header file. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        As white-list, but SMS messages from these numbers are
        automatically discarded
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>accepted-smsc-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        Accept only SMS messages arriving from SMSCs with a matching ID.
        <A
NAME="AEN4327"
HREF="#FTN.AEN4327"
><SPAN
CLASS="footnote"
>[d]</SPAN
></A
>
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>accepted-account-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        Accept ONLY SMS messages arriving with a matching ACCOUNT field.
        <A
NAME="AEN4335"
HREF="#FTN.AEN4335"
><SPAN
CLASS="footnote"
>[e]</SPAN
></A
>
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes of sender-numbers accepted by this service.
        <A
NAME="AEN4343"
HREF="#FTN.AEN4343"
><SPAN
CLASS="footnote"
>[f]</SPAN
></A
>
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes of sender-numbers which may
        not use this service.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-receiver-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes of receiver-numbers which 
        may receive data sent by this service. This can be used to
        allow only inbound SMS to certain shortcut numbers to be allowed
	to this service.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-receiver-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone number prefixes of receiver-numbers which may not
        receive data sent by this service.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        Defines a set of accepted senders of SMS messages. If a 
	sender of an SMS message is not in this list, the message is rejected.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        As white-list-regex, but SMS messages from these numbers are
        automatically discarded.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-charset</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        Defines which character encoding is used for the SMS message when
        passed to a remote HTTP application. This includes how the SMS message
        text is send in the HTTP GET parameter list and in the HTTP POST bidy.
        Uses <TT
CLASS="literal"
>iconv()</TT
> routines to convert from and to that 
        specific character set encoding. 
        See your local <TT
CLASS="literal"
>iconv_open(3)</TT
> manual page for the 
        supported character encodings and the type strings that should be 
        presented for this directive.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url</TT
></TD
><TD
>string (URL)</TD
><TD
VALIGN="bottom"
>&#13;        Optional Defines a default URL which is fetched for DLR event, if no 
        specific X-Kannel HTTP header parameter is returned by the HTTP response.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-mask</TT
></TD
><TD
>number (bit mask)</TD
><TD
VALIGN="bottom"
>&#13;        Optional. Defines a default DLR event bit mask which is used in 
        combination with the <TT
CLASS="literal"
>dlr-url</TT
> config directive, 
        if no specific X-Kannel HTTP header parameter is returned by the 
        HTTP response.
        </TD
></TR
></TBODY
><TR
><TD
COLSPAN="3"
>Notes:<BR><A
NAME="FTN.AEN4193"
>a. </A
>Even if this service is denied,
	Kannel still searches for other service which accepts the message,
	or default service.<BR><A
NAME="FTN.AEN4201"
>b. </A
>Even if this service is denied,
	Kannel still searches for other service which accepts the message,
	or default service.<BR><A
NAME="FTN.AEN4210"
>c. </A
>Like in accepted-smsc, 
	Kannel still searches for other service which accepts the message.
	This way there could be several services with the same keyword and
	different results.<BR><A
NAME="FTN.AEN4327"
>d. </A
>Even if this service is denied,
	Kannel still searches for other service which accepts the message,
	or default service.<BR><A
NAME="FTN.AEN4335"
>e. </A
>Even if this service is denied,
	Kannel still searches for other service which accepts the message,
	or default service.<BR><A
NAME="FTN.AEN4343"
>f. </A
>Like in accepted-smsc-regex, 
	Kannel still searches for another service which accepts the message.
	This way there could be several services with the same keyword and
	different results.<BR></TD
></TR
></TABLE
></DIV
><DIV
CLASS="table"
><A
NAME="escapecodes"
></A
><P
><B
>Table 7-10. Parameters (Escape Codes)</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
>%k</TT
></TD
><TD
>&#13;the keyword in the SMS request (i.e., the first word in the SMS message)
                 
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%s</TT
></TD
><TD
>&#13;next word from the SMS message, starting with
                         the second one (i.e., the first word, the
                         keyword, is not included); problematic characters
                         for URLs are encoded (e.g., '+' becomes '%2B')
                 
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%S</TT
></TD
><TD
>&#13;same as %s, but '*' is converted to '~' (useful
                         when user enters a URL) and URL encoding isn't done
                         (all others do URL encode)
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%r</TT
></TD
><TD
>&#13;words not yet used by %s; e.g., if the message
                         is "FOO BAR FOOBAR BAZ", and the has been one %s,
                         %r will mean "FOOBAR BAZ"
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%a</TT
></TD
><TD
>&#13;all words of the SMS message, including the first one, with spaces
squeezed to one
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%b</TT
></TD
><TD
>&#13;the original SMS message, in a binary form (URL-encoded)
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%e</TT
></TD
><TD
>&#13;the original SMS message, in a binary form (printable hexadecimal byte codes). 
I.e. "xyz" would be send as byte codes "78797A".
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%t</TT
></TD
><TD
>&#13;the time the message was sent, formatted as
                         "YYYY-MM-DD HH:MM", e.g., "1999-09-21 14:18"
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%T</TT
></TD
><TD
>&#13;the time the message was sent, in UNIX epoch timestamp format
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%p</TT
></TD
><TD
>&#13;the phone number of the sender of the SMS message
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%P</TT
></TD
><TD
>&#13;the phone number of the receiver of the SMS message
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%q</TT
></TD
><TD
>&#13;like %p, but a leading `00' is replaced with `+'
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%Q</TT
></TD
><TD
>&#13;like %P, but a leading `00' is replaced with `+'
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%i</TT
></TD
><TD
>&#13;the smsc-id of the connection that received the message
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%I</TT
></TD
><TD
>&#13;the SMS ID of the internal message structure
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%d</TT
></TD
><TD
>&#13;the delivery report value
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%R</TT
></TD
><TD
>&#13;the delivery report URL value
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%N</TT
></TD
><TD
>&#13;the delivery report notification message
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%D</TT
></TD
><TD
>&#13;meta-data from the SMSC. See <A
HREF="#meta-data"
>Meta Data</A
> for more into.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%A</TT
></TD
><TD
>&#13;the delivery report SMSC reply, if any
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%F</TT
></TD
><TD
>&#13;the <TT
CLASS="literal"
>foreign</TT
> (smsc-provided) message ID. Only
relevant on DLR url's.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%n</TT
></TD
><TD
>&#13;the sendsms-user or sms-service name
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%c</TT
></TD
><TD
>&#13;message coding: 0 (default, 7 bits), 1 (8 bits) or 2 (Unicode)
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%m</TT
></TD
><TD
>&#13;message class bits of DCS: 0 (directly to display, flash),
1 (to mobile), 2 (to SIM) or 3 (to SIM toolkit).
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%M</TT
></TD
><TD
>&#13;mwi (message waiting indicator) bits of DCS:
0 (voice), 1, (fax), 2 (email) or 3 (other) for activation
and 4, 5, 6, 7 for deactivation respectively.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%y</TT
></TD
><TD
>&#13;message priority: 0 (lowest) to 3 (highest).
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%C</TT
></TD
><TD
>&#13;message charset: for a "normal" message, it will 
be "GSM" (coding=0), "binary" (coding=1) or 
"UTF-16BE" (coding=2). If the message was successfully
recoded from Unicode, it will be "WINDOWS-1252"
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%u</TT
></TD
><TD
>&#13;<TT
CLASS="literal"
>udh</TT
> of incoming message (URL-encoded)
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%U</TT
></TD
><TD
>&#13;<TT
CLASS="literal"
>udh</TT
> of incoming message (printable hexadecimal byte codes). 
I.e. "xyz" would be send as byte codes "78797A".
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%B</TT
></TD
><TD
>&#13;billing identifier/information of incoming message. The value
depends on the SMSC module and the associated billing semantics
of the specific SMSC providing the information. For EMI2 the value
is the XSer 0c field, for SMPP MO it is the service_type of the 
deliver_sm PDU, and for SMPP DLR it is the DLR message err component. 
(Note: This is used for proxying billing 
information to external applications. There is no semantics 
associated while processing these.)
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%o</TT
></TD
><TD
>&#13;account identifier/information of incoming message. The value
depends on the SMSC module and has been introduced to allow the
forwarding of an operator ID from aggregator SMSCs to the application
layer, hence the smsbox HTTP calling instance.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%O</TT
></TD
><TD
>&#13;DCS (Data coding schema) value.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%f</TT
></TD
><TD
>&#13;Originating SMSC of incoming message. The value is set if
the AT driver is used to receive a SMS on a gsm modem.
The value of %f will contain the number of the SMSC sending
the SMS to the SIM card. Other SMSC types than AT do not
set this field so it will be empty.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%x</TT
></TD
><TD
>&#13;the smsbox-id of the message, identifying from which smsbox connection
the message is originating.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%v</TT
></TD
><TD
>&#13;Validity period in minutes. Available only if SMSC supports
and sent this value.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%V</TT
></TD
><TD
>&#13;Deferred in minutes. Available only if SMSC supports
and sent this value.
</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%#</TT
></TD
><TD
>&#13;This allows to pass meta-data individual parameters into urls.
The syntax is as follows: <TT
CLASS="literal"
>%#group#parameter#</TT
>
For example: <TT
CLASS="literal"
>%#smpp#my_param#</TT
> would be replaced 
with the value 'my_param' from the group 'smpp' coming inside the 
meta_data field.
</TD
></TR
></TBODY
></TABLE
></DIV
><P
>Some sample 'sms-service' groups:

<PRE
CLASS="programlisting"
>&#13;group = sms-service
keyword = nop
text = "You asked nothing and I did it!"
catch-all = true

group = sms-service
keyword = complex
get-url = "http://host/service?sender=%p&#38;text=%r"
accept-x-kannel-headers = true
max-messages = 3
concatenation = true

group = sms-service
keyword = default
text = "No action specified"
</PRE
>
</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN4554"
>How sms-service interprets the HTTP response</A
></H3
><P
>When an <TT
CLASS="literal"
>sms-service</TT
> requests a document
    via HTTP, it will accept one of four types of content types:

    	<DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN4558"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
>text/plain</TT
></TD
><TD
>Blanks are squeezed into one, rest is chopped to fit an
	SMS message.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text/html</TT
></TD
><TD
>Tags are removed, rest is chopped to fit an
	SMS message.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text/vnd.wap.wml</TT
></TD
><TD
>Processed like HTML.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text/xml</TT
></TD
><TD
>Processed as a POST-XML. See <A
HREF="#postxml"
><I
>XML Post</I
></A
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>application/octet-stream</TT
></TD
><TD
>The body will be transmitted as the SMS message, as
	8-bit data. This can be avoided by setting
	<TT
CLASS="literal"
>assume-plain-text</TT
> variable on for the
	SMS-service.</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
>

        </P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="xkannel"
>Extended headers</A
></H4
><P
>Kannel uses and accepts several X-Kannel headers to be
	used with SMS-services, if option
        <TT
CLASS="literal"
>accept-x-kannel-headers</TT
> was provided in the
        relevant 'sms-service' group.</P
><DIV
CLASS="table"
><A
NAME="AEN4587"
></A
><P
><B
>Table 7-11. X-Kannel Headers</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>SMSPush equivalent</TH
><TH
>X-Kannel Header</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>username</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Username</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Password</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>from</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-From</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>to</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-To</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text</TT
></TD
><TD
>request body</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>charset</TT
></TD
><TD
>charset as in <TT
CLASS="literal"
>Content-Type: text/html; charset=ISO-8859-1</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>udh</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-UDH</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-SMSC</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>flash</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Flash</TT
> (deprecated, see <TT
CLASS="literal"
>X-Kannel-MClass</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mclass</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-MClass</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mwi</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-MWI</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>compress</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Compress</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>coding</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Coding</TT
>. If unset, defaults to 0 
   (7 bits) if <TT
CLASS="literal"
>Content-Type</TT
> is <TT
CLASS="literal"
>text/plain
   </TT
>, <TT
CLASS="literal"
>text/html</TT
> or 
   <TT
CLASS="literal"
>text/vnd.wap.wml</TT
>. On 
   <TT
CLASS="literal"
>application/octet-stream</TT
>, defaults to
   8 bits (1). All other <TT
CLASS="literal"
>Content-Type</TT
> values 
   are rejected.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>validity</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Validity</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>deferred</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Deferred</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-mask</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-DLR-Mask</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-DLR-Url</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>account</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Account</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pid</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-PID</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-dcs</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Alt-DCS</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>binfo</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-BInfo</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>rpi</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-RPI</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>priority</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Priority</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>meta-data</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Meta-Data</TT
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="kannelpost"
>Kannel POST</A
></H4
><P
>Kannel can do POST if <TT
CLASS="literal"
>service</TT
> is
	contains a <TT
CLASS="literal"
>post-url="..."</TT
>.</P
><DIV
CLASS="table"
><A
NAME="AEN4726"
></A
><P
><B
>Table 7-12. X-Kannel Post Headers</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Parameter (escape code) equivalent</TH
><TH
>X-Kannel Header</TH
><TH
>Notes</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>%p (from)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-From</TT
></TD
><TD
>Only sent if <TT
CLASS="literal"
>send-sender</TT
> is true</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%P (to)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-To</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%t (time)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Time</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%u (udh)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-UDH</TT
></TD
><TD
>in hex format: <TT
CLASS="literal"
>06050415820000</TT
></TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%i (smsc)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-SMSC</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (mclass)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-MClass</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (pid)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-PID</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (alt-dcs)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Alt-DCS</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (mwi)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-MWI</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%c (coding)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Coding</TT
></TD
><TD
>0=7 Bits, 1=8 Bits, 2=UCS-2</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (compress)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Compress</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (validity)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Validity</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>- (deferred)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Deferred</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%n (service name)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Service</TT
></TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%D (meta-data)</TT
></TD
><TD
><TT
CLASS="literal"
>X-Kannel-Meta-Data</TT
></TD
><TD
>Meta-Data (Only SMPP TLV's supported at the moment)</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%a or %r (text)</TT
></TD
><TD
>request body</TD
><TD
>Kannel send all words (%a) unless <TT
CLASS="literal"
>strip-keyword</TT
> is true</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>%C (charset)</TT
></TD
><TD
>present in <TT
CLASS="literal"
>Content-Type</TT
> <TT
CLASS="literal"
>HTTP</TT
></TD
><TD
>Example: <TT
CLASS="literal"
>Content-Type: text/plain; charset=ISO-8859-1</TT
></TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="postxml"
>XML Post</A
></H4
><P
>Kannel can send and receive XML POST with the following
	format:</P
><PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE ...&#62;
&#60;message&#62;
  &#60;submit&#62;
    &#60;da&#62;&#60;number&#62;destination number (to)&#60;/number&#62;&#60;/da&#62;
    &#60;oa&#62;&#60;number&#62;originating number (from)&#60;/number&#62;&#60;/oa&#62;
    &#60;ud&#62;user data (text)&#60;/ud&#62;
    &#60;udh&#62;user data header (udh)&#60;/udh&#62;
    &#60;meta-data&#62;meta-data&#60;/meta-data&#62;
    &#60;dcs&#62;
      &#60;mclass&#62;mclass&#60;/mclass&#62;
      &#60;coding&#62;coding&#60;/coding&#62;
      &#60;mwi&#62;mwi&#60;/mwi&#62;
      &#60;compress&#62;compress&#60;/compress&#62;
      &#60;alt-dcs&#62;alt-dcs&#60;/alt-dcs&#62;
    &#60;/dcs&#62;
    &#60;pid&#62;pid&#60;/pid&#62;
    &#60;rpi&#62;rpi&#60;/rpi&#62;
    &#60;vp&#62;
      &#60;delay&#62;validity time in minutes&#60;/delay&#62;
    &#60;/vp&#62;
    &#60;timing&#62;
      &#60;delay&#62;deferred time in minutes&#60;/delay&#62;
    &#60;/timing&#62;
    &#60;statusrequest&#62;
      &#60;dlr-mask&#62;dlr-mask&#60;/dlr-mask&#62;
      &#60;dlr-url&#62;dlr-url&#60;/dlr-url&#62;
    &#60;/statusrequest&#62;

    &#60;!-- request from application to Kannel --&#62;
    &#60;from&#62;
      &#60;user&#62;username&#60;/user&#62;
      &#60;username&#62;username&#60;/username&#62; 
      &#60;pass&#62;password&#60;/pass&#62;
      &#60;password&#62;password&#60;/password&#62;
      &#60;account&#62;account&#60;/account&#62;
    &#60;/from&#62;
    &#60;to&#62;smsc-id&#60;/to&#62;

    &#60;!-- request from Kannel to application --&#62;
    &#60;from&#62;smsc-id&#60;/from&#62;
    &#60;to&#62;service-name&#60;/to&#62;

  &#60;/submit&#62;
&#60;/message&#62;
</PRE
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>Don't forget to set POST Content-Type to 
	<TT
CLASS="literal"
>text/xml</TT
>!</P
></BLOCKQUOTE
></DIV
><P
>There could be several <TT
CLASS="literal"
>da</TT
> entries for <TT
CLASS="literal"
>sendsms-user
	</TT
> to enable multi-recipient messages. <TT
CLASS="literal"
>da</TT
> doesn't make
	sense in <TT
CLASS="literal"
>sms-service</TT
>.</P
><P
><TT
CLASS="literal"
>udh</TT
> is the same format as <TT
CLASS="literal"
>X-Kannel-UDH</TT
>.
	Example: &#60;udh&#62;06050415820000&#60;/udh&#62;.</P
><P
>On Kannel-&#62;application, <TT
CLASS="literal"
>from</TT
> is the <TT
CLASS="literal"
>smsc-id</TT
>
	that message arrives and <TT
CLASS="literal"
>to</TT
> is the service name.</P
><P
>On application-&#62;Kannel, <TT
CLASS="literal"
>from</TT
> contains the credentials (
	<TT
CLASS="literal"
>user/username</TT
>, <TT
CLASS="literal"
>pass/password</TT
> and <TT
CLASS="literal"
>&#13;	account</TT
> and <TT
CLASS="literal"
>to</TT
> corresponds to the <TT
CLASS="literal"
>smsc-id
	</TT
> to submit the message.</P
><P
><TT
CLASS="literal"
>user</TT
> and <TT
CLASS="literal"
>username</TT
> are equivalent and 
	only one of them should be used. (same for <TT
CLASS="literal"
>pass</TT
> and <TT
CLASS="literal"
>&#13;	password</TT
>.</P
><P
>When application POST in Kannel, as in GET, only <TT
CLASS="literal"
>user</TT
>, <TT
CLASS="literal"
>&#13;	pass</TT
> and <TT
CLASS="literal"
>da</TT
> are required. Everything else is optional. 
	(<TT
CLASS="literal"
>oa</TT
> could be needed too is there's no <TT
CLASS="literal"
>default-sender</TT
>
	or <TT
CLASS="literal"
>forced-sender</TT
>.</P
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>This is experimental code. XML format could and should change to fully
	met IETF's sms-xml standard (yet in draft) and additional tags needed by Kannel should be
	pondered.</P
></TD
></TR
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN4881"
>SendSMS-user configurations</A
></H3
><P
>To enable an SMS push, you must set
   <TT
CLASS="literal"
>sendsms-port</TT
> into the 'smsbox' group and define one or
   more 'sendsms-user' groups. Each of these groups define one
   account, which can be used for the SMS push, via HTTP interface (see
   below)</P
><DIV
CLASS="table"
><A
NAME="AEN4885"
></A
><P
><B
>Table 7-13. SendSMS-User Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group (m)</TT
></TD
><TD
><TT
CLASS="literal"
>sendsms-user</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>username (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;       Name for the user/account. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password (m)</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;       Password for the user (see HTTP interface, below)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>name</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;       As in 'sms-service' groups.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>user-deny-ip</TT
></TD
><TD
>IP-list</TD
><TD
ROWSPAN="2"
VALIGN="bottom"
>&#13;        As other deny/allow IP lists, but for this user (i.e. this
         user is not allowed to do the SMS push HTTP request from
         other IPs than allowed ones). If not set, there is no
         limitations.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>user-allow-IP</TT
></TD
><TD
>IP-list</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>forced-smsc</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;         Force SMSC ID as a 'string' (linked to SMS routing, see 'smsc' groups)
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-smsc</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;        If no SMSC ID is given with the send-sms request (see below), use
        this one. No idea to use with forced-smsc.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>forced-priority</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;         Force priority of any message send by this user, in the range (0..3).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-priority</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;         Maximum allowed priority for any message send by this user, in the
         range (0..3).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-sender</TT
></TD
><TD
>phone-number</TD
><TD
VALIGN="bottom"
>&#13;        This number is set as sender if not set by <TT
CLASS="literal"
>from</TT
>
	get/post parameter 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>faked-sender</TT
></TD
><TD
>phone-number</TD
><TD
VALIGN="bottom"
>&#13;        As in 'sms-service' groups
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-messages</TT
></TD
><TD
>number</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>concatenation</TT
></TD
><TD
>bool</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>split-chars</TT
></TD
><TD
>string</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>split-suffix</TT
></TD
><TD
>string</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>omit-empty</TT
></TD
><TD
>bool</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>header</TT
></TD
><TD
>string</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>footer</TT
></TD
><TD
>string</TD
><TD
>&nbsp;</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes which are accepted to be
        sent using this username. Multiple entries are separated with 
        semicolon (';'). For example, "040;050" prevents sending of
        any SMS message with prefix of 040 or 050 through this SMSC.
	If denied-prefix is unset, only this numbers are allowed. If
	set, number are allowed if present in allowed or not in 
	denied list.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix</TT
></TD
><TD
><TT
CLASS="literal"
>prefix-list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        A list of phone number prefixes which are NOT accepted to be
        sent using this username.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        Load a list of accepted destinations of SMS messages. If a 
	destination of an SMS message is not in this list, any message 
	received from the HTTP interface is rejected. See notes of phone 
	number format from numhash.h header file. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;        As white-list, but SMS messages from these numbers are
        automatically rejected.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url</TT
></TD
><TD
>URL</TD
><TD
VALIGN="bottom"
>&#13;       Optional. Defines a default URL which is fetched for DLR event, if no 
       specific <TT
CLASS="literal"
>dlr-url</TT
> CGI parameter is set in the HTTP
       request.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-mask</TT
></TD
><TD
>number (bit mask)</TD
><TD
VALIGN="bottom"
>&#13;       Optional. Defines a default DLR event bit mask which is used in 
       combination with the <TT
CLASS="literal"
>dlr-url</TT
> config directive, 
       if no specific <TT
CLASS="literal"
>dlr-url</TT
> CGI parameter is set in the
       HTTP request.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone numbers which are accepted to be
        sent using this username. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        A set of phone numbers which may not
        send using this username. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        Defines a set of accepted destinations of SMS messages. If a 
	destination of an SMS message is not in this list, any message 
	received from the HTTP interface is rejected. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;        As <TT
CLASS="literal"
>white-list-regex</TT
>, but SMS messages originating from 
        a number matching the pattern are discarded.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
></TBODY
></TABLE
></DIV
><P
>Some sample 'sendsms-user' groups:

<PRE
CLASS="programlisting"
>&#13;group = sendsms-user
username = simple
password = elpmis

group = sendsms-user
username = complex
password = 76ftY
user-deny-ip = "*.*.*.*"
user-allow-ip = "123.234.123.234"
max-messages = 3
concatenation = true
forced-smsc = SOL
</PRE
>

   The second one is very limited and only allows a user from IP
   "123.234.123.234". On the other hand, the user can send a longer
   message, up to 3 SMSes long, which is sent as concatenated
   SMS.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN5045"
>Over-The-Air configurations</A
></H3
><P
>To enable Over-The-Air configuration of phones or other client
   devices that support the protocol you need to configure a <TT
CLASS="literal"
>&#13;   sendsms-user</TT
>.<TT
CLASS="literal"
>ota-setting</TT
> group is not 
   necessary, you can send settings to the phone as a XML document, but
   this method is perhaps more suitable for continuous provisioning.
   </P
><P
>If you want to send multiple OTA configurations through the smsbox
   and you do not want to send XML documents, you will have to declare a 
   <TT
CLASS="literal"
>ota-id</TT
> string to the different <TT
CLASS="literal"
>ota-setting
   </TT
> groups.
   </P
><DIV
CLASS="table"
><A
NAME="AEN5053"
></A
><P
><B
>Table 7-14. OTA Setting Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>ota-setting</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ota-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	     An optional name or id for the ota-setting. Any string is
        acceptable, but semicolon ';' may cause problems, so avoid
        it and any other special non-alphabet characters. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>location</TT
></TD
><TD
><TT
CLASS="literal"
>URL</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The address of the HTTP server for your WAP services, i.e. 
		 <TT
CLASS="literal"
>http://wap.company.com</TT
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>service</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Description of the service
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ipaddress</TT
></TD
><TD
><TT
CLASS="literal"
>IP</TT
></TD
><TD
VALIGN="bottom"
>&#13;      IP address of your WAP gateway 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>phonenumber</TT
></TD
><TD
><TT
CLASS="literal"
>phone-number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Phone number used to establish the PPP connection
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>speed</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Connection speed: 9600 or 14400. Defaults to 9600.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>bearer</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Bearer type: data or sms. Defaults to data.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>calltype</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Call type: isdn or analog. Defaults to isdn.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>connection</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Connection type: cont or temp. Cont uses TCP port 9201
		 and Temp uses UDP port 9200. Defaults to cont.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pppsecurity</TT
></TD
><TD
><TT
CLASS="literal"
>on or off</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Enable CHAP authentication if set to on, PAP otherwise
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>authentication</TT
></TD
><TD
><TT
CLASS="literal"
></TT
></TD
><TD
VALIGN="bottom"
>&#13;       normal or secure. Indicates whether WTLS should be used 
		 or not. Defaults to normal.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>login</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Login name.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>secret</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Login password
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample 'ota-setting' group:

<PRE
CLASS="programlisting"
>&#13;group = ota-setting
location = http://wap.company.com
service = "Our company's WAP site"
ipaddress = 10.11.12.13
phonenumber = 013456789
bearer = data
calltype = analog
connection = cont
pppsecurity = off
authentication = normal
login = wapusr
secret = thepasswd
</PRE
>

And a 'sendsms-user' to use with it. With concatenation enabled:

<PRE
CLASS="programlisting"
>&#13;group = sendsms-user
username = otauser
password = foo
max-messages = 2
concatenation = 1
</PRE
>

  </P
><DIV
CLASS="table"
><A
NAME="AEN5150"
></A
><P
><B
>Table 7-15. OTA Bookmark Group Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><TT
CLASS="literal"
>ota-bookmark</TT
></TD
><TD
VALIGN="bottom"
>&#13;       This is a mandatory variable
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ota-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;	     An optional name or id for the ota-bookmark. Any string is
        acceptable, but semicolon ';' may cause problems, so avoid
        it and any other special non-alphabet characters. 
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>url</TT
></TD
><TD
><TT
CLASS="literal"
>URL</TT
></TD
><TD
VALIGN="bottom"
>&#13;       The address of the HTTP server for your WAP services, i.e. 
		 <TT
CLASS="literal"
>http://wap.company.com</TT
>
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>name</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Description of the service
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>A sample 'ota-bookmark' group:

<PRE
CLASS="programlisting"
>&#13;group = ota-bookmark
ota-id = wap-link
url = "http://wap.company.com"
service = "Our company's WAP site"
</PRE
>

And a 'sendsms-user' to use with it, with the same conditions as for the
'ota-setting' group.

  </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN5186"
>Setting up more complex services</A
></H3
><P
>The basic service system is very limited - it can only
    answer to original requester and it cannot send UDH data, for
    example. This chapter explains some more sophisticated and complex
    SMS service setups.</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5189"
>Redirected replies</A
></H4
><P
>The basic service system always sends the answer back to
    original requester, but sometimes the content server needs to send
    something to other terminals or delay the answer. To create 
    such systems, an SMS push is used.</P
><P
>The idea is to get the initial request, but then send no
    reply. Instead, the reply (if any) is sent via HTTP
    sendsms-interface as SMS Push. This way the service
    application has full control of the return content, and can do all
    needed formatting beforehand.</P
><P
>Note that when no reply is wanted, remember to set the variable
    <TT
CLASS="literal"
>max-messages</TT
> to zero (0) so that no reply is sent, unless an
    error occurs. Simple sample:</P
><PRE
CLASS="programlisting"
>&#13;group = sms-service
keyword = talk
get-url = "http://my.applet.machine/Servlet/talk?sender=%p&#38;text=%r"
max-messages = 0
</PRE
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5196"
>Setting up operator specific services</A
></H4
><P
>Those running Kannel with several SMS centers might need to
   define services according to the relying SMS center. To achieve this,
   first you need to give an ID name for SMS center connections (see
   above). Then use the <TT
CLASS="literal"
>accepted-smsc</TT
> variable to 
   define which messages can use that service.</P
><PRE
CLASS="programlisting"
>&#13;group = sms-service
keyword = weather
accepted-smsc = SOL
get-url = "http://my.applet.machine/Servlet/weather?sender=%p&#38;operator=SOL&#38;text=%r"
</PRE
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5201"
>Setting up multi-operator Kannel</A
></H4
><P
>Sometimes there is a need for Kannel to listen to two (or
   more) distinct SMS centers, and messages must be routed to services
   according to where they came from, and replies likewise must return
   to same SMSC. This is done via <TT
CLASS="literal"
>smsc-id</TT
>
   magic. Here is a shortened sample configuration, which handles to
   distinct SMS servers and services:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc-id = A
denied-smsc-id = B
...

group = smsc
smsc-id = B
denied-smsc-id = A
...

group = sms-service
accepted-smsc = A
get-url = "..."

group = sms-service
accepted-smsc = B
get-url = "..."
</PRE
><P
>As can be seen, the <TT
CLASS="literal"
>smsc-id</TT
> is used to
    identify the SMS center from which the message came. Then, the
    <TT
CLASS="literal"
>denied-smsc-id</TT
> variable is used to prevent
    messages originally from the other SMS center from being sent
    through the other one. Finally 'sms-service' groups are defined
    with <TT
CLASS="literal"
>accepted-smsc</TT
> so that they only accept
    messages from certain SMS center.</P
><P
>If you want to use SMS push services, requesters 
    should then set the <TT
CLASS="literal"
>smsc</TT
> request parameter, or
    'sendsms-user' groups should be defined like this:</P
><PRE
CLASS="programlisting"
>&#13;group = sendsms-user
username = operator_A
password = foo
forced-smsc = A

group = sendsms-user
username = operator_B
password = bar
forced-smsc = B
</PRE
><P
>Note that if your SMS centers do not set the sender phone
    number but rely on number transmitted, you should set
    <TT
CLASS="literal"
>faked-sender</TT
> to all 'sendsms-user'
    groups.</P
></DIV
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5215"
>Running SMS gateway</A
></H2
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
NAME="AEN5217"
>Using the HTTP interface to send SMS messages</A
></H3
><P
>After you have configured Kannel to allow the sendsms
	service, you can send SMS messages via HTTP, e.g., using a
	WWW browser. The URL looks something like this:
	
<PRE
CLASS="programlisting"
>&#13;http://smsbox.host.name:13013/cgi-bin/sendsms?
username=foo&#38;password=bar&#38;to=0123456&#38;text=Hello+world
</PRE
>

         Thus, technically,
	you make an HTTP GET request. This means that all the information
	is stuffed into the URL. If you want to use this often via a
	browser, you probably want to make an HTML form for this.</P
><P
>&#13;     Kannel will answer to sendsms request with following codes and
     body texts:</P
><DIV
CLASS="table"
><A
NAME="AEN5222"
></A
><P
><B
>Table 7-16. SMS Push reply codes</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Status</TH
><TH
>Body</TH
><TH
>Meaning</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>202</TT
></TD
><TD
><TT
CLASS="literal"
>0: Accepted for delivery</TT
></TD
><TD
VALIGN="bottom"
>&#13;        The message has been accepted and is delivered onward to a SMSC
        driver. Note that this status does not ensure that the
        intended recipient receives the message.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>202</TT
></TD
><TD
><TT
CLASS="literal"
>3: Queued for later delivery</TT
></TD
><TD
VALIGN="bottom"
>&#13;        The bearerbox accepted and stored the message, but there was
        temporarily no SMSC driver to accept the message so it was
        queued. However, it should be delivered later on.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>4xx</TT
></TD
><TD
>(varies)</TD
><TD
VALIGN="bottom"
>&#13;        There was something wrong in the request or Kannel was so
      configured that the message cannot be in any circumstances
      delivered. Check the request and Kannel configuration.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>503</TT
></TD
><TD
><TT
CLASS="literal"
>Temporal failure, try again later.</TT
></TD
><TD
VALIGN="bottom"
>&#13;        There was temporal failure in Kannel. Try again later.
   </TD
></TR
></TBODY
></TABLE
></DIV
><DIV
CLASS="table"
><A
NAME="AEN5254"
></A
><P
><B
>Table 7-17. SMS Push (send-sms) CGI Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
>username</TT
> (or <TT
CLASS="literal"
>user</TT
>)</TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Username or account name. Must be <TT
CLASS="literal"
>username</TT
> of the one
        'sendsms-user' group in the Kannel configuration,
        or results in 'Authorization failed' reply.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password</TT
> (or <TT
CLASS="literal"
>pass</TT
>)</TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Password associated with given <TT
CLASS="literal"
>username</TT
>. Must match
 corresponding field in the 'sendsms-user' group of
the Kannel configuration, or 'Authorization failed' is returned.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>from</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Phone number of the sender. This field is usually overridden
        by the SMS Center, or it can be overridden by
        <TT
CLASS="literal"
>faked-sender</TT
> variable in the
        <TT
CLASS="literal"
>sendsms-user</TT
> group. If this variable is not
        set, smsbox <TT
CLASS="literal"
>global-sender</TT
> is used.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>to</TT
></TD
><TD
><TT
CLASS="literal"
>phone number list</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Phone number of the receiver. To send to multiple receivers,
   separate each entry with <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>space</I
></SPAN
> (' ', '+'
   url-encoded) - but note that this can be deactivated via
   <TT
CLASS="literal"
>sendsms-chars</TT
> in the 'smsbox' group.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Contents of the message, URL encoded as necessary. The content
        can be more than 160 characters, but then
        <TT
CLASS="literal"
>sendsms-user</TT
> group must have
        <TT
CLASS="literal"
>max-messages</TT
> set more than 1.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>charset</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Charset of text message. Used to convert to a format suitable for
	7 bits or to UCS-2. Defaults to UTF-8 if coding is 7 bits and
	UTF-16BE if coding is UCS-2.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>udh</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional User Data Header (UDH) part of the message. Must be
         URL encoded.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional virtual smsc-id from which the message is supposed to 
	have arrived. This is used for routing purposes, if any denied
	or preferred SMS centers are set up in SMS center
	configuration. This variable can be overridden with a
        <TT
CLASS="literal"
>forced-smsc</TT
> configuration
        variable. Likewise, the <TT
CLASS="literal"
>default-smsc</TT
> variable
        can be used to set the SMSC if it is not set otherwise.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>flash</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Deprecated. See <TT
CLASS="literal"
>mclass</TT
>.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mclass</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. Sets the Message Class in DCS field.
	 Accepts values between 0 and 3, for Message Class 0 to 3, 
	 A value of 0 sends the message directly to display, 1 sends
	 to mobile, 2 to SIM and 3 to SIM toolkit.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>mwi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. Sets Message Waiting Indicator bits in DCS field.
	 If given, the message will be encoded as a Message Waiting
	 Indicator. The accepted values are 0,1,2 and 3 for activating the
	 voice, fax, email and other indicator, or 4,5,6,7 for deactivating,
	 respectively.
	 This option excludes the <TT
CLASS="literal"
>flash</TT
> option.
     <A
NAME="mwi-messages"
HREF="#FTN.mwi-messages"
><SPAN
CLASS="footnote"
>[a]</SPAN
></A
>
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>compress</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. Sets the Compression bit in DCS Field.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>coding</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. Sets the coding scheme bits in DCS field.
	 Accepts values 0 to 2, for 7bit, 8bit or UCS-2.
	 If unset, defaults to 7 bits unless a udh is defined, which sets
	 coding to 8bits.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>validity</TT
></TD
><TD
><TT
CLASS="literal"
>number (minutes)</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. If given, Kannel will inform SMS Center that it should only
	 try to send the message for this many minutes. If the destination
	 mobile is off other situation that it cannot receive the sms, the
	 smsc discards the message.
	 Note: you must have your Kannel box time synchronized with the SMS Center.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>deferred</TT
></TD
><TD
><TT
CLASS="literal"
>number (minutes)</TT
></TD
><TD
VALIGN="bottom"
>&#13;         Optional. If given, the SMS center will postpone the message to be
	 delivered at now plus this many minutes.
	 Note: you must have your Kannel box time synchronized with the SMS Center.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlrmask</TT
></TD
><TD
><TT
CLASS="literal"
>number (bit mask)</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Deprecated. See <TT
CLASS="literal"
>dlr-mask</TT
>.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-mask</TT
></TD
><TD
><TT
CLASS="literal"
>number (bit mask)</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional. Request for delivery reports with the state of the sent 
	   message. The value is a bit mask composed of: 1: Delivered to phone, 
	   2: Non-Delivered to Phone, 4: Queued on SMSC, 8: Delivered to SMSC, 
	   16: Non-Delivered to SMSC. Must set <TT
CLASS="literal"
>dlr-url</TT
> on 
	   <TT
CLASS="literal"
>sendsms-user</TT
> group or use the 
	   <TT
CLASS="literal"
>dlr-url</TT
> CGI variable. 
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlrurl</TT
></TD
><TD
><TT
CLASS="literal"
>string (url)</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Deprecated. See <TT
CLASS="literal"
>dlr-url</TT
>.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url</TT
></TD
><TD
><TT
CLASS="literal"
>string (url)</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional. If <TT
CLASS="literal"
>dlr-mask</TT
> is given, this is the url to
	   be fetched. (Must be url-encoded)
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pid</TT
></TD
><TD
><TT
CLASS="literal"
>byte</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional. Sets the PID value. (See ETSI Documentation).
	   Ex: SIM Toolkit messages would use something like 
	   <TT
CLASS="literal"
>&#38;pid=127&#38;coding=1&#38;alt-dcs=1&#38;mclass=3</TT
>
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>alt-dcs</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional. If unset, Kannel uses the alt-dcs defined on smsc configuration,
	   or 0X per default. If equals to 1, uses FX. If equals to 0, force 0X.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>rpi</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;	   Optional. Sets the Return Path Indicator (RPI) value. (See ETSI Documentation).
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>account</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;	Optional. Account name or number to carry forward for billing purposes.
	This field is logged as ACT in the log file so it allows you to do some
	accounting on it if your front end uses the same username for all services
	but wants to distinguish them in the log. In the case of a HTTP SMSC
	type the account name is prepended with the service-name (username) and a colon (:)
	and forwarded to the next instance of Kannel. This allows hierarchical accounting.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>binfo</TT
></TD
><TD
>string</TD
><TD
VALIGN="bottom"
>&#13;	Optional. Billing identifier/information proxy field used to pass arbitrary
	billing transaction IDs or information to the specific SMSC modules. For EMI2 this
	is encapsulated into the XSer 0c field, for SMPP this is encapsulated into the 
	service_type of the submit_sm PDU.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>priority</TT
></TD
><TD
>number</TD
><TD
VALIGN="bottom"
>&#13;     Optional. Sets the Priority value (range 0-3 is allowed).
     (Defaults to 0, which is the lowest priority).
   </TD
></TR
></TBODY
><TR
><TD
COLSPAN="3"
>Notes:<BR><A
NAME="FTN.mwi-messages"
>a. </A
>To set number of messages, use
	 <TT
CLASS="literal"
>mwi=[0-3]&#38;coding=0&#38;udh=%04%01%02%&#60;XX&#62;%&#60;YY&#62;</TT
>,
	 where YY are the number of messages, in HEX, and XX are <TT
CLASS="literal"
>mwi</TT
>
	 plus 0xC0 if <TT
CLASS="literal"
>text</TT
> field is not empty.<BR></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN5432"
>Using the HTTP interface to send OTA configuration messages</A
></H3
><P
>OTA messages can be sent to mobile phones or devices to auto-configure the  
       settings for WAP. They are actually complex SMS messages with UDH and sent as
       concatenated messages if too long (and compiled if necessary).</P
><P
>You may either pass an HTTP request as GET method or POST method to the 
		 HTTP interface.</P
><P
>If you want to send a configuration that is defined within Kannel's 
		 configuration file itself you have to pass a valid 
		 <TT
CLASS="literal"
>ota-id</TT
> value otherwise the content of the request will 
		 be compiled to as OTA message.</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5438"
>OTA settings and bookmark documents</A
></H4
><P
>&#13;       Here is an example XML document (this one contains CSD settings for logging
       in to a mobile service; note that you must store DTD locally):

<PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE CHARACTERISTIC-LIST SYSTEM "file:///gw/settings.dtd"&#62;
&#60;CHARACTERISTIC-LIST&#62;

  &#60;CHARACTERISTIC TYPE="ADDRESS"&#62;
    &#60;PARM NAME="BEARER" VALUE="GSM/CSD"/&#62;
    &#60;PARM NAME="PROXY" VALUE="10.11.12.13"/&#62;
    &#60;PARM NAME="PORT" VALUE="9201"/&#62;
    &#60;PARM NAME="CSD_DIALSTRING" VALUE="+12345678"/&#62;
    &#60;PARM NAME="PPP_AUTHTYPE" VALUE="PAP"/&#62;
    &#60;PARM NAME="PPP_AUTHNAME" VALUE="yourusername"/&#62;
    &#60;PARM NAME="PPP_AUTHSECRET" VALUE="yourauthsecret"/&#62;
    &#60;PARM NAME="CSD_CALLTYPE" VALUE="ISDN"/&#62;
    &#60;PARM NAME="CSD_CALLSPEED" VALUE="9600"/&#62;
  &#60;/CHARACTERISTIC&#62;

  &#60;CHARACTERISTIC TYPE="URL" 
                  VALUE="http://wap.company.com/"/&#62;

  &#60;CHARACTERISTIC TYPE="NAME"&#62;
    &#60;PARM NAME="NAME" VALUE="Your WAP Company"/&#62;
  &#60;/CHARACTERISTIC&#62;

&#60;/CHARACTERISTIC-LIST&#62;
</PRE
>

       A bookmark document looks like this:

<PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE CHARACTERISTIC_LIST SYSTEM "file:///gw/settings.dtd"&#62;
&#60;CHARACTERISTIC-LIST&#62;
  &#60;CHARACTERISTIC TYPE="BOOKMARK"&#62;
    &#60;PARM NAME="NAME" VALUE="WAP Company"/&#62;
    &#60;PARM NAME="URL" VALUE="http://wap.company.com/"/&#62;
  &#60;/CHARACTERISTIC&#62;
&#60;/CHARACTERISTIC-LIST&#62;
</PRE
>

       Document type definition (DTD) for these documents is not
       available from Internet, you must supply it as a file. Kannel
       gw directory contains an
       example, <TT
CLASS="literal"
>settings.dtd</TT
>.

       </P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5444"
>OTA syncsettings documents</A
></H4
><P
>Used for the provisioning of sync configuration to
	  SyncMl enabled handsets. Best supported by sonyericcsson
	  terminals.
	</P
><P
>Sample syncsettings documents to set contacts, connection data
	  and authentication:

<PRE
CLASS="programlisting"
>&#13;&#60;SyncSettings&#62;
&#60;Version&#62;1.0&#60;/Version&#62;
&#60;HostAddr&#62;http://syncml.server.com&#60;/HostAddr&#62;
&#60;RemoteDB&#62;
  &#60;CTType&#62;text/x-vcard&#60;/CTType&#62;
  &#60;CTVer&#62;2.1&#60;/CTVer&#62;
  &#60;URI&#62;contact&#60;/URI&#62;
  &#60;Name&#62;Address Book&#60;/Name&#62;
&#60;/RemoteDB&#62;
&#60;Name&#62;Synchonization&#60;/Name&#62;
&#60;Auth&#62;
  &#60;AuthLevel&#62;1&#60;/AuthLevel&#62;
  &#60;AuthScheme&#62;1&#60;/AuthScheme&#62;
  &#60;Username&#62;yourusername&#60;/Username&#62;
  &#60;Cred&#62;passwordbase64encoded&#60;/Cred&#62;
&#60;/Auth&#62;
&#60;/SyncSettings&#62;
</PRE
>

</P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5449"
>OMA provisioning content</A
></H4
><P
>OMA provisioning allows the configuration of a wider
	  range of settings than previously available in OTA
	  terminals. Refer to OMA-WAP-ProvCont-v1_1-20021112-C (at
	  http://www.openmobilealliance.org/tech/docs/) for details.
	</P
><P
>A shared secret (i.e. a pin or the phone IMSI) can be
	  used to authenticate the settings. Defaults are 'userpin'
	  and '1234' a. See the cgi variables 'sec' and 'pin' for
	  available authentication options.
	</P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN5453"
>GET method for the OTA HTTP interface</A
></H4
><P
>An example URL (OTA configuration defined in the Kannel 
		 configuration file):
	
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	http://smsbox.host.name:13013/cgi-bin/sendota?
	    otaid=myconfig&#38;username=foo&#38;password=bar&#38;to=0123456
	</KBD
></PRE
>

       URL containing XML document looks like this (you must URL encode it before sending
       it over HTTP): 

	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	http://smsbox.host.name:13013/cgi-bin/sendota?
	    username=foo&#38;password=bar&#38;to=0123456&#38;
	    text=MyURLEncodedXMLdocument&#38;type=settings
	</KBD
></PRE
>
       
       You can send either settings, bookmark, syncsettings, or
       oma-settings, set CGI variable type accordingly.  Default for
       this variable is settings.
       </P
><DIV
CLASS="table"
><A
NAME="AEN5460"
></A
><P
><B
>Table 7-18. OTA CGI Variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><TBODY
><TR
><TD
><TT
CLASS="literal"
>otaid</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Name or ID of the 'ota-setting' group in Kannel configuration
        that should be sent to the phone. This variable is optional.
        If it is not given the first 'ota-setting' group is sent. This
        is unnecessary when a XML document is send to the phone.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>username</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Username of the 'sendsms-user' group in Kannel configuration, that has
        been configured to send OTA messages.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Password associated with given <TT
CLASS="literal"
>username</TT
>. Must match
       corresponding field in 'sendsms-user' group in Kannel configuration, or
       'Authorization failed' is returned.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>to</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Number of the phone that is to receive the OTA configuration message.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>from</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Phone number of the sender. This field is usually overridden by
       the SMS Center, or it can be overridden by faked-sender
       variable in the sendsms-user group. If this variable is not
       set, smsbox global-sender is used.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Optional virtual smsc-id from which the message is supposed to 
	have arrived. This is used for routing purposes, if any denied
	or preferred SMS centers are set up in SMS center
	configuration. This variable can be overridden with a
        <TT
CLASS="literal"
>forced-smsc</TT
> configuration
        variable. Likewise, the <TT
CLASS="literal"
>default-smsc</TT
> variable
        can be used to set the SMSC if it is not set otherwise.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>text</TT
></TD
><TD
><TT
CLASS="literal"
>XML document</TT
></TD
><TD
VALIGN="bottom"
>&#13;       An URL encoded XML document, containing either settings or bookmarks.
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>type</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Type of the XML document, supported values are "settings",
       "bookmarks", "syncsettings", and "oma-settings". Default is "settings".
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>sec</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;       Security model used to authenticate oma-settings. One of:
       "userpin", "netwpin", "usernetwpin", or "userpinmac".
   </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pin</TT
></TD
><TD
><TT
CLASS="literal"
>number</TT
></TD
><TD
VALIGN="bottom"
>&#13;     Authentication token.
   </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="ppg"
></A
>Chapter 8. Setting up Push Proxy Gateway</H1
><P
>This chapter explains how to set up a push proxy gateway (PPG). 
       An example configuration file are given. A working push proxy gateway
      is described. Routing wap pushes to a certain smsc and asking for
      <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>SMS level</I
></SPAN
> delivery reports are described.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5531"
>Configuring ppg core group, for push initiator (PI) interface</A
></H2
><P
>PPG configuration group defines gateway's service interface.
     Configuring a PPG working with a trusted PI is easiest. Actually,
     you need no configuration at all: in this case a PPG with default 
     values will be set up. Do not rely on this, default values may change.
     For PPG core configuration variables, see table 7.1.
     </P
><P
>An example of a core configuration for PPG working only with 
     specific addresses follows. Note that ppg-deny-ip-list is not actually 
     necessary, but does make configuring simpler: IPs here are always denied,
     even when they are mentioned in the allowed IPs list.</P
><P
>Ppg-url is a simple stamp, used for routing requests to the right 
     service. You can change this stamp by setting <TT
CLASS="literal"
>push-url</TT
> 
     configuration variable.
     </P
><PRE
CLASS="programlisting"
>&#13;group = ppg
ppg-url = /wappush
ppg-port = 8080
concurrent-pushes = 100
users = 1024
ppg-allow-ip = 194.100.32.125;127.0.0.1
ppg-deny-ip = 194.100.32.89;194.100.32.103
trusted-pi = false
</PRE
><DIV
CLASS="table"
><A
NAME="AEN5538"
></A
><P
><B
>Table 8-1. PPG core group configuration variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ppg</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Mandatory value. Tells that we are configuring the PPG group.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-port</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             The port PPG is listening at. Default 8080.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-ssl-port (o)</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Mandatory value for PPG HTTPS support. The port at which PPG listens
             for HTTPS requests. There are no defaults; you must set the value 
             separately.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-server-cert-file</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Mandatory value for PPG HTTPS support. The file containing server's ssl
             certificate.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-server-key-file</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Mandatory value for PPG HTTPS support. The file containing server's ssl
             private key.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-url</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>url</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             URL locating PPG services. Default <TT
CLASS="literal"
>/wappush
             </TT
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>global-sender</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Sender phone number required by some protocols.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>concurrent-pushes</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Number of concurrent pushes expected. Note that PPG <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>&#13;             does</I
></SPAN
> work even value is too low; it will only be 
             slower. Default 100.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>users</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Number of actually configured user accounts. Note that PPG 
             <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>does</I
></SPAN
> work even value is too low; it will 
             only be slower. Default 1024.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>trusted-pi</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If true, PI does authentication for PPG. Obviously, both of them
             must reside inside same firewall. Default true. If this variable
             is true, all security variables are ignored (even though they
             may be present).
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-deny-ip</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ip-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             PPG will not accept pushes from these IPs. Wild-cards are allowed.
             If this attribute is missing, no IP is denied <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
> by this
             list </I
></SPAN
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-allow-ip</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ip-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             PPG will accept pushes from these, and only these, IPs. Wild-cards
             are allowed. Adding this list means that IPs not mentioned are 
             denied, too.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-smsc</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If no SMSC ID is given with the wappush HTTP request (see below), use
             this one as default route for all push messages.
     	     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-dlr</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If no dlr url is given with the wappush HTTP request (see below), use
             this one as default route for all push messages.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-smsbox-id</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             All ppg delivery reports are handled by this smsbox. This routes all
				 DLR messages inside beaerbox to the specified smsbox for processing
				 the HTTP requests to the DLR-URL.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>service-name</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             This is sms service name used by smsbox for wap push.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-dlr</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If no dlr url is given with the wappush HTTP request (see below), use
             this one as default route for all push messages.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>service-name</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             This is sms service name used by smsbox for wap push..
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>concatenation</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Segment wap push binary sms. Default on. You need
             not normally set this value.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>max-messages</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>integer</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Maximum number of sm messages generated. Default
             10. You need not set this variable, expect when 
             your push documents are <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>very</I
></SPAN
>
             long.
             </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5672"
>Configuring PPG user group variables</A
></H2
><P
>In addition of pi lists similar to the core group, ppg 
      configuration specific to a certain user contains variables used for
      authentication and enforcing restrictions to phone numbers pi may 
      contact. All variables are elaborated in table 7.2.</P
><P
>As an example, let us see how to configure a ppg user (a pi, 
      named here 'picom') allowed to send pushes only from a specified ip.
      </P
><PRE
CLASS="programlisting"
>&#13;group = wap-push-user
wap-push-user = picom
ppg-username = foo
ppg-password = bar
allow-ip = 62.254.217.163
</PRE
><P
>It goes without saying that in real systems you must use more
            complex passwords than bar.</P
><DIV
CLASS="table"
><A
NAME="AEN5678"
></A
><P
><B
>Table 8-2. PPG user group configuration variables</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>wap-push-user</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Mandatory value. Tells that we are configuring the users group.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>wap-push-user</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             (More) human readable name of an user.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-username</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Username for this user.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ppg-password</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Password for this user.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Phone number prefixes allowed in pushes coming from this pi. These
             prefixes must conform international phone number format.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-prefix</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Phone number prefixes denied in pushes coming from this pi. These
             prefixes must conform international phone number format.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>url</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Defines an url where from the white-list can be fetched. White list
             itself contains list of phone numbers accepting pushes from this 
             pi.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>url</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Defines an url where from the blacklist can be fetched. Blacklist 
             itself contains list of phone number not accepting pushes from 
             this pi.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allow-ip</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ip-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Defines IPs where from this pi can do pushes. Adding this list 
             means that IPs not mentioned are denied.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>deny-ip</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>ip-list</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Defines IPs where from this pi cannot do pushes. IPs not mentioned
             in either list are denied, too.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>default-smsc</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If no SMSC ID is given with the wappush HTTP request (see below), use
             this one as default route for this specific push user.
     	     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>forced-smsc</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Allow only routing to a defined SMSC ID for this specific push user.
     	     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>dlr-url</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If no dlr  is given with the wappush HTTP request (see below), use
             this one as default route for this specific push user.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsbox-id</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Smsbox handling delivery reports fro this user.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>forced-smsc</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Allow only routing to a defined SMSC ID for this specific push user.
     	     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>white-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;             Defines the set of phone-numbers accepting pushes from this 
             pi.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>black-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;             Defines the set of phone-numbers rejecting pushes from this 
             pi.
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>allowed-prefix-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;             Set of phone number prefixes allowed in pushes coming from this pi. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>denied-list-regex</TT
></TD
><TD
>POSIX regular expression</TD
><TD
VALIGN="bottom"
>&#13;             Set of phone number prefixes denied in pushes coming from this pi. 
        See section on <A
HREF="#regular-expressions"
>Regular Expressions</A
> for details.
        </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5801"
>Finishing ppg configuration</A
></H2
><P
>PPG uses SMS for sending SI to the phone and an IP bearer to
     fetch content specified by it (see chapter Overview of WAP Push). This
     means both wapbox and bearer smsc connections are in use. So your push 
     proxy gateway configuration file must contain groups core, wapbox, smsc 
     and smsbox. These are configured normal way, only smsc group may have 
     push-specific variables. Note that following configurations are only an 
     example, you may need more complex ones.
     </P
><P
>Bearerbox setup does not require any new variables:</P
><PRE
CLASS="programlisting"
>&#13;group = core
admin-port = 13000
smsbox-port = 13001
wapbox-port = 13002
admin-password = b
wdp-interface-name = "*"
log-file = "filename"
log-level = 1
box-deny-ip = "*.*.*.*"
box-allow-ip = "127.0.0.1"
unified-prefix = "00358,0"
</PRE
><P
>You must set up wapbox, for pulling (fetching) the wap data, and
      of course starting the push itself. No new variables here, either.
      </P
><PRE
CLASS="programlisting"
>&#13;group = wapbox
bearerbox-host = localhost
log-file = "filename"
log-level = 0
syslog-level = none
</PRE
><P
>To set up smsc connections, for pushing SI or SL over SMS. Here
      HTTP SMSC is used as an example. Variables no-sender and no-coding 
      simplify HTTP request generated by Kannel. Send-url specifies content 
      gateway, or sendsms service.
      </P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = http
smsc-id = HTTP
port = 10000
system-type = kannel
smsc-username = foo
smsc-password = bar
no-sender = true
no-coding = true
send-url = http://host:port/path
</PRE
><P
>To set up smsbox. This is used for ppg delivery reports,
     see later.</P
><PRE
CLASS="programlisting"
>&#13;group = smsbox
bearerbox-host = localhost
smsbox-id = dlrbox
</PRE
><P
>Kannel sources contain a sample push configuration file 
      <TT
CLASS="literal"
>gw/pushkannel.conf</TT
>.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5814"
>Running a push proxy gateway</A
></H2
><P
>Push proxy gateway is started by simply typing, using separate 
     windows:
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	gw/bearerbox [config-file]
	gw/wapbox [config-file]
	</KBD
></PRE
>
     You can, of course, use more complex command line options.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5819"
>An example using HTTP SMSC</A
></H2
><P
>An easy way to test and implement push services is to put ppg
     in the front of an existing sendsms service capable to send SMS data
     messages and to understand HTTP requests generated by HTTP SMSC.
     (See next chapter.) Then you need only configure SMSC configuration 
     send-url to point to sendsms service.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5822"
>An example of minimum SI document</A
></H2
><P
> Service indication (SI) should work with all types of
     phones, service loading does not. URL to be loaded is the
     main content of the document in both cases, however. Here an 
     example (this is a minimum si document, not usable for testing,
     probably, but you want PPG to generate only one one SM per 
     SI, if at all possible):</P
><PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE si PUBLIC "-//WAPFORUM//DTD SI 1.0//EN"
"http://www.wapforum.org/DTD/si.dtd"&#62;
&#60;si&#62;
    &#60;indication href="http://www.gni.ch"
        si-id="1@gni.ch"&#62;
            You have 4 new emails
    &#60;/indication&#62;
&#60;/si&#62;
</PRE
><P
>Note following points:
            a) Every SI must have different si-id. If there are none,
               href is used as an (very unsatisfactory) id.
            b) this si should not interrupt the phone's current action.
      </P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5827"
>An example push (tokenized SI) document</A
></H2
><P
>HTTP SMSC generates a HTTP get request when it get a send-message 
       event, expressed in Unicode. The content gateway, or the sendsms 
       service must, of course, understand this URL. So here is an example,
       cgi variable text contains the url escaped form of a SI document. It is
       usable for testing prototype phones.
       </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	http://matrix:8080/phplib/kannelgw.php?user=*deleted*&#38;
	pass=*deleted*=to=%2B358408676001&#38;text=3D%02%06%17%AE%96localhost
	%3A8080%00%AF%80%8D%CF%B4%80%02%05j%00E%C6%0C%03wap.iobox.fi%00%11%03
	1%40wiral.com%00%07%0A%C3%07%19%99%06%25%15%23%15%10%C3%04+%02%060%01
	%03Want+to+test+a+fetch%3F%00%01%01&#38;udh=%06%05%04%0B%84%23%F0
	</KBD
></PRE
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5832"
>Default network and bearer used by push proxy gateway</A
></H2
><P
> If network and bearer attributes of the pap control document are
       missing or set any, Kannel uses address type for routing purposes: if
       the address type is a phone number (TYPE=PLMN), network defaults to GSM
       and bearer to SMS; if it is a IP-address (TYPE=IPv4), network defaults
       to GSM and bearer to CSD. So following minimal pap document works:
<PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE pap PUBLIC "-//WAPFORUM//DTD PAP//EN"
          "http://www.wapforum.org/DTD/pap_1.0.dtd"&#62;
&#60;pap&#62;
  &#60;push-message push-id="9fjeo39jf084@pi.com"&#62;
    &#60;address address-value="WAPPUSH=+358408676001/TYPE=PLMN@ppg.carrier.com"/&#62;
  &#60;/push-message&#62;
&#60;/pap&#62;
</PRE
>
       </P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5836"
>Push related Kannel headers</A
></H2
><P
>This chapter recapitulates Kannel headers used by ppg.</P
><P
>PPG uses many Kannel headers. These are very similar as ones
       used by smsbox. (Both send sms to to the phone, after all.)</P
><DIV
CLASS="table"
><A
NAME="AEN5840"
></A
><P
><B
>Table 8-3. Kannel headers used by PPG</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>X-Kannel-SMSC</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>Name of smsc used to deliver this push.
       Smsc configuration must contain some of corresponding variables, 
       see </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>X-Kannel-DLR-URL</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>url</I
></SPAN
></TD
><TD
VALIGN="bottom"
>Url smsbox would call this url when doing 
       the delivery report. Note that it can contain all Kannel escapes.
       See table 6.7 for details.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>X-Kannel-DLR-Mask</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>Mask telling smsbox when it should do
       the delivery reports. Values are same as used by smsbox, see
       chapter Delivery Reports for details.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>X-Kannel-Smsbox-Id</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>Tells which smsbox does the delivery
       report. Smsbox configuration must contain corresponding 
       variable.</TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5873"
>Requesting SMS level delivery reports for WAP pushes</A
></H2
><P
>Push content is a normal binary SM, so you can ask delivery 
       reports for them. These are useful for testing purposes (did the
       phone get the content at all, or did it just reject it.) Another
       use is create fall-back services for phones not supporting displaying
       a specific push content. (MMS one being perhaps currently most
       obvious.) Generally speaking, this service is very similar to 
       smsbox one. See chapter Delivery Reports for details.</P
><P
> For ppg sms delivery reports you will need a fully working 
       smsbox. Add configuration variable <TT
CLASS="literal"
>smsbox-id</TT
> to
       <TT
CLASS="literal"
>smsbox</TT
> group (it is necessary, because there
       is no MT from any smsbox corresponding the delivery report 
       bearerbox is receiving):</P
><PRE
CLASS="programlisting"
>&#13;       group = smsbox
       smsbox-id = dlrbox
       bearerbox-host = localhost
       log-file = "/var/log/kannel/smsbox-core.log"
       log-level = 0
       access-log = "/var/log/kannel/smsbox-access.log"
</PRE
><P
> Start smsbox normal way after updating the configuration
       file. </P
><P
> You must add to PPG configuration file two less obvious
       variables: <TT
CLASS="literal"
>ppg-smsbox-id</TT
> and <TT
CLASS="literal"
>&#13;       service-name</TT
>. <TT
CLASS="literal"
>Ppg-smsbox-id</TT
> 
       defines smsbox through which you want to route delivery reports,
       <TT
CLASS="literal"
>service-name</TT
> makes possible for smsbox to
       handle wap pushes as a separate sms service.</P
><P
>Setting <TT
CLASS="literal"
>ppg-smsbox-id</TT
> will route all
       ppg messages through same smsbox. You can route delivery 
       reports of separate user through separate smsboxes, by using
       configuration variable <TT
CLASS="literal"
>smsbox-id</TT
> in group
       wap push user. Or you can use <TT
CLASS="literal"
>X-Kannel-Smsbox-Id
      </TT
>. This means routing every message separately. </P
><P
> You can supply dlr url and dlr mask as kannel header, or
       as a configuration variable in ppg user or ppg core group. (This
       is order of precedence, too.) First one is valid for only one
       message, second for a specific user, and third for every ppg
       user. </P
><P
> So following is a minimum ppg core group for sms delivery
       reports:</P
><PRE
CLASS="programlisting"
>&#13;group = ppg
ppg-url = /wappush
ppg-port = 8080
concurrent-pushes = 100
trusted-pi = true
users = 1024
service-name = ppg
ppg-smsbox-id = dlrbox
</PRE
><P
>And you can add Kannel headers to http post request. Here
       an example code snippet (C using Kannel gwlib; this example asks
       for all possible delivery reports).</P
><PRE
CLASS="programlisting"
>&#13;http_header_add(push_headers, "X-Kannel-SMSC", "link0");
http_header_add(push_headers, "X-Kannel-DLR-Url",
                "http://193.53.0.56:8001/notification-dlr?smsc-id=%i"
                "&#38;status=%d&#38;answer=%A&#38;to=%P&#38;from=%p&#38;ts=%t");
http_header_add(push_headers, "X-Kannel-DLR-Mask",
                octstr_get_cstr(dos = octstr_format("%d", 31)));
http_header_add(push_headers, "X-Kannel-Smsbox-Id", "dlrbox"));
</PRE
><P
>Here status=%d tells the type of the delivery report and
       answer=%A the delivery report itself (sms content of it).
       Other ones are needed to map delivery report to original wap
       push.</P
><P
>With these  you can use with following http post request</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;       http://193.53.0.56:8080/phplib/kannelgw.php?user=*deleted*&#38;
       pass=*deleted*=to=%2B358408676001&#38;text=3D%02%06%17%AE%96localhost
       %3A8080%00%AF%80%8D%CF%B4%80%02%05j%00E%C6%0C%03wap.iobox.fi%00%11%03
       1%40wiral.com%00%07%0A%C3%07%19%99%06%25%15%23%15%10%C3%04+%02%060%01
       %03Want+to+test+a+fetch%3F%00%01%01&#38;udh=%06%05%04%0B%84%23%F0
</KBD
></PRE
><P
>Note that you can use all sms service escapes in dlrurl, see
       Parameters (Escape Codes) for details.</P
><P
> If you want to set dlr url for a specific user, you must set
       configuration variable <TT
CLASS="literal"
>dlr-url</TT
>in <TT
CLASS="literal"
>&#13;       wap-push-user</TT
>, if for entire ppg, <TT
CLASS="literal"
>default-dlr-url
       </TT
> in group <TT
CLASS="literal"
>ppg</TT
>. Value must naturally match
       with one used in group smsc.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5905"
>Routing WAP pushes to a specific smsc</A
></H2
><P
> This chapter explains how to route wap push to a specific
       smsc. </P
><P
> Smsc routing for wap pushes is similar to sms pushes. So,
       firstly you must define configuration variable <TT
CLASS="literal"
>smsc-id
       </TT
> in smsc group (or groups) in question. Say you used
       value <TT
CLASS="literal"
>link0</TT
>. You can send this as a Kannel
       header:</P
><PRE
CLASS="programlisting"
>&#13;http_header_add(push_headers, "X-Kannel-SMSC", "link0");
</PRE
><P
>Then you can issue a request:</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;       http://193.53.0.56:8080/phplib/kannelgw.php?user=*deleted*&#38;
       pass=*deleted*=to=%2B358408676001&#38;text=3D%02%06%17%AE%96localhost
       %3A8080%00%AF%80%8D%CF%B4%80%02%05j%00E%C6%0C%03wap.iobox.fi%00%11%03
       1%40wiral.com%00%07%0A%C3%07%19%99%06%25%15%23%15%10%C3%04+%02%060%01
       %03Want+to+test+a+fetch%3F%00%01%01&#38;udh=%06%05%04%0B%84%23%F0
</KBD
></PRE
><P
> You can use configuration variables to route all messages of a
      specific user or all ppg messages. Set <TT
CLASS="literal"
>default-smsc</TT
>
      in group wap-push-user or in group ppg.</P
><P
>Again precedence of various methods of setting the smsc is 
      kannel header, then configuration variable in group wap push user and
      then in group ppg.</P
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="ssl-enabling"
></A
>Chapter 9. Using SSL for HTTP</H1
><P
>This chapter explains how you can use SSL to ensure
	secure HTTP communication on both, client and server side.
	</P
><P
>Beware that the gateway, is acting in both roles of
	the HTTP model:

	<P
></P
><OL
TYPE="1"
><LI
><P
>as HTTP client, i.e. for requesting URLs 
	   while acting as WAP gateway and while fetching information
		for the SMS services.</P
></LI
><LI
><P
>as HTTP server, i.e. for the administration HTTP
	   interface, the PPG and for the sendsms HTTP interface.
		</P
></LI
></OL
>

	That is why you can specify separate certification files within
	the core group to be used for the HTTP sides.</P
><P
>You can use one or both sides of the SSL support. There 
	is no mandatory to use both if only one is desired.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5928"
>Using SSL client support</A
></H2
><P
>To use the client support please use the following
	    configuration directive within the core group</P
><PRE
CLASS="programlisting"
>&#13;group = core
...
ssl-client-certkey-file = "filename"
</PRE
><P
>Now you are able to use https:// scheme URLs within 
 	    your WML decks and SMS services.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5933"
>Using SSL server support for the administration HTTP
	   interface</A
></H2
><P
>To use the SSL-enabled HTTP server please use the 
	    following configuration directive within the core group
		 </P
><PRE
CLASS="programlisting"
>&#13;group = core
...
admin-port-ssl = true
...
ssl-server-cert-file = "filename"
ssl-server-key-file = "filename"
</PRE
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5937"
>Using SSL server support for the sendsms HTTP
	   interface</A
></H2
><P
>To use the SSL-enabled HTTP server please use the 
	    following configuration directive within the core and 
		 smsbox groups
		 </P
><PRE
CLASS="programlisting"
>&#13;group = core
...
ssl-server-cert-file = "filename"
ssl-server-key-file = "filename"

group = smsbox
...
sendsms-port-ssl = true
</PRE
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN5941"
>Using SSL server support for PPG HTTPS interface</A
></H2
><P
>&#13;        If you want use PAP over HTTPS, (it is, a https scheme) add following 
        directives to the ppg core group:
<PRE
CLASS="programlisting"
>&#13;group = ppg
...
ppg-ssl-port = 8090
ssl-server-cert-file = "/etc/kannel/cert1.pem"
ssl-server-key-file = "/etc/kannel/key1.pem"
</PRE
>
        </P
><P
>&#13;        PPG uses a separate port for HTTPS traffic, so so you must define it. This
        means that you can use both HTTP and HTTPS, when needed.
        </P
></DIV
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="delivery-reports"
></A
>Chapter 10. SMS Delivery Reports</H1
><P
>This chapter explains how to set up Kannel to deliver delivery reports.
	</P
><P
>Delivery reports are a method to tell your system if the message
	has arrived on the destination phone. There are different things which can happen
	to a message on the way to the phone which are:
	</P
><P
>&#13;	<P
></P
><UL
><LI
><P
>Message gets rejected by the SMSC (unknown subscriber, invalid destination number etc).</P
></LI
><LI
><P
>Message gets accepted by the SMSC but the phone rejects the message.</P
></LI
><LI
><P
>Message gets accepted by the SMSC but the phone is off or out of reach.
	 The message gets buffered.</P
></LI
><LI
><P
>Message gets successfully delivered.</P
></LI
></UL
>
	</P
><DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>If you want to use delivery reports, you must define a <TT
CLASS="literal"
>smsc-id</TT
> for each smsc group.</P
></BLOCKQUOTE
></DIV
><P
>When you deliver SMS to Kannel you have to indicate what kind of delivery report messages you
	would like to receive back from the system. The delivery report types currently implemented are:
	<P
></P
><UL
><LI
><P
>1: delivery success</P
></LI
><LI
><P
>2: delivery failure</P
></LI
><LI
><P
>4: message buffered</P
></LI
><LI
><P
>8: smsc submit</P
></LI
><LI
><P
>16: smsc reject</P
></LI
></UL
>
	If you want multiple report types, you simply add the values together. For example if you want to get delivery success and/or failure
	you set the <TT
CLASS="literal"
>dlr-mask</TT
> value to 1+2. and so on. If you specify <TT
CLASS="literal"
>dlr-mask</TT
> on the URL you pass on to
	Kannel you also need to specify <TT
CLASS="literal"
>dlr-url</TT
>. <TT
CLASS="literal"
>dlr-url</TT
> should contain the URL to which
	Kannel should place a HTTP requests once the delivery report is ready to be delivered back to your system.
	</P
><P
>&#13;	An example transaction would work as following.
	<P
></P
><UL
><LI
><P
>1. you send a message using dlr-mask=7 and dlr-url=http://www.xyz.com/cgi/dlr.php?myId=123456&#38;type=%d</P
></LI
><LI
><P
>2. Kannel forwards the message to the SMSC and keeps track of the message</P
></LI
><LI
><P
>3. The SMSC can not reach the phone and thus returns a buffered message</P
></LI
><LI
><P
>4. Kannel calls http://www.xyz.com/cgi/dlr.php?myId=123456&#38;type=4 to indicate the message being buffered</P
></LI
><LI
><P
>5. The phone is switched on and the SMS gets delivered from the SMSC. The SMSC reports this to Kannel</P
></LI
><LI
><P
>6. Kannel calls http://www.xyz.com/cgi/dlr.php?myId=123456&#38;type=1 to indicate the final success</P
></LI
></UL
>
	<DIV
CLASS="note"
><BLOCKQUOTE
CLASS="note"
><P
><B
>Note: </B
>
	  If you put your own message ID in the dlr-url like in the example above, you can then use this ID to update your database
	  with the message status.
	  </P
></BLOCKQUOTE
></DIV
>
	Depending on the SMSC type not all type of messages are supported. For example a CIMD SMSC does
	not support buffered messages. Also some SMSC drivers have not implemented all DLR types.
	</P
></DIV
><DIV
CLASS="chapter"
><HR><H1
><A
NAME="bug-reporting"
></A
>Chapter 11. Getting help and reporting bugs</H1
><P
>This chapter explains where to find help with problems
	related to the gateway, and the preferred procedure for reporting
	bugs and sending corrections to them.</P
><P
>The Kannel development mailing list is devel@kannel.org.  To subscribe, send mail to <A
HREF="mailto:devel-subscribe@kannel.org"
TARGET="_top"
>devel-subscribe@kannel.org</A
>.
	This is currently the best location for asking help and reporting
	bugs. Please include configuration file and version number.</P
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="upgrading-notes"
></A
>Appendix A. Upgrading notes</H1
><P
>This appendix includes pertinent information about required
	changes on upgrades.
	</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6003"
>From 1.2.x or 1.3.1 to 1.3.2 and later</A
></H2
><P
>&#13;		<P
></P
><UL
><LI
><P
>1. <TT
CLASS="literal"
>at</TT
> module was dropped and <TT
CLASS="literal"
>at2</TT
> module is now called <TT
CLASS="literal"
>at</TT
></P
></LI
><LI
><P
>2. <TT
CLASS="literal"
>emi</TT
> module was renamed to <TT
CLASS="literal"
>emi_x25</TT
>, <TT
CLASS="literal"
>emi_ip</TT
> sub-module was dropped and <TT
CLASS="literal"
>emi2</TT
> is now called <TT
CLASS="literal"
>emi</TT
>.</P
></LI
></UL
>
	</P
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="certificates"
></A
>Appendix B. Certificate generation</H1
><P
>This appendix includes pertinent information about required SSL
		certificate genaration, where needed.
	</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6022"
>Self-signed 1024-bit RSA SSL certificates using openssl</A
></H2
><P
>&#13;		<P
></P
><OL
TYPE="1"
><LI
><P
>Generate private key:</P
><P
><TT
CLASS="literal"
>openssl genrsa -des3 -out server.key 1024</TT
></P
><P
>You will be asked for a passphrase.</P
></LI
><LI
><P
>Generate a certificate request:</P
><P
><TT
CLASS="literal"
>&#13;					openssl req -new -key server.key -out server.csr
				</TT
></P
><P
>Several questions follow. At the end you may send server.csr
					to a certificate authority, which in turn will sign it and
					generate the certificate for you, or you can sign it yourself.
			</P
></LI
><LI
><P
>Remove passphrase from key:</P
><P
><TT
CLASS="literal"
>cp server.key server.key.org</TT
>
				</P
><P
><TT
CLASS="literal"
>openssl rsa -in server.key.org -out server.key
				</TT
></P
><P
><TT
CLASS="literal"
>rm server.key.org</TT
></P
></LI
><LI
><P
>Self-sign the certificate:</P
><P
>If you chose not to send the request to a Certificate
					Authority, you will need to sign it yourself. This one is good
					for 1 year:</P
><P
><TT
CLASS="literal"
>openssl x509 -req -days 365 -in server.csr -signkey
					server.key -out server.crt</TT
></P
></LI
><LI
><P
>Move keys to desired location:</P
><P
><TT
CLASS="literal"
>mv server.crt /etc/kannel/public/server.crt</TT
>
				</P
><P
><TT
CLASS="literal"
>mv server.key /etc/kannel/private/server.key
				</TT
></P
><P
><TT
CLASS="literal"
>mv server.csr /etc/ianwap/private/ianwap.csr (key
					request)</TT
></P
></LI
></OL
>
	</P
><P
>Update configuration accordingly</P
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="AEN6058"
></A
>Appendix C. Using the fake WAP sender</H1
><P
>This appendix explains how to use the fake WAP sender
	to test the gateway.</P
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="AEN6061"
></A
>Appendix D. Using the fake SMS center</H1
><P
>Fakesmsc is a simple testing tool to test out Kannel and
	its SMS services. It <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>cannot</I
></SPAN
> be used to
	send messages to mobile terminals, it is just a simulated SMS
	center with no connection to real terminals.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6065"
>Setting up fakesmsc</A
></H2
><P
>This section sums up needed steps to set up system for
    fakesmsc use.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6068"
>Compiling fakesmsc</A
></H3
><P
>The fake SMS center should compile at the same time as main
     Kannel compiles. The outcome binary,
     <TT
CLASS="literal"
>fakesmsc</TT
>, is in <TT
CLASS="literal"
>test</TT
>
     directory. The source code is quite simple and trivial, and is
     easily edited.</P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6073"
>Configuring Kannel</A
></H3
><P
>To use <TT
CLASS="literal"
>fakesmsc</TT
> to test out Kannel, you
     have to add it to main configuration file (see above). The
     simplest form for this configuration group is like this:</P
><PRE
CLASS="programlisting"
>&#13;group = smsc
smsc = fake
port = 10000
</PRE
><P
>The fakesmsc configuration group accepts all common 'smsc' 
      configuration group variables, like <TT
CLASS="literal"
>smsc-id</TT
>,
      <TT
CLASS="literal"
>preferred-smsc-id</TT
> or
      <TT
CLASS="literal"
>denied-smsc-id</TT
>, which can be used to test out
      routing systems and diverted services, before setting up real
      SMS center connections. If you include a fakesmsc group when
      bearerbox is connected to real SMS centers, you should add
      the <TT
CLASS="literal"
>connect-allow-ip</TT
> variable to prevent
      unauthorized use.</P
><P
>To set up multiple fakesmsc'es, just add new
      groups. Remember to put a different port number to each one.</P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6084"
>Running Kannel with fakesmsc connections</A
></H2
><P
>After configuring Kannel, you can start testing
      it. The bearerbox will listen for fakesmsc client connections
      to the port(s) specified in the configuration file.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6087"
>Starting fake SMS center</A
></H3
><P
>Each fakesmsc is started from command line, with all sent
    messages after command name. If any options are used (see below),
    they are put between the command and the messages. The usage is as
    follows:</P
><PRE
CLASS="programlisting"
>&#13;test/fakesmsc [options] &#60;message1&#62; [message2 ...]
</PRE
><P
>Options and messages are explained below, but as a quick
    example, a typical startup can go like this:</P
><PRE
CLASS="programlisting"
>&#13;test/fakesmsc -i 0.1 -m 100 "100 200 text nop" "100 300 text echo this"
</PRE
><P
>This tells fakesmsc to connect to bearerbox at localhost:10000
    (default) and send a hundred messages with an interval of 0.1 seconds.
    Each message is from number 100, and is either to number 200 with
    message 'nop' or to 300 with message 'echo this'.</P
><P
>Messages received from bearerbox are shown in the same format
    (described below).</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN6095"
>Fake messages</A
></H4
><P
>Each message consists of four or five parts: sender number,
    receiver number, type, udh (if present) and main message itself.
    Sender and receiver numbers do not mean anything except for log files
    and number-based routing in Kannel.</P
><P
>The parts of a message are separated with spaces. As each message is
    taken as one argument, it must be put in quotation marks.</P
><P
>Message type must be one of the following: "text", "data", "ucs2", 
    "udh-data", "udh-text", "route" and "dlr-mask".
    Here are some examples:</P
><PRE
CLASS="programlisting"
>&#13;test/fakesmsc -i 0.01 -v 1 -m 1000 "100 300 text echo this message"
test/fakesmsc -i 0.01 -m 1000 "100 300 data echo+these+chars%03%04%7f"
test/fakesmsc -m 1 "100 500 udh-data %0eudh+stuff+here main+message"
</PRE
><P
>For "text", the rest of the argument is taken as the literal
    message. For "data", the next part must be the url-encoded version of
    the message. Space is coded as '+'. For "ucs2", the next part must be the
    url-encoded version of the message. For "udh-data", the next 2 parts
    are the UDH and main message. Both must be in url-encoded form. For "udh-text",
    the UDH part must be url-encoded, and the message is taken as literals.
    For "route" both values are literal, where the first value defines the smsbox
    route destination. For "dlr-mask" noth values are literal, where the first
    value defines the numerical DLR event.
    </P
><P
>If multiple messages are given, fakesmsc randomly chooses
    one for each sending.</P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN6103"
>Interactive mode</A
></H4
><P
>If no messages are passed on the command line when starting fakesmsc,
		it runs on "interactive mode".</P
><P
>When running on this mode, fakesmsc accept single messages typed on stdin
		(without quotation marks) and displays the responses on stdout. This allows
		for a more finely controlled interaction with the backend applications.</P
></DIV
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN6107"
>Fakesmsc command line options</A
></H4
><P
>Fake SMS center can be started with various optional command
   line arguments.</P
><DIV
CLASS="table"
><A
NAME="AEN6110"
></A
><P
><B
>Table D-1. Fakesmsc command line options</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Switch</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>-H</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>host</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;       Use host <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>host</I
></SPAN
> instead of default
       <TT
CLASS="literal"
>localhost</TT
>.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-r</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;       Use port number <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>port</I
></SPAN
> instead of default
       10000.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-i</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>interval</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;       Use message interval <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>interval</I
></SPAN
> (in seconds,
       fractions accepted) instead of default interval 1.0 seconds.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-m</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>max</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;       Send a maximum of <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>max</I
></SPAN
> messages. Value -1
       means that an unlimited number of messages is sent. Default -1.
       Using 0 can be useful to listen for messages sent via other
       channels.
     </TD
></TR
></TBODY
></TABLE
></DIV
><P
>In addition, fakesmsc accepts all common Kannel <A
HREF="#arguments"
><I
>Command line options</I
></A
> like 
    <TT
CLASS="literal"
>--verbosity</TT
>.</P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="AEN6151"
></A
>Appendix E. Setting up a test environment for Push Proxy Gateway</H1
><P
>This appendix explains how to set a test environment for PPG. 
       This contains a simulated SMSC, for instance a http server simulation
       (this is used as example, because it is simplest) and a simulated
       push initiator. Between them, there is the push proxy gateway to be
       tested. This means that you must configure HTTP SMSC.
       </P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6154"
>Creating push content and control document for testing</A
></H2
><P
>&#13;      Here is an example of a push control document, which gives PPG 
      instructions how to do the pushing.
      <PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE pap PUBLIC "-//WAPFORUM//DTD PAP//EN"
          "http://www.wapforum.org/DTD/pap_1.0.dtd"&#62;
&#60;pap&#62;
  &#60;push-message push-id="9fjeo39jf084@pi.com"
                deliver-before-timestamp="2001-09-28T06:45:00Z"
                deliver-after-timestamp="2001-02-28T06:45:00Z"
                progress-notes-requested="false"&#62;
    &#60;address address-value="WAPPUSH=+358408676001/TYPE=PLMN@ppg.carrier.com"/&#62;
    &#60;quality-of-service priority="low"
                        delivery-method="unconfirmed"
                        network-required="true"
                        network="GSM"
                        bearer-required="true"
                        bearer="SMS"/&#62;
  &#60;/push-message&#62;
&#60;/pap&#62;
      </PRE
>
      Because the push content is send to the phone over SMS, right value for
      <TT
CLASS="literal"
>network-required</TT
> and <TT
CLASS="literal"
>bearer-required
      </TT
> is true, for <TT
CLASS="literal"
>network</TT
> GSM and for <TT
CLASS="literal"
>bearer
      </TT
> SMS. However, you can omit these values altogether, if you use
      a phone number as an address. Address value is international phone number and
      it must start with plus. It is used here as an unique identifier, SMSC, or 
      sendsms script must transform it to an usable phone number.
      </P
><P
>&#13;      Here is an example of Service Indication, a type of push content. 
      Essentially, the phone displays, when it receives this SI, the text 
      "Want to test a fetch" and if the user wants, fetches the content 
      located by URL <TT
CLASS="literal"
>http://wap.iobox.fi</TT
>.
      <PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE si PUBLIC "-//WAPFORUM//DTD SI 1.0//EN"
          "http://www.wapforum.org/DTD/si.dtd"&#62;
&#60;si&#62;
  &#60;indication href="http://wap.iobox.fi"
              si-id="1@wiral.com"
              action="signal-high"
              created="1999-06-25T15:23:15Z"
              si-expires="2002-06-30T00:00:00Z"&#62;
    Want to test a fetch?
  &#60;/indication&#62;
&#60;/si&#62;
      </PRE
>
      Note that the date value of the si-expires attribute contains trailing
      zeroes. They are OK here, because SI tokenizer removes them. But phones
      does not accept them in the final SMS data message. You should probably
      use <TT
CLASS="literal"
>action="signal-high"</TT
> for testing purposes, for
      it causes an immediate presentation of the push message. Production
      usage is a quite another matter.
      </P
><P
>&#13;      Another example of push content is Service Loading. In principle, the phone
      should fetch immediately content from URL <TT
CLASS="literal"
>http://wap.iobox.fi
      </TT
> when it receives this document. This sounds quite insecure, and
      indeed, user invention is probably required before fetching.

      <PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE sl PUBLIC "-//WAPFORUM//DTD SL 1.0//EN"
          "http://www.wapforum.org/DTD/sl.dtd"&#62;
&#60;sl href="http://wap.iobox.fi"
    action="execute-high"&#62;
&#60;/sl&#62;
      </PRE
>
      </P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6169"
>Starting necessary programs</A
></H2
><P
>PPG test environment contains, in addition of wapbox and 
       bearerbox, two test programs, <TT
CLASS="literal"
>test_ppg</TT
> (simulating
       push initiator) and <TT
CLASS="literal"
>test_http_server</TT
> (simulating 
       a SMSC center accepting pushed content send over SMS. You can find 
       both of these programs in <TT
CLASS="literal"
>test</TT
> directory, and they 
       both are short and easily editable. </P
><P
>To set up a test environment, you must first configure a push
       proxy gateway (setting flag trusted-pi true makes testing easier). 
       This explained in Chapter "Setting up push proxy gateway". Then issue 
       following commands, in Kannel's root directory and in separate windows:
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	gw/bearerbox [config-file]
	gw/wapbox [config-file]
	</KBD
></PRE
>
       Of course you can use more complicated wapbox and bearerbox command
       line options, if necessary.</P
><P
>To run a http smsc,  start http server simulation:
	<PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	test/test_http_server -p port
	</KBD
></PRE
>
       You can, of course, select the port at will. Remember, though, that
       PPG listens at the port defined in the ppg configuration file. Other 
       <TT
CLASS="literal"
>test_http_server</TT
> options are irrelevant here.</P
><P
>Lastly, start making push requests, for instance with a test 
       program <TT
CLASS="literal"
> test_ppg</TT
>. Its first argument is a URL 
       specifying location of push services. Other arguments are two file 
       names, first one push content and second one pap control document. 
       (For command line options, see Table C.1.). For example doing one 
       push(you can simplify push url by setting a ppg configuration variable,
       see "Setting up push proxy gateway"; q flag here prevents dumping of 
       test_ppg program debugging information):
       </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	test/test_ppg -q http://ppg-host-name:ppg-port/ppg-url [content_file] 
	[control_file]
	</KBD
></PRE
><P
> This presumes that you have set trusted-pi true.
       </P
><P
>If you want use authentication in a test environment, you can pass
       username and password either using headers (setting flag -b) or url (you
       must have set trusted-pi false and added wap-push-user configuration group):
       </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	test/test_ppg -q http://ppg-host-name:ppg-port?username=ppg-username'&#38;'
	password=ppg-password [content_file] [control_file]
	</KBD
></PRE
><DIV
CLASS="table"
><A
NAME="AEN6190"
></A
><P
><B
>Table E-1. Test_ppg's command line options</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Switch</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>-c</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use content qualifier <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
> instead of 
             default <TT
CLASS="literal"
>si</TT
> (service indication). Allowed 
             values are wml, si, sl, sia, multipart, nil and scrap. Nil and 
             scrap are used for debugging purposes. Wml does work with some 
             older phone simulators.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-a</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use application id <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
> instead of default
             <TT
CLASS="literal"
>any</TT
>. Application identifies the application in
             the phone that should handle the push request. Sia, ua, mms, nil
             and scrap are accepted. Nil and scrap are used for debugging 
             purposes.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-e</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use transfer encoding when sending a push content. Only base64 is
             currently supported.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-b</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use headers for authentication, instead of url. Default off.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-i</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Wait interval <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
> instead of default
             <TT
CLASS="literal"
>0</TT
> between pushes.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-r</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Do <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
> requests instead of default
             <TT
CLASS="literal"
>1</TT
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-t</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
> threads instead of default
             <TT
CLASS="literal"
>1</TT
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-s</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use <TT
CLASS="literal"
>string</TT
> as a X-WAP-Application-Id
             header (You must supply whole header).
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-I</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Use <TT
CLASS="literal"
>string</TT
> as a X-WAP-Initiator-URI
             header (You must supply whole header).
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-B</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If set, accept binary content. Default is off.
             <TT
CLASS="literal"
>1</TT
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-d</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>enumerated string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             Set delimiter to be used. Acceptable values are crlf and
             lf. Default is <TT
CLASS="literal"
>crlf</TT
>.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-p</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             If set, add an preamble (hard-coded one). Default
             is off.
             </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>-E</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;             if set, add an epilogue (hard-coded). Default is off.
             </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6291"
>Using Nokia Toolkit as a part of a developing environment</A
></H2
><P
>This chapter describes a developing environment using Nokia 
       Toolkit instead of <TT
CLASS="literal"
>test_http_server</TT
> program.
       </P
><P
>You cannot use a real phone for testing a push server. Sending
       random messages to a phone does not work, because its only feedback
       (if it works properly) in error situations is dropping the offending
       message.</P
><P
>Nokia Toolkit, instead, displays push headers, decompiles
       tokenized documents and outputs debugging information. It is not,
       of course, a carbon copy of a real phone. But it is still useful
       for checking spec conformance of push servers.</P
><P
>Toolkit runs on Windows, the first thing you must is to install
       a virtual machine (VMWare is one possibility) in the machine where
       Kannel runs. Then you must configure Toolkit for working with a push
       gateway.</P
><P
>Then start <TT
CLASS="literal"
>bearerbox</TT
> and <TT
CLASS="literal"
>wapbox
       </TT
> similar way as told before. You must set the correct client
       address in the push document send by <TT
CLASS="literal"
>test_ppg</TT
>
       program. Use IP address of our virtual machine (easiest way to get this
       is to ping your virtual machine name in the dos prompt window). Your
       bearer is in this case IP. An example pap document follows:</P
><PRE
CLASS="programlisting"
>&#13;&#60;?xml version="1.0"?&#62;
&#60;!DOCTYPE pap PUBLIC "-//WAPFORUM//DTD PAP//EN"
          "http://www.wapforum.org/DTD/pap_1.0.dtd"&#62;
&#60;pap&#62;
  &#60;push-message push-id="9fjeo39jf084@pi.com"
                deliver-before-timestamp="2001-09-28T06:45:00Z"
                deliver-after-timestamp="2001-02-28T06:45:00Z"
                progress-notes-requested="false"&#62;
    &#60;address address-value="WAPPUSH=192.168.214.1/TYPE=IPV4@ppg.carrier.com"/&#62;
    &#60;quality-of-service priority="low"
                        delivery-method="unconfirmed"
    &#60;/quality-of-service&#62;
  &#60;/push-message&#62;
&#60;/pap&#62;
       </PRE
><P
>Note address-value format. It is contains type and value, 
       because PAP protocol supports different address formats.</P
><P
>You must use <TT
CLASS="literal"
>test_ppg</TT
>'s -a and -c flags
       when pushing messages to Toolkit. -A defines the client application
       handling pushes, right value for it is ua. -C defines the content 
       type of your push message. SI works with all Toolkits, wml only
       with some older versions. </P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6306"
>Testing PAP protocol over HTTPS</A
></H2
><P
>&#13;        When testing HTTPS connection to PPG, you probably want use test_ppg's
        configuration file, because number of required parameters is quite 
        high. Here is a example test_ppg configuration file:
        </P
><PRE
CLASS="programlisting"
>&#13; group = test-ppg
 retries = 2
 pi-ssl = yes
 ssl-client-certkey-file = /etc/kannel/certkey.pem
 
 group = configuration
 push-url = https://localhost:8900/wappush
 pap-file = /etc/kannel/ipnoqos.txt
 content-file = /etc/kannel/si.txt
 username = foo
 password = bar
</PRE
><P
>&#13;        With a configuration file, you can do a push by typing:
        </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;        test/test_ppg -q [configuration_file]
	</KBD
></PRE
><DIV
CLASS="table"
><A
NAME="AEN6313"
></A
><P
><B
>Table E-2. Test_ppg's configuration file directives</B
></P
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Directive</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>test_ppg</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory parameter. Start of test_ppg's core group.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>retries</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              The client tries to log in to PPG <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>number</I
></SPAN
> times
              before discarding the push request. Default is 2.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pi-ssl</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>boolean</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory parameter for HTTPS connection. Does the client use HTTPS
              connection. Default is no.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-client-certkey-file</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>filename</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;               Mandatory parameter for HTTPS connection. File containing the client's 
               ssl certificate and private key. 
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>ssl-trusted-ca-file</TT
></TD
><TD
>filename</TD
><TD
VALIGN="bottom"
>&#13;              Mandatory parameter for HTTPS connection.This file contains the 
              certificates test_ppg is willing to trust. If this directive is not set, 
              certificates are not validated and HTTPS would not be tested.
	      </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>group</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>configuration</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory parameter. Start of test_ppg's test group.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>push-url</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>url</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory value. URL locating PPG's services.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>pap-file</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>filename</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory value. File containing pap request's control document.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>content-file</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>filename</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory value. File containing pap request's content document.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>username</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory value. PPG service user's username.
              </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>password</TT
></TD
><TD
><SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>string</I
></SPAN
></TD
><TD
VALIGN="bottom"
>&#13;              Mandatory value. PPG service user's password.
              </TD
></TR
></TBODY
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="AEN6388"
></A
>Appendix F. Setting up a dial-up line</H1
><P
>This appendix explains how to set up a dial-up line in Linux
	for use with the Kannel WAP gateway. In order for it to work you need
	a Linux kernel with PPP capabilities. Most distributions provides PPP
	kernel support by default. For more information how to compile PPP
	support into the kernel please read the "Linux Kernel HOWTO"
	at http://www.linuxdoc.org/.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6391"
>Analog modem</A
></H2
><P
>This section explains how to set up a dial-up line with an
	analog modem.</P
><P
>Download and install the mgetty package.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	rpm -ivh mgetty-VERSION-rpm
	</KBD
></PRE
><P
>To run mgetty as a daemon, add the following line to
	/etc/inittab.</P
><P
>Read man inittab for more detailed information. In this
	example we assume your modem is connected to the serial port ttyS0
	(COM 1).</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	S0:2345:respawn:/sbin/mgetty ttyS0 -x 6 -D /dev/ttyS0
	</KBD
></PRE
><P
>We need to start the pppd automatically when mgetty receives
	an AutoPPP request. Add the next line to /etc/mgetty+sendfax/login.config</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	/AutoPPP/ - - /usr/sbin/pppd file /etc/ppp/options.server
	</KBD
></PRE
><P
>In /etc/mgetty+sendfax/mgetty.config you might need to change
	the connect speed between the computer and the modem. Note: this is
	not the connect speed between the WAP client and the server modem.
	If you are e.g. going to use a Nokia 7110 as the server side modem
	you need to change the speed to 19200. Usually you can just leave the
	speed to the default value (38400).</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	speed 38400
	</KBD
></PRE
><P
>Add the following lines to /etc/ppp/options.server</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	refuse-chap
	require-pap
	lock
	modem
	crtscts
	passive
	192.168.1.10:192.168.1.20
	debug
	</KBD
></PRE
><P
>In /etc/ppp/pap-secrets add the username and password for the
	ppp account. The IP address is the one assigned to the phone.</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	wapuser * wappswd 192.168.0.20
	</KBD
></PRE
><P
>Configure your phone (this example is for Nokia 7110)</P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;	homepage http:/yourhost/hello.wml
	connection type continuous
	connection security off
	bearer data
	dial up number (your phone number)
	ip address (IP of host running bearerbox)
	auth type normal
	data call type analogue
	data call speed 9600
	username wapuser
	password wappswd
	</KBD
></PRE
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6416"
>ISDN terminal</A
></H2
><P
>This section needs to be written</P
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="regular-expressions"
></A
>Appendix G. Regular Expressions</H1
><P
>Note: this is not intended to be an introduction to regular expressions (short: regex) but a 
    description of their application within Kannel. For general information regarding regexes
    please refer to <A
HREF="#Biblio-regexp"
>[Biblio-regexp]</A
>.
    </P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6423"
>Syntax and semantics of the regex configuration parameter</A
></H2
><P
>This section describes the regex-configuration parameters and their effects in combination with the
        respective non-regex-parameter, e.g. <TT
CLASS="literal"
>white-list</TT
> and <TT
CLASS="literal"
>white-list-regex</TT
>.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6428"
>How-to setup the regex-parameters</A
></H3
><P
>examples, short syntax, what happens on errors
                Regex-parameters are configured just as every other parameter is configured. Regular expressions are
                supported as defined by POSIX Extended Regular Expressions. Suppose a configuration where only SMS messages
                originating from a sender using a number with a prefix of "040", "050", "070" or "090" are accepted.
                Without regexes the configuration would read
                <PRE
CLASS="programlisting"
>&#13;                allowed-prefix="040;050;070;090"
                </PRE
>
                Using regular expressions yields a more concise configuration
                <PRE
CLASS="programlisting"
>&#13;                allowed-prefix-regex=^0[4579]0
                </PRE
>
                The following table gives an overview over some regex-operators and their meaning, the POSIX Regular
                Expressions manual page (regex(7)). Once again, the extended regex-syntax is used and the table is 
                just meant as a means to give a quick-start to regular expressions, the next section features some more
                complex examples.
                <DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN6433"
></A
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><COL><COL><THEAD
><TR
><TH
>Operator</TH
><TH
>Meaning</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>|</TT
></TD
><TD
>or, for example "dog|hog" matches dog or hog.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>{number,number}</TT
></TD
><TD
>repetition, for example "a{2,5}" matches - among others - 
                                        "aa", "aaa" and "baaaaad"</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>*</TT
></TD
><TD
>shorthand for {0,}</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>?</TT
></TD
><TD
>shorthand for {0,1}</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>+</TT
></TD
><TD
>shorthand for {1,}</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>[]</TT
></TD
><TD
>bracket expression, defines a class of possible single character matches.
                                        For example "[hb]og" matches "hog" and "bog". If the expression starts with
                                        <TT
CLASS="literal"
>^</TT
> then the class is negated, e.g. "[^hb]og" does not match
                                        "hog" and "bog" but matches for example "dog".</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>()</TT
></TD
><TD
>groups patterns, e.g. "[hb]o(g|ld)" matches "hog", "hold", "bog", "bold"
                                        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>[:class:]</TT
></TD
><TD
>A character class such as digit, space etc. See wctype(3) for details.
                                        </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>^</TT
></TD
><TD
>Start of line anchor.</TD
></TR
><TR
><TD
><TT
CLASS="literal"
>$</TT
></TD
><TD
>End of line anchor.</TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
>

                The advantages of regular expressions are at hand
		<P
></P
><UL
><LI
><P
>Regexes are easier to understand, if one is fluent in POSIX Regular Expressions. 
                                Although simple expressions as shown above should be clear to everyone who has
                                ever used a standard UN*X shell.
                          </P
></LI
><LI
><P
>Regexes are easier to maintain. Suppose the example above needed to cope with 
                        dozens of different prefixes each with subtle differences, in such cases using a - carefully
                        constructed - regular expression could help to keep things in apple pie order. 
                        Furthermore regexes help reducing redundancy within the configuration.
                        </P
></LI
><LI
><P
>Regexes more flexible than standard parameters.
                        </P
></LI
></UL
>
                Nevertheless, it must be mentioned that - in addition to the overhead involved - complexity is an issue, 
                too. Although the syntactic correctness of each used regular expression is ensured (see below)
                    the semantic correctness cannot be automatically proofed.
                </P
><P
>&#13;                Expressions that are not compilable, which means they are not valid POSIX regexes, force  Kannel
                to panic with a message like (note the missing "]")
	<PRE
CLASS="screen"
><SAMP
CLASS="computeroutput"
>&#13;                ERROR: gwlib/regex.c:106: gw_regex_comp_real: regex compilation `[hbo(g|ld)' failed: Invalid regular expression (Called from gw/urltrans.c:987:create_onetrans.)
                PANIC: Could not compile pattern '[hbo(g|ld)'
	</SAMP
></PRE
>
                As shown the erroneous pattern is reported in the error message. 
                </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6491"
>Regex and non-regex-parameters</A
></H3
><P
>&#13;                Using the regex and non-regex version of a parameter at the same time should be done with caution.
                Both are combined in a boolean-or sense, for example
                <PRE
CLASS="programlisting"
>&#13;                white-list=01234
                white-list-regex=^5(23)?$
                </PRE
>
                implies that a number is accepted either if it is "01234", "5" or "523" - note the use of anchors!
                The same goes for all the other parameters, thus both mechanisms can be used without problems in parallel,
                but care should be taken that the implications are understood and wanted.
                </P
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6495"
>Performance issues</A
></H3
><P
>While there is some overhead involved, the actual performance degradation is negligible.
                At startup - e.g. when the configuration files are parsed - the regular expressions are pre-compiled
                and stored in the pre-compiled fashion, thus future comparisons involve executing the expression on 
                some string only. To be on the sure side, before using regexes extensively some benchmarking should be
                performed, to verify that the loss of performance is acceptable.
                </P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6498"
>Examples</A
></H2
><P
>This section discusses some simple scenarios and potential solutions based on regexes.
        The examples are not meant to be comprehensive but rather informative.</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6501"
>Example 1: core-configuration</A
></H3
><P
>The bearerbox must only accept SMS messages from three costumers. The first costumer uses numbers
                that always start with "0824" the second one uses numbers that start with either "0123" and end in 
                "314" or start with "0882" and end in "666". The third costumer uses numbers starting with "0167"
                and ending in a number between "30" and "57".</P
><P
>&#13;                Important in this and in the following examples is the use of anchors, otherwise a "string contains"
                semantic instead of a "string is equal" semantic would be used.
                </P
><PRE
CLASS="programlisting"
>&#13;                group=core
                ...
                white-list-regex=^((0824[0-9]+)|(0123[0-9]+314)|(0882[0-9]+666)|(0167[0-9]+([34][0-9]|5[0-7])))$
                ...
                </PRE
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6506"
>Example 3: smsc-configuration</A
></H3
><P
>Only SMS messages originating from certain SMSCs (<TT
CLASS="literal"
>smsc-id</TT
> is either 
                        "foo", "bar" or "blah")
                are preferably forwarded to this smsc. 
                Furthermore all SMSCs with an id containing "vodafone" must never
                be forwarded to the smsc. Not the missing anchors around "vodafone".</P
><PRE
CLASS="programlisting"
>&#13;                group=smsc
                ...
                preferred-smsc-id-regex=^(foo|bar|blah)$
                denied-prefix-regex=vodafone
                ...
                </PRE
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6511"
>Example 4: sms-service-configuration</A
></H3
><P
>Please note that there are a mandatory <TT
CLASS="literal"
>keyword</TT
> and an optional
                <TT
CLASS="literal"
>keyword-regex</TT
> fields.
                That means that service selection can be simplified as in the following example.
                Suppose that some Web-content should be delivered to the mobile. Different costumers use the 
                same service but they rely on different keywords. Whenever a sms-service is requested, Kannel
                first checks whether a regex has been defined, if not a literal match based on <TT
CLASS="literal"
>keyword</TT
>
                is performed. If a regex is configured then the literal match is never tried.
                </P
><PRE
CLASS="programlisting"
>&#13;                group=sms-service
                ...
                keyword=web_service
                keyword-regex=^(data|www|text|net)$
                get-url=http://someserver.net/getContent.jsp
                ...
                </PRE
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="meta-data"
></A
>Appendix H. Meta Data</H1
><P
>This appendix describes the elements and syntax required to access meta-data coming from and going to SMSC connections.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6521"
>Overview</A
></H2
><P
>Many SMSC services have means to exchange data that doesn't conform to the established format</P
><P
>For example, the SMPP protocol defines the TLV (Tag, Length, Value) mechanism to allow adding arbitrary parameters
      to it's PDU's, thus extending it's functionality.</P
><P
>To achieve this, a special group and parameters were added to abstract the meta-data into something that could be used disregarding
      the SMSC type.</P
><P
>Currently only the SMPP module is implemented, but the format chosen allows for other modules to be added in the future.</P
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6527"
>SMPP Implementation</A
></H2
><P
>A special group type <TT
CLASS="literal"
>smpp-tlv</TT
> is needed for each TLV. Each group defines the address, data type and length of the TLV</P
><P
>Example configuration:</P
><PRE
CLASS="programlisting"
>&#13;group = smpp-tlv
name = my_tlv_name
tag = 0x1601
type = octetstring
length = 20
smsc-id = a;b;c
</PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN6533"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Data Type</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
><TT
CLASS="literal"
>tag</TT
></TD
><TD
><TT
CLASS="literal"
>hex</TT
></TD
><TD
VALIGN="bottom"
>&#13;        32-Bit HEX address for the given TLV. Must match SMPP specifications for the TLV (or be agreed with the SMSC operator).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>type</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Accepted data type. Accepted values are <TT
CLASS="literal"
>integer</TT
>, <TT
CLASS="literal"
>nulterminated</TT
> and <TT
CLASS="literal"
>octetstring</TT
>.
        Must match SMPP specifications for the TLV (or be agreed with the SMSC operator).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>length</TT
></TD
><TD
><TT
CLASS="literal"
>integer</TT
></TD
><TD
VALIGN="bottom"
>&#13;        Maximum data length expected in bytes. Must match SMPP specifications for the TLV (or be agreed with the SMSC operator).
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>smsc-id</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        An optional smsc-id for which this TLV is valid. If smsc-id is not given
		then this TLV is valid for all SMSCs.
		To define list of smsc-id, just use ; as split char.
     </TD
></TR
><TR
><TD
><TT
CLASS="literal"
>const</TT
></TD
><TD
><TT
CLASS="literal"
>string</TT
></TD
><TD
VALIGN="bottom"
>&#13;        An optional constant value which is used if no value is set for this TLV via meta-data.
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
><P
>&#13;Beside defined in the configuration <TT
CLASS="literal"
>smpp-tlv</TT
> group, SMPP also supports some hardcoded <TT
CLASS="literal"
>meta-data</TT
>
values:
<P
></P
><UL
><LI
><P
>data_coding</P
></LI
><LI
><P
>source_addr_ton</P
></LI
><LI
><P
>source_addr_npi</P
></LI
><LI
><P
>dest_addr_ton</P
></LI
><LI
><P
>dest_addr_npi</P
></LI
></UL
>
</P
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6588"
>MO Messages</A
></H3
><P
>Meta Data coming from MO messages comes urlencoded into the <TT
CLASS="literal"
>%D</TT
> parameter. Only TLV parameters defined on the configuration file are honored.</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN6592"
>Example</A
></H4
><P
><TT
CLASS="literal"
>http://localhost/myscript?...&#38;meta-data=%D&#38;...</TT
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><HR><H3
CLASS="sect2"
><A
NAME="AEN6596"
>MT Messages</A
></H3
><P
>To send into an MT messages the <TT
CLASS="literal"
>meta-data</TT
> parameter should be used.</P
><P
>The format used to pass the data has 2 parts: The <TT
CLASS="literal"
>?smsc-type?</TT
> (surrounded by question marks),
        which specify the kind of smsc receiving the data (at the moment only <TT
CLASS="literal"
>smpp</TT
> is implemented) and then a set of key/value
        pairs with the data to be transmitted. Extra smsc-types can be added surrounded by question marks and followed by the key/value pairs.</P
><P
>In other words,  the data should be coded using the following format, where URLENCODE() implies that the data between parentheses should
        be urlencoded:</P
><P
><TT
CLASS="literal"
>?URLENCODE(&#60;smsc-type1&#62;)?URLENCODE(key1)=URLENCODE(value1)&#38;URLENCODE(key2)=URLENCODE(value2)&#38;...</TT
></P
><P
><TT
CLASS="literal"
>?URLENCODE(&#60;smsc-type2&#62;)?URLENCODE(key1)=URLENCODE(value1)&#38;...</TT
></P
><P
>Only the parameters defined on the configuration file are honored.</P
><P
>Important: For the sendsms interface, you must URLENCODE the resulting string again to pass it as a single parameter on the URL.</P
><DIV
CLASS="sect3"
><HR><H4
CLASS="sect3"
><A
NAME="AEN6610"
>Examples</A
></H4
><P
>If we want to send the parameter "my-data" with value "Hello World" to an SMSC over SMPP, we'd use:</P
><P
>sendsms get-url:</P
><P
><TT
CLASS="literal"
>http://localhost:13013/cgi-bin/sendsms?...&#38;meta-data=%3Fsmpp%3Fmy-data%3DHello%2BWorld</TT
></P
><P
>sendsms post:</P
><P
>Send <TT
CLASS="literal"
>?smpp?my-data=Hello+World</TT
> on the <TT
CLASS="literal"
>X-Kannel-Meta-Data</TT
> header</P
><P
>XML:</P
><P
><TT
CLASS="literal"
>&#60;meta-data&#62;?smpp?my-data=Hello+World&#60;/meta-data&#62;</TT
></P
></DIV
></DIV
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
><A
NAME="AEN6623"
></A
>Appendix I. Log files</H1
><P
>This appendix describes the log file format.</P
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6626"
>Bearerbox Access Log</A
></H2
><PRE
CLASS="screen"
><SAMP
CLASS="computeroutput"
>&#13;	2001-01-01 12:00:00 Sent SMS [SMSC:smsc] [SVC:sms] [ACT:account] [BINFO:binfo] [FID:1234567890] [META:meta]
            [from:12345] [to:67890] [flags:0:1:0:0:0] [msg:11:Hello World] [udh:0]
	</SAMP
></PRE
><DIV
CLASS="informaltable"
><P
></P
><A
NAME="AEN6630"
></A
><TABLE
BORDER="0"
FRAME="void"
CLASS="CALSTABLE"
><COL><COL><COL><THEAD
><TR
><TH
>Variable</TH
><TH
>Value</TH
><TH
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
>Date</TD
><TD
>2001-01-01 12:00:00</TD
><TD
VALIGN="bottom"
>&#13;       Date
     </TD
></TR
><TR
><TD
>Result</TD
><TD
>Sent SMS</TD
><TD
VALIGN="bottom"
>&#13;       Result: Send, failed, DLR (deliver report), Received, etc.
     </TD
></TR
><TR
><TD
>SMSC</TD
><TD
>smsc</TD
><TD
VALIGN="bottom"
>&#13;	     Smsc id (<TT
CLASS="literal"
>smsc-id</TT
>) defined in configuration 
	     group <TT
CLASS="literal"
>smsc</TT
> 
     </TD
></TR
><TR
><TD
>SVC</TD
><TD
>sms</TD
><TD
VALIGN="bottom"
>&#13;	     Service name (<TT
CLASS="literal"
>name</TT
>) defined in configuration 
	     group <TT
CLASS="literal"
>sendsms-user</TT
>
     </TD
></TR
><TR
><TD
>ACT</TD
><TD
>account</TD
><TD
VALIGN="bottom"
>&#13;	     Account name (<TT
CLASS="literal"
>name</TT
>) defined in configuration 
	     group <TT
CLASS="literal"
>sendsms-user</TT
>
     </TD
></TR
><TR
><TD
>BINF</TD
><TD
>binfo</TD
><TD
VALIGN="bottom"
>&#13;	     Billing information used to send this message.
     </TD
></TR
><TR
><TD
>Foreign ID</TD
><TD
>1234567890</TD
><TD
VALIGN="bottom"
>&#13;	     Foreign (SMSC-provided) Message ID (only available on MT messages)
     </TD
></TR
><TR
><TD
>META</TD
><TD
>meta-data</TD
><TD
VALIGN="bottom"
>&#13;	     Meta-data used to send this message.
             See <A
HREF="#meta-data"
>Meta Data</A
> for an explanation about meta-data.
     </TD
></TR
><TR
><TD
>from</TD
><TD
>12345</TD
><TD
VALIGN="bottom"
>&#13;	     Sender
     </TD
></TR
><TR
><TD
>to</TD
><TD
>67890</TD
><TD
VALIGN="bottom"
>&#13;	     Recipient
     </TD
></TR
><TR
><TD
>Flags</TD
><TD
>0:1:0:0:0</TD
><TD
VALIGN="bottom"
>&#13;	     Flags: MClass, Coding, MWI, Compress, DLRMask
     </TD
></TR
><TR
><TD
>Message Text</TD
><TD
>11:Hello World</TD
><TD
VALIGN="bottom"
>&#13;	     Size of message and message dump (in text or hex if it's binary)
     </TD
></TR
><TR
><TD
>User Data Header</TD
><TD
>0:</TD
><TD
VALIGN="bottom"
>&#13;	     Size of UDH and UDH Hex dump 
     </TD
></TR
></TBODY
></TABLE
><P
></P
></DIV
></DIV
><DIV
CLASS="sect1"
><HR><H2
CLASS="sect1"
><A
NAME="AEN6697"
>Log rotation</A
></H2
><P
>If Kannel is configured so that the bearerbox, wapbox and/or smsbox 
        log to file each of these log files will continue to grow unless administered
        in some way (this is specially true if access logs are created and/or the 
        log level is set to debug). </P
><P
>&#13;        A typical way of administering log files is to 'rotate' the logs on a regular 
        basis using a tool such as logrotate.  A sample logrotate script (to be added 
        to /etc/logrotate.d) is shown below. In this example the Kannel log files found 
        in /var/log/kannel are rotated and compressed daily over 365 days.  See the 
        documentation for logrotate for more details.  Of particular note however is the 
        postrotate command, this killall -HUP issues a SIGHUP signal to each Kannel
        box process running. The SIGHUP signal has the effect of reopening the log file, 
        and performing graceful restart of SMSC connections. Without this command Kannel 
        will continue to write to the rotated log file. Kannel bearerbox can use the 
        SIGUSR2 to reopen the logs only, without performing the graceful restart. This
        may be more applicable for logrotate usage. 
        </P
><PRE
CLASS="screen"
><KBD
CLASS="userinput"
>&#13;        /var/log/kannel/*.log {
              daily
              missingok
              rotate 365
              compress
              delaycompress
              notifempty
              create 640 kannel adm
              sharedscripts
              postrotate
                    killall -USR2 bearerbox &#38;&#38; killall -HUP smsbox wapbox || true &#62; /dev/null 2&#62; /dev/null
              endscript
        }
        </KBD
></PRE
></DIV
></DIV
><DIV
CLASS="GLOSSARY"
><H1
><A
NAME="AEN6703"
></A
>Glossary</H1
><DIV
CLASS="glossdiv"
><H1
CLASS="glossdiv"
><A
NAME="AEN6705"
>M</A
></H1
><DL
><DT
><A
NAME="MO"
></A
><B
>MO</B
></DT
><DD
><P
>Mobile Originated - a SMS from mobile to application</P
></DD
><DT
><A
NAME="MT"
></A
><B
>MT</B
></DT
><DD
><P
>Mobile Terminated - a SMS from application to mobile</P
></DD
><DT
><A
NAME="MWI"
></A
><B
>MWI</B
></DT
><DD
><P
>Message Waiting Indicator (See <A
HREF="#Biblio-3GPP-23038"
>[Biblio-3GPP-23038]</A
>)</P
></DD
><DT
><A
NAME="MCLASS"
></A
><B
>MClass</B
></DT
><DD
><P
>Message Class (See <A
HREF="#Biblio-3GPP-23038"
>[Biblio-3GPP-23038]</A
>)</P
></DD
><DT
><A
NAME="CODING"
></A
><B
>Coding</B
></DT
><DD
><P
>Message Coding (See <A
HREF="#Biblio-3GPP-23038"
>[Biblio-3GPP-23038]</A
>)</P
></DD
></DL
></DIV
></DIV
><A
NAME="AEN6730"
></A
><HR><H1
><A
NAME="AEN6730"
></A
>Bibliography</H1
><DIV
CLASS="biblioentry"
><A
NAME="Biblio-RFC-2616"
></A
><P
><I
>RFC 2616 - Hypertext Transfer Protocol -- HTTP/1.1</I
>, <A
HREF="http://www.w3.org/Protocols/rfc2616/rfc2616.html"
TARGET="_top"
>http://www.w3.org/Protocols/rfc2616/rfc2616.html</A
>, <I
>Request for Comments: 2616</I
>, The Internet Society, 1999.</P
><DIV
CLASS="BIBLIOENTRYBLOCK"
STYLE="margin-left: 0.5in"
></DIV
></DIV
><DIV
CLASS="biblioentry"
><A
NAME="Biblio-3GPP-23038"
></A
><P
><I
>3GPP 23.038</I
>, <A
HREF="http://www.3gpp.org/ftp/Specs/latest/Rel-5/23_series/23038-500.zip"
TARGET="_top"
>http://www.3gpp.org/ftp/Specs/latest/Rel-5/23_series/23038-500.zip</A
>, <I
>...</I
>, 3GPP, ?.</P
><DIV
CLASS="BIBLIOENTRYBLOCK"
STYLE="margin-left: 0.5in"
></DIV
></DIV
><DIV
CLASS="biblioentry"
><A
NAME="Biblio-3GPP-23040"
></A
><P
><I
>3GPP 23.040</I
>, <A
HREF="http://www.3gpp.org/ftp/Specs/latest/Rel-5/23_series/23040-530.zip"
TARGET="_top"
>http://www.3gpp.org/ftp/Specs/latest/Rel-5/23_series/23040-530.zip</A
>, <I
>...</I
>, 3GPP, ?.</P
><DIV
CLASS="BIBLIOENTRYBLOCK"
STYLE="margin-left: 0.5in"
></DIV
></DIV
><DIV
CLASS="biblioentry"
><A
NAME="Biblio-regexp"
></A
><P
><I
>regex(7), GNU regex manual</I
><I
>: </I
><I
></I
>, GNU, 1998.</P
><DIV
CLASS="BIBLIOENTRYBLOCK"
STYLE="margin-left: 0.5in"
></DIV
></DIV
></DIV
></BODY
></HTML
>